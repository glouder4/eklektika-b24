{"version":3,"file":"script.js","sources":["src/js/hint.popup.js","src/js/reserve.control.js","src/js/search/search-field.js","src/js/search/match-index.js","src/js/search/match-field.js","src/js/search/match-result.js","src/js/search/search-engine.js","src/js/search/search-query.js","src/js/entity.dialog.js","src/js/product-selector/product-search-selector-footer.js","src/js/product-selector/product-creation-limited-footer.js","src/js/product-selector/selector-error-code.js","src/js/product-selector/product-search-input.js","src/js/product-selector/product-image-input.js","src/js/product-selector/barcode-search-selector-footer.js","src/js/product-selector/barcode-search-input.js","src/js/product-selector/product-selector.js","src/js/store.available.popup.js","src/js/product.application.js","src/js/product.list.row.js","src/js/page.events.manager.js","src/js/settings.button.js","src/js/product.list.editor.js"],"sourcesContent":["import {Popup} from 'main.popup';\nimport {Tag, Text} from 'main.core';\nimport {Editor} from './product.list.editor';\n\nexport default class HintPopup\n{\n\teditor: Editor;\n\thintPopup: ?Popup;\n\n\tconstructor(editor: Editor)\n\t{\n\t\tthis.editor = editor;\n\t}\n\n\tload(node: HTMLElement, text: String): Popup\n\t{\n\t\tif (!this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup = new Popup(\n\t\t\t\t'ui-hint-popup-' + this.editor.getId(),\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\tdarkMode: true,\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\tanimation: 'fading-slide'\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.hintPopup.setBindElement(node);\n\t\tthis.hintPopup.adjustPosition();\n\t\tthis.hintPopup.setContent(Tag.render`\n\t\t\t<div class='ui-hint-content'>${Text.encode(text)}</div>\n\t\t`);\n\n\t\treturn this.hintPopup;\n\t}\n\n\tshow()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.hintPopup)\n\t\t{\n\t\t\tthis.hintPopup.close();\n\t\t}\n\t}\n}","import {Tag, Text, Loc, Event, Cache, Runtime} from 'main.core';\nimport {EventEmitter, BaseEvent} from 'main.core.events';\n\nexport default class ReserveControl\n{\n\tstatic INPUT_NAME = 'INPUT_RESERVE_QUANTITY';\n\tstatic DATE_NAME = 'DATE_RESERVE_END';\n\tstatic QUANTITY_NAME = 'QUANTITY';\n\tstatic DEDUCTED_QUANTITY_NAME = 'DEDUCTED_QUANTITY';\n\n\t#model = null;\n\t#cache = new Cache.MemoryCache();\n\tisReserveEqualProductQuantity = true;\n\n\tconstructor(options)\n\t{\n\t\tthis.#model = options.model;\n\t\tthis.inputFieldName = options.inputName || ReserveControl.INPUT_NAME;\n\t\tthis.dateFieldName = options.dateFieldName || ReserveControl.DATE_NAME;\n\t\tthis.quantityFieldName = options.quantityFieldName || ReserveControl.QUANTITY_NAME;\n\t\tthis.deductedQuantityFieldName = options.deductedQuantityFieldName || ReserveControl.DEDUCTED_QUANTITY_NAME;\n\t\tthis.defaultDateReservation = options.defaultDateReservation || null;\n\t\tthis.isBlocked = options.isBlocked || false;\n\n\t\tthis.isReserveEqualProductQuantity =\n\t\t\toptions.isReserveEqualProductQuantity\n\t\t\t&& (\n\t\t\t\tthis.getReservedQuantity() === this.getQuantity()\n\t\t\t\t|| this.#model.getOption('id') === null // is new row\n\t\t\t)\n\t\t;\n\t}\n\n\trenderTo(node: HTMLElement): void\n\t{\n\t\tnode.appendChild(\n\t\t\tTag.render`<div>${this.#getReserveInputNode()}</div>`\n\t\t);\n\t\tEvent.bind(this.#getReserveInputNode().querySelector('input'), 'input', Runtime.debounce(this.onReserveInputChange, 800, this));\n\n\t\tif (this.getReservedQuantity() > 0 || this.isReserveEqualProductQuantity)\n\t\t{\n\t\t\tthis.#layoutDateReservation(this.getDateReservation());\n\t\t}\n\n\t\tnode.appendChild(\n\t\t\tTag.render`${this.#getDateNode()}`\n\t\t);\n\n\t\tEvent.bind(this.#getDateNode(), 'click', ReserveControl.#onDateInputClick.bind(this));\n\t\tEvent.bind(this.#getDateNode().querySelector('input'), 'change', this.onDateChange.bind(this));\n\t}\n\n\tsetReservedQuantity(value: Number, isTriggerEvent: ?Boolean)\n\t{\n\t\tconst input = this.#getReserveInputNode().querySelector('input');\n\t\tif (input)\n\t\t{\n\t\t\tinput.value = value;\n\n\t\t\tif (isTriggerEvent)\n\t\t\t{\n\t\t\t\tinput.dispatchEvent(new window.Event('input'));\n\t\t\t}\n\t\t}\n\t}\n\n\tgetReservedQuantity()\n\t{\n\t\treturn Text.toNumber(this.#model.getField(this.inputFieldName));\n\t}\n\n\tgetDateReservation()\n\t{\n\t\treturn this.#model.getField(this.dateFieldName) || null;\n\t}\n\n\tgetQuantity()\n\t{\n\t\treturn Text.toNumber(this.#model.getField(this.quantityFieldName));\n\t}\n\n\tgetDeductedQuantity()\n\t{\n\t\treturn Text.toNumber(this.#model.getField(this.deductedQuantityFieldName));\n\t}\n\n\tgetAvailableQuantity()\n\t{\n\t\treturn this.getQuantity() - this.getDeductedQuantity();\n\t}\n\n\tonReserveInputChange(event: BaseEvent)\n\t{\n\t\tconst value = Text.toNumber(event.target.value);\n\n\t\tthis.changeInputValue(value);\n\t}\n\n\tchangeInputValue(value): void\n\t{\n\t\tif (value > this.getAvailableQuantity())\n\t\t{\n\t\t\tconst errorNotifyId = 'reserveCountError';\n\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (!notify)\n\t\t\t{\n\t\t\t\tconst notificationOptions = {\n\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\tcloseButton: true,\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_IS_LESS_QUANTITY_WITH_DEDUCTED_THEN_RESERVED')}</div>`,\n\t\t\t\t};\n\n\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t}\n\n\t\t\tnotify.show();\n\n\t\t\tvalue = this.getAvailableQuantity();\n\t\t\tthis.setReservedQuantity(value);\n\t\t}\n\n\t\tif (value > 0)\n\t\t{\n\t\t\tif (this.getDateReservation() === null)\n\t\t\t{\n\t\t\t\tthis.changeDateReservation(this.defaultDateReservation);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#layoutDateReservation(this.#model.getField(this.dateFieldName));\n\t\t\t}\n\t\t}\n\t\telse if (value <= 0)\n\t\t{\n\t\t\tthis.changeDateReservation();\n\t\t}\n\n\t\tthis.#model.setField(this.inputFieldName, value);\n\n\t\tEventEmitter.emit(this, 'onChange', {\n\t\t\tNAME: this.inputFieldName,\n\t\t\tVALUE: value,\n\t\t})\n\t}\n\n\tclearCache()\n\t{\n\t\tthis.#cache.delete('dateInput');\n\t\tthis.#cache.delete('reserveInput');\n\t}\n\n\tisInputDisabled()\n\t{\n\t\treturn this.isBlocked\n\t\t\t|| this.#model.isSimple()\n\t\t\t|| this.#model.isEmpty()\n\t\t;\n\t}\n\n\tstatic #onDateInputClick(event: BaseEvent)\n\t{\n\t\tBX.calendar({node: event.target, field: event.target.parentNode.querySelector('input'), bTime: false});\n\t}\n\n\tonDateChange(event: BaseEvent)\n\t{\n\t\tconst value = event.target.value;\n\t\tconst newDate = BX.parseDate(value);\n\t\tconst current = new Date();\n\t\tcurrent.setHours(0,0,0,0);\n\t\tif (newDate >= current)\n\t\t{\n\t\t\tthis.changeDateReservation(value);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst errorNotifyId = 'reserveDateError';\n\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\n\t\t\tif (!notify)\n\t\t\t{\n\t\t\t\tconst notificationOptions = {\n\t\t\t\t\tid: errorNotifyId,\n\t\t\t\t\tcloseButton: true,\n\t\t\t\t\tautoHideDelay: 3000,\n\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_DATE_IN_PAST')}</div>`,\n\t\t\t\t};\n\n\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\n\t\t\t}\n\n\t\t\tnotify.show();\n\t\t\tthis.changeDateReservation(this.defaultDateReservation);\n\t\t}\n\t}\n\n\t#getDateNode(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('dateInput', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<a class=\"crm-entity-product-list-reserve-date\"></a>\n\t\t\t\t\t<input\n\t\t\t\t\t\tdata-name=\"${this.dateFieldName}\"\n\t\t\t\t\t\tname=\"${this.dateFieldName}\"\n\t\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\t\tvalue=\"${this.getDateReservation()}\"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getReserveInputNode(): HTMLElement\n\t{\n\t\treturn this.#cache.remember('reserveInput', () => {\n\t\t\tconst tag = Tag.render`\n\t\t\t\t<div>\n\t\t\t\t\t<input type=\"text\"\n\t\t\t\t\t\tdata-name=\"${this.inputFieldName}\"\n\t\t\t\t\t\tname=\"${this.inputFieldName}\"\n\t\t\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox ${this.isInputDisabled() ? \"crm-entity-product-list-locked-field\" : \"\"}\"\n\t\t\t\t\t\tautoComplete=\"off\"\n\t\t\t\t\t\tvalue=\"${this.getReservedQuantity()}\"\n\t\t\t\t\t\tplaceholder=\"0\"\n\t\t\t\t\t\ttitle=\"${this.getReservedQuantity()}\"\n\t\t\t\t\t\t${this.isInputDisabled() ? \"disabled\" : \"\"}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t\tif (this.isBlocked)\n\t\t\t{\n\t\t\t\ttag.onclick = () => top.BX.UI.InfoHelper.show('limit_store_crm_integration');\n\t\t\t}\n\t\t\treturn tag;\n\t\t});\n\t}\n\n\tchangeDateReservation(date: ?string = null)\n\t{\n\t\tEventEmitter.emit(this, 'onChange', {\n\t\t\tNAME: this.dateFieldName,\n\t\t\tVALUE: date,\n\t\t})\n\n\t\tthis.#model.setField(this.dateFieldName, date);\n\n\t\tthis.#layoutDateReservation(date);\n\t}\n\n\t#layoutDateReservation(date: ?string = null): void\n\t{\n\t\tconst linkText =\n\t\t\t(date === null)\n\t\t\t\t? ''\n\t\t\t\t: Loc.getMessage(\n\t\t\t\t\t'CRM_ENTITY_PL_RESERVED_DATE',\n\t\t\t\t\t{\n\t\t\t\t\t\t'#FINAL_RESERVATION_DATE#': date\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t;\n\t\tconst link = this.#getDateNode().querySelector('a');\n\t\tif (link)\n\t\t{\n\t\t\tlink.innerText = linkText;\n\t\t}\n\n\t\tconst hiddenInput = this.#getDateNode().querySelector('input');\n\t\tif (hiddenInput)\n\t\t{\n\t\t\thiddenInput.value = date;\n\t\t}\n\t}\n}\n","import { Type } from 'main.core';\nimport type { SearchFieldOptions } from './search-field-options';\n\nexport default class SearchField\n{\n\tname: string = null;\n\ttype: string = 'string';\n\tsearchable: boolean = true;\n\tsystem: boolean = false;\n\tsort: ?number = null;\n\n\tconstructor(fieldOptions: SearchFieldOptions)\n\t{\n\t\tconst options = Type.isPlainObject(fieldOptions) ? fieldOptions : {};\n\n\t\tif (!Type.isStringFilled(options.name))\n\t\t{\n\t\t\tthrow new Error('EntitySelector.SearchField: \"name\" parameter is required.');\n\t\t}\n\n\t\tthis.name = options.name;\n\t\tthis.setType(options.type);\n\t\tthis.setSystem(options.system);\n\t\tthis.setSort(options.sort);\n\t\tthis.setSearchable(options.searchable);\n\t}\n\n\tgetName(): string\n\t{\n\t\treturn this.name;\n\t}\n\n\tgetType(): string\n\t{\n\t\treturn this.type;\n\t}\n\n\tsetType(type: string): void\n\t{\n\t\tif (Type.isStringFilled(type))\n\t\t{\n\t\t\tthis.type = type;\n\t\t}\n\t}\n\n\tgetSort(): ?number\n\t{\n\t\treturn this.sort;\n\t}\n\n\tsetSort(sort: ?number): void\n\t{\n\t\tif (Type.isNumber(sort) || sort === null)\n\t\t{\n\t\t\tthis.sort = sort;\n\t\t}\n\t}\n\n\tsetSearchable(flag: boolean): void\n\t{\n\t\tif (Type.isBoolean(flag))\n\t\t{\n\t\t\tthis.searchable = flag;\n\t\t}\n\t}\n\n\tisSearchable(): boolean\n\t{\n\t\treturn this.searchable;\n\t}\n\n\tsetSystem(flag: boolean)\n\t{\n\t\tif (Type.isBoolean(flag))\n\t\t{\n\t\t\tthis.system = flag;\n\t\t}\n\t}\n\n\tisCustom(): boolean\n\t{\n\t\treturn !this.isSystem();\n\t}\n\n\tisSystem(): boolean\n\t{\n\t\treturn this.system;\n\t}\n}","import SearchField from './search-field';\n\nexport default class MatchIndex\n{\n\tfield: SearchField = null;\n\tqueryWord: string = null;\n\tstartIndex: number = null;\n\tendIndex: number = null;\n\n\tconstructor(field: SearchField, queryWord: string, startIndex: number)\n\t{\n\t\tthis.field = field;\n\t\tthis.queryWord = queryWord;\n\t\tthis.startIndex = startIndex;\n\t\tthis.endIndex = startIndex + queryWord.length;\n\t}\n\n\tgetField(): SearchField\n\t{\n\t\treturn this.field;\n\t}\n\n\tgetQueryWord(): string\n\t{\n\t\treturn this.queryWord;\n\t}\n\n\tgetStartIndex(): number\n\t{\n\t\treturn this.startIndex;\n\t}\n\n\tgetEndIndex(): number\n\t{\n\t\treturn this.endIndex;\n\t}\n}","import { Type } from 'main.core';\n\nimport type SearchField from './search-field';\nimport MatchIndex from './match-index';\nimport { OrderedArray } from 'main.core.collections';\n\nconst comparator = (a: MatchIndex, b: MatchIndex) => {\n\n\tif (a.getStartIndex() === b.getStartIndex())\n\t{\n\t\treturn a.getEndIndex() > b.getEndIndex() ? -1 : 1;\n\t}\n\telse\n\t{\n\t\treturn a.getStartIndex() > b.getStartIndex() ? 1 : -1;\n\t}\n};\n\nexport default class MatchField\n{\n\tfield: SearchField = null;\n\tmatchIndexes: OrderedArray<MatchIndex> = new OrderedArray(comparator);\n\n\tconstructor(field: SearchField, indexes: MatchIndex[] = [])\n\t{\n\t\tthis.field = field;\n\t\tthis.addIndexes(indexes);\n\t}\n\n\tgetField(): SearchField\n\t{\n\t\treturn this.field;\n\t}\n\n\tgetMatches(): OrderedArray<MatchIndex>\n\t{\n\t\treturn this.matchIndexes;\n\t}\n\n\taddIndex(matchIndex: MatchIndex): void\n\t{\n\t\tthis.matchIndexes.add(matchIndex);\n\t}\n\n\taddIndexes(matchIndexes: MatchIndex[]): void\n\t{\n\t\tif (Type.isArray(matchIndexes))\n\t\t{\n\t\t\tmatchIndexes.forEach(matchIndex => {\n\t\t\t\tthis.addIndex(matchIndex);\n\t\t\t});\n\t\t}\n\t}\n}","import MatchField from './match-field';\n\nimport type MatchIndex from './match-index';\nimport type SearchField from './search-field';\nimport type Item from '../item/item';\n\nexport default class MatchResult\n{\n\titem: Item = null;\n\tqueryWords: string[] = null;\n\tmatchFields: Map<SearchField, MatchField> = new Map();\n\tsort: ?number = null;\n\n\tconstructor(item: Item, queryWords: string[], matchIndexes: MatchIndex[] = [])\n\t{\n\t\tthis.item = item;\n\t\tthis.queryWords = queryWords;\n\t\tthis.addIndexes(matchIndexes);\n\t}\n\n\tgetItem(): Item\n\t{\n\t\treturn this.item;\n\t}\n\n\tgetQueryWords(): string[]\n\t{\n\t\treturn this.queryWords;\n\t}\n\n\tgetMatchFields(): Map<SearchField, MatchField>\n\t{\n\t\treturn this.matchFields;\n\t}\n\n\tgetSort(): ?number\n\t{\n\t\treturn this.sort;\n\t}\n\n\taddIndex(matchIndex: MatchIndex): void\n\t{\n\t\tlet matchField = this.matchFields.get(matchIndex.getField());\n\t\tif (!matchField)\n\t\t{\n\t\t\tmatchField = new MatchField(matchIndex.getField());\n\t\t\tthis.matchFields.set(matchIndex.getField(), matchField);\n\n\t\t\tconst fieldSort = matchIndex.getField().getSort();\n\t\t\tif (fieldSort !== null)\n\t\t\t{\n\t\t\t\tthis.sort = this.sort === null ? fieldSort : Math.min(this.sort, fieldSort);\n\t\t\t}\n\t\t}\n\n\t\tmatchField.addIndex(matchIndex);\n\t}\n\n\taddIndexes(matchIndexes: MatchIndex[]): void\n\t{\n\t\tmatchIndexes.forEach(matchIndex => {\n\t\t\tthis.addIndex(matchIndex);\n\t\t});\n\t}\n}","import MatchResult from './match-result';\nimport MatchIndex from './match-index';\n\nimport type SearchFieldIndex from './search-field-index';\nimport type Item from '../item/item';\nimport type SearchQuery from './search-query';\n\nconst collator = new Intl.Collator(undefined, { sensitivity: 'base' });\n\nexport default class SearchEngine\n{\n\tstatic matchItems(items: Item[], searchQuery: SearchQuery): MatchResult[]\n\t{\n\t\tconst matchResults = [];\n\t\tconst queryWords = searchQuery.getQueryWords();\n\t\tlet limit = searchQuery.getResultLimit();\n\n\t\tfor (let i = 0; i < items.length; i++)\n\t\t{\n\t\t\tif (limit === 0)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconst item = items[i];\n\t\t\tif (item.isSelected() || !item.isSearchable() || item.isHidden() || !item.getEntity().isSearchable())\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst matchResult = this.matchItem(item, queryWords);\n\t\t\tif (matchResult)\n\t\t\t{\n\t\t\t\tmatchResults.push(matchResult);\n\t\t\t\tlimit--;\n\t\t\t}\n\t\t}\n\n\t\treturn matchResults;\n\t}\n\n\tstatic matchItem(item: Item, queryWords: string[]): MatchResult\n\t{\n\t\tlet matches = [];\n\t\tfor (let i = 0; i < queryWords.length; i++)\n\t\t{\n\t\t\tconst queryWord = queryWords[i];\n\t\t\tconst results = this.matchWord(item, queryWord);\n\t\t\t//const match = this.matchWord(item, queryWord);\n\t\t\t//if (match === null)\n\t\t\tif (results.length === 0)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmatches = matches.concat(results);\n\t\t\t\t//matches.push(match);\n\t\t\t}\n\t\t}\n\n\t\tif (matches.length > 0)\n\t\t{\n\t\t\treturn new MatchResult(item, queryWords, matches);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tstatic matchWord(item: Item, queryWord: string): MatchIndex[]\n\t{\n\t\tconst searchIndexes = item.getSearchIndex().getIndexes();\n\t\tconst matches = [];\n\n\t\tfor (let i = 0; i < searchIndexes.length; i++)\n\t\t{\n\t\t\tconst fieldIndex: SearchFieldIndex = searchIndexes[i];\n\t\t\tconst indexes = fieldIndex.getIndexes();\n\t\t\tfor (let j = 0; j < indexes.length; j++)\n\t\t\t{\n\t\t\t\tconst index = indexes[j];\n\t\t\t\tconst word = index.getWord().substring(0, queryWord.length);\n\t\t\t\tif (collator.compare(queryWord, word) === 0)\n\t\t\t\t{\n\t\t\t\t\tmatches.push(new MatchIndex(fieldIndex.getField(), queryWord, index.getStartIndex()));\n\t\t\t\t\t//return new MatchIndex(field, queryWord, index[i][1]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (matches.length > 0)\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t}\n\n\t\treturn matches;\n\t\t//return null;\n\t}\n}","import { Type } from 'main.core';\n\nexport default class SearchQuery\n{\n\tqueryWords: string[] = [];\n\tquery: string = '';\n\tcacheable: boolean = true;\n\tdynamicSearchEntities: string[] = [];\n\tresultLimit: number = 100;\n\n\tconstructor(query: string)\n\t{\n\t\tthis.query = query.trim().replace(/\\s\\s+/g, ' ');\n\t\tthis.queryWords = Type.isStringFilled(this.query) ? this.query.split(' ') : [];\n\t}\n\n\tgetQueryWords(): string[]\n\t{\n\t\treturn this.queryWords;\n\t}\n\n\tgetQuery(): string\n\t{\n\t\treturn this.query;\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn this.getQueryWords().length === 0;\n\t}\n\n\tsetCacheable(flag: boolean): void\n\t{\n\t\tif (Type.isBoolean(flag))\n\t\t{\n\t\t\tthis.cacheable = flag;\n\t\t}\n\t}\n\n\tisCacheable(): boolean\n\t{\n\t\treturn this.cacheable;\n\t}\n\n\tsetResultLimit(limit: number)\n\t{\n\t\tif (Type.isNumber(limit) && limit >= 0)\n\t\t{\n\t\t\tthis.resultLimit = limit;\n\t\t}\n\t}\n\n\tgetResultLimit(): number\n\t{\n\t\treturn this.resultLimit;\n\t}\n\n\thasDynamicSearch(): boolean\n\t{\n\t\treturn this.getDynamicSearchEntities().length > 0;\n\t}\n\n\thasDynamicSearchEntity(entityId: string): boolean\n\t{\n\t\treturn this.getDynamicSearchEntities().includes(entityId);\n\t}\n\n\tsetDynamicSearchEntities(entities: string[]): void\n\t{\n\t\tif (Type.isArrayFilled(entities))\n\t\t{\n\t\t\tentities.forEach((entityId: string) => {\n\t\t\t\tif (Type.isStringFilled(entityId) && !this.hasDynamicSearchEntity(entityId))\n\t\t\t\t{\n\t\t\t\t\tthis.dynamicSearchEntities.push(entityId);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn this.dynamicSearchEntities;\n\t}\n\n\tgetDynamicSearchEntities(): string[]\n\t{\n\t\treturn this.dynamicSearchEntities;\n\t}\n\n\tgetAjaxJson(): { [key: string]: any }\n\t{\n\t\treturn this.toJSON();\n\t}\n\n\ttoJSON(): { [key: string]: any }\n\t{\n\t\treturn {\n\t\t\tqueryWords: this.getQueryWords(),\n\t\t\tquery: this.getQuery(),\n\t\t\tdynamicSearchEntities: this.getDynamicSearchEntities(),\n\t\t};\n\t}\n}","import { Runtime, Type, ajax as Ajax } from 'main.core';\r\nimport { EventEmitter, BaseEvent } from 'main.core.events';\r\n\r\nimport { Dialog } from 'ui.entity-selector';\r\nimport SearchEngine from './search/search-engine';\r\nimport SearchQuery from './search/search-query';\r\n\r\nexport class CustomDialog\r\n\textends Dialog\r\n{\r\n\tsearch(queryString: string): void\r\n\t{\r\n\t\tconst query = Type.isStringFilled(queryString) ? queryString.trim() : '';\r\n\r\n\t\tconst event = new BaseEvent({ data: { query } });\r\n\t\tthis.emit('onBeforeSearch', event);\r\n\t\tif (event.isDefaultPrevented())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!Type.isStringFilled(query))\r\n\t\t{\r\n\t\t\tthis.selectFirstTab();\r\n\t\t\tif (this.getSearchTab())\r\n\t\t\t{\r\n\t\t\t\tthis.getSearchTab().clearResults();\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (this.getSearchTab())\r\n\t\t{\r\n\t\t\tthis.selectTab(this.getSearchTab().getId());\r\n\r\n\t\t\tthis.getSearchTab().loadWithDebounce = Runtime.debounce(() => {\r\n\t\t\t\tthis.load(this.getSearchTab().getLastSearchQuery());\r\n\t\t\t}, 500);\r\n\r\n\t\t\tthis.getSearchTab().search(query);\r\n\t\t}\r\n\r\n\t\tthis.emit('onSearch', { query });\r\n\t}\r\n\r\n\t/**\r\n\t * Search in products list\r\n\t * @param searchQuery\r\n\t */\r\n\tload(searchQuery: SearchQuery): void\r\n\t{\r\n\t\tlet searchTab = this.getSearchTab();\r\n\r\n\t\tif (searchQuery === undefined)\r\n\t\t{\r\n\t\t\tsearchTab.getSearchLoader().hide();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!searchTab.shouldLoad(searchQuery))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsearchTab.addCacheQuery(searchQuery);\r\n\r\n\t\tsearchTab.getStub().hide();\r\n\t\tsearchTab.getSearchLoader().show();\r\n\r\n\t\tAjax.runComponentAction('kitconsulting:crm.entity.extendedproduct.list', 'doSearch', {\r\n\t\t\tjson: {\r\n\t\t\t\tdialog: searchTab.getDialog().getAjaxJson(),\r\n\t\t\t\tsearchQuery: searchQuery.getAjaxJson()\r\n\t\t\t},\r\n\t\t\tonrequeststart: (xhr) => {\r\n\t\t\t\tsearchTab.queryXhr = xhr;\r\n\t\t\t},\r\n\t\t\tgetParameters: {\r\n\t\t\t\tcontext: searchTab.getDialog().getContext()\r\n\t\t\t}\r\n\t\t})\r\n\t\t\t.then(response => {\r\n\t\t\t\tsearchTab.getSearchLoader().hide();\r\n\r\n\t\t\t\tif (!response || !response.data || !response.data.dialog || !response.data.dialog.items)\r\n\t\t\t\t{\r\n\t\t\t\t\tsearchTab.removeCacheQuery(searchQuery);\r\n\t\t\t\t\tsearchTab.toggleEmptyResult();\r\n\t\t\t\t\tthis.emit('SearchTab:onLoad', { searchTab: this });\r\n\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (response.data.searchQuery && response.data.searchQuery.cacheable === false)\r\n\t\t\t\t{\r\n\t\t\t\t\tsearchTab.removeCacheQuery(searchQuery);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (Type.isArrayFilled(response.data.dialog.items))\r\n\t\t\t\t{\r\n\t\t\t\t\tconst items = new Set();\r\n\t\t\t\t\tresponse.data.dialog.items.forEach((itemOptions: ItemOptions) => {\r\n\t\t\t\t\t\tdelete itemOptions.tabs;\r\n\t\t\t\t\t\tdelete itemOptions.children;\r\n\r\n\t\t\t\t\t\tconst item = this.addItem(itemOptions);\r\n\t\t\t\t\t\titems.add(item);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tconst isTabEmpty = searchTab.isEmptyResult();\r\n\r\n\t\t\t\t\tconst matchResults = SearchEngine.matchItems(\r\n\t\t\t\t\t\tArray.from(items.values()),\r\n\t\t\t\t\t\tsearchTab.getLastSearchQuery()\r\n\t\t\t\t\t);\r\n\t\t\t\t\tsearchTab.appendResults(matchResults);\r\n\r\n\t\t\t\t\tif (isTabEmpty && this.shouldFocusOnFirst())\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.focusOnFirstNode();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsearchTab.toggleEmptyResult();\r\n\r\n\t\t\t\tthis.emit('SearchTab:onLoad', { searchTab: searchTab });\r\n\t\t\t})\r\n\t\t\t.catch((error) => {\r\n\t\t\t\tsearchTab.removeCacheQuery(searchQuery);\r\n\t\t\t\tsearchTab.getSearchLoader().hide();\r\n\t\t\t\tsearchTab.toggleEmptyResult();\r\n\r\n\t\t\t\tconsole.error(error);\r\n\t\t\t});\r\n\t}\r\n}","import {DefaultFooter, Dialog} from 'ui.entity-selector';\nimport {Dom, Loc, Tag, Type} from 'main.core';\nimport {BaseEvent} from \"main.core.events\";\nimport {Loader} from \"main.loader\";\nimport {ProductSelector} from \"./product-selector\";\n\nexport default class ProductSearchSelectorFooter extends DefaultFooter\n{\n\tloader: Loader = null;\n\n\tconstructor(dialog: Dialog, options: { [option: string]: any })\n\t{\n\t\tsuper(dialog, options);\n\n\t\tthis.errorAdminHint = options.errorAdminHint || '';\n\t\tthis.getDialog().subscribe('onSearch', this.handleOnSearch.bind(this));\n\t}\n\n\tgetContent(): HTMLElement\n\t{\n\t\tlet phrase = '';\n\n\t\tconst isViewCreateButton = this.options.allowCreateItem === true || this.options.allowEditItem === false;\n\n\t\tif (this.isViewEditButton() && isViewCreateButton)\n\t\t{\n\t\t\tphrase = Tag.render`\n\t\t\t\t<div>${Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_1')}</div>\n\t\t\t`;\n\n\t\t\tconst createButton = phrase.querySelector('create-button');\n\t\t\tDom.replace(createButton, this.getLabelContainer());\n\n\t\t\tconst changeButton = phrase.querySelector('change-button');\n\t\t\tDom.replace(changeButton, this.getSaveContainer());\n\t\t}\n\t\telse if (this.isViewEditButton())\n\t\t{\n\t\t\tphrase = this.getSaveContainer();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tphrase = this.getLabelContainer();\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-selector-search-footer-box\">\n\t\t\t\t${phrase}\n\t\t\t\t${this.getHintContainer()}\n\t\t\t\t${this.getLoaderContainer()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tisViewEditButton(): boolean\n\t{\n\t\treturn this.options.allowEditItem === true;\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\tif (Type.isNil(this.loader))\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\ttarget: this.getLoaderContainer(),\n\t\t\t\tsize: 17,\n\t\t\t\tcolor: 'rgba(82, 92, 105, 0.9)'\n\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tshowLoader(): void\n\t{\n\t\tvoid this.getLoader().show();\n\t}\n\n\thideLoader(): void\n\t{\n\t\tvoid this.getLoader().hide();\n\t}\n\n\tsetLabel(label: string)\n\t{\n\t\tif (Type.isString(label))\n\t\t{\n\t\t\tthis.getLabelContainer().textContent = label;\n\t\t}\n\t}\n\n\tgetLabelContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('label', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span>\n\t\t\t\t\t<span onclick=\"${this.handleClick.bind(this)}\" class=\"ui-selector-footer-link  ui-selector-footer-link-add\">\n\t\t\t\t\t\t${\n\t\t\t\t\t\t\tthis.getOption('creationLabel', Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_CREATE'))\n\t\t\t\t\t\t}\n\t\t\t\t\t</span>\n\t\t\t\t\t${this.getQueryContainer()}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetQueryContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('name-container', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"ui-selector-search-footer-query\"></span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetSaveContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('save-container', () => {\n\t\t\tconst className = `ui-selector-footer-link`;\n\n\t\t\tconst messageId =\n\t\t\t\t(this.options.inputName === ProductSelector.INPUT_FIELD_BARCODE)\n\t\t\t\t\t? 'CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_BARCODE_CHANGE'\n\t\t\t\t\t: 'CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_CHANGE'\n\t\t\t;\n\n\t\t\treturn Tag.render`\n\t\t\t<span class=\"${className}\" onclick=\"${this.onClickSaveChanges.bind(this)}\">\n\t\t\t\t${Loc.getMessage(messageId)}\n\t\t\t</span>\n\t\t`;\n\t\t});\n\t}\n\n\tgetLoaderContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('loader', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"ui-selector-search-footer-loader\"></div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetHintContainer(): ?HTMLElement\n\t{\n\t\treturn this.cache.remember('hint', () => {\n\t\t\tlet message = null;\n\t\t\tif (!this.options.allowEditItem && !this.options.allowCreateItem)\n\t\t\t{\n\t\t\t\tmessage = Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_DISABLED_FOOTER_ALL_HINT', {\n\t\t\t\t\t'#ADMIN_HINT#': this.errorAdminHint\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (!this.options.allowEditItem)\n\t\t\t{\n\t\t\t\tmessage = Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_DISABLED_FOOTER_EDIT_HINT', {\n\t\t\t\t\t'#ADMIN_HINT#': this.errorAdminHint\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (!this.options.allowCreateItem)\n\t\t\t{\n\t\t\t\tmessage = Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_DISABLED_FOOTER_ADD_HINT', {\n\t\t\t\t\t'#ADMIN_HINT#': this.errorAdminHint\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!message)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst hintNode = Tag.render`<span class=\"ui-btn ui-btn-icon-lock ui-btn-link\"></span>`;\n\t\t\thintNode.dataset.hint = message;\n\t\t\thintNode.dataset.hintNoIcon = true;\n\n\t\t\tBX.UI.Hint.initNode(hintNode);\n\n\t\t\treturn Tag.render`<div class=\"product-search-selector-disabled-footer-hint\">${hintNode}</div>`;\n\t\t});\n\t}\n\n\tonClickSaveChanges()\n\t{\n\t\tif (!this.options.allowEditItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst lastQuery = this.getDialog().getActiveTab().getLastSearchQuery();\n\t\tthis.getDialog().emit('ChangeItem:onClick', { query: lastQuery.query });\n\t\tthis.getDialog().clearSearch();\n\t\tthis.getDialog().hide();\n\t}\n\n\tcreateItem(): void\n\t{\n\t\tif (!this.options.allowCreateItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst tagSelector = this.getDialog().getTagSelector();\n\t\tif (tagSelector && tagSelector.isLocked())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst finalize = () => {\n\t\t\tthis.hideLoader();\n\t\t\tif (this.getDialog().getTagSelector())\n\t\t\t{\n\t\t\t\tthis.getDialog().getTagSelector().unlock();\n\t\t\t\tthis.getDialog().focusSearch();\n\t\t\t}\n\t\t};\n\n\t\tevent.preventDefault();\n\t\tthis.showLoader();\n\n\t\tif (tagSelector)\n\t\t{\n\t\t\ttagSelector.lock();\n\t\t}\n\n\t\tthis.getDialog()\n\t\t\t.emitAsync('Search:onItemCreateAsync', {\n\t\t\t\tsearchQuery: this.getDialog().getActiveTab().getLastSearchQuery()\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.getTab().clearResults();\n\t\t\t\tthis.getDialog().clearSearch();\n\t\t\t\tif (this.getDialog().getActiveTab() === this.getTab())\n\t\t\t\t{\n\t\t\t\t\tthis.getDialog().selectFirstTab();\n\t\t\t\t}\n\n\t\t\t\tfinalize();\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tfinalize();\n\t\t\t})\n\t\t;\n\t}\n\n\thandleClick(): void\n\t{\n\t\tthis.createItem();\n\t}\n\n\thandleOnSearch(event: BaseEvent): void\n\t{\n\t\tconst { query } = event.getData();\n\n\t\tif (this.options.currentValue === query || query === '')\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.show();\n\t\t}\n\n\t\tthis.getQueryContainer().textContent = \" \" + query;\n\t}\n}\n","import {DefaultFooter} from 'ui.entity-selector';\nimport {Event, Loc, Tag} from 'main.core';\nimport 'ui.info-helper';\n\nexport default class ProductCreationLimitedFooter extends DefaultFooter\n{\n\tgetContent(): HTMLElement\n\t{\n\t\tconst phrase = Tag.render`\n\t\t\t<div>${Loc.getMessage('CATALOG_SELECTOR_LIMITED_PRODUCT_CREATION')}</div>\n\t\t`;\n\n\t\tconst infoButton = Tag.render`\n\t\t\t<a class=\"ui-btn ui-btn-sm ui-btn-primary ui-btn-hover ui-btn-round\">\n\t\t\t\t${Loc.getMessage('CATALOG_SELECTOR_LICENSE_EXPLODE')}\n\t\t\t</a>\n\t\t`;\n\n\t\tEvent.bind(infoButton, 'click', () => {\n\t\t\tBX.UI.InfoHelper.show('limit_shop_products');\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-selector-search-footer-box\">\n\t\t\t\t<div class=\"ui-selector-search-footer-box\">\n\t\t\t\t\t<div class=\"tariff-lock\"></div>\n\t\t\t\t\t${phrase}\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t${infoButton}\n\t\t\t\t</div>\t\t\t\t\n\t\t\t</div>\n\t\t`;\n\t}\n}","export class SelectorErrorCode\n{\n\tstatic NOT_SELECTED_PRODUCT: string = 'NOT_SELECTED_PRODUCT';\n\tstatic FAILED_PRODUCT: string = 'FAILED_PRODUCT';\n\n\tstatic getCodes(): Array<string>\n\t{\n\t\treturn [\n\t\t\tSelectorErrorCode.NOT_SELECTED_PRODUCT,\n\t\t\tSelectorErrorCode.FAILED_PRODUCT,\n\t\t]\n\t}\n}","import {ajax, Browser, Cache, Dom, Event, Extension, Loc, Runtime, Tag, Text, Type} from 'main.core';\nimport {CustomDialog} from '../entity.dialog';\nimport {Item} from 'ui.entity-selector';\nimport './component.css';\nimport {EventEmitter} from 'main.core.events';\nimport {ProductModel} from 'catalog.product-model';\nimport {ProductSelector} from './product-selector';\nimport ProductSearchSelectorFooter from './product-search-selector-footer';\nimport ProductCreationLimitedFooter from './product-creation-limited-footer';\nimport {SelectorErrorCode} from './selector-error-code';\nimport 'ui.notification';\n\nclass DialogMode\n{\n\tstatic SEARCHING: string = 'SEARCHING';\n\tstatic SHOW_PRODUCT_ITEM: string = 'SHOW_PRODUCT_ITEM';\n\tstatic SHOW_RECENT: string = 'SHOW_RECENT';\n}\n\nexport class ProductSearchInput\n{\n\tstatic SEARCH_TYPE_ID = 'product';\n\n\tmodel: ProductModel;\n\tselector: ProductSelector;\n\tcache = new Cache.MemoryCache();\n\n\tconstructor(id, options = {})\n\t{\n\t\tthis.id = id || Text.getRandom();\n\t\tthis.selector = options.selector;\n\t\tif (!(this.selector instanceof ProductSelector))\n\t\t{\n\t\t\tthrow new Error('Product selector instance not found.');\n\t\t}\n\n\t\tthis.model = options.model || {};\n\t\tthis.isEnabledSearch = options.isSearchEnabled;\n\t\tthis.isEnabledDetailLink = options.isEnabledDetailLink;\n\t\tthis.inputName = options.inputName || ProductSelector.INPUT_FIELD_NAME;\n\t\tthis.immutableFieldNames = [ProductSelector.INPUT_FIELD_BARCODE, ProductSelector.INPUT_FIELD_NAME];\n\t\tif (!this.immutableFieldNames.includes(this.inputName))\n\t\t{\n\t\t\tthis.immutableFieldNames.push(this.inputName);\n\t\t}\n\t\tthis.ajaxInProcess = false;\n\t\tthis.loadedSelectedItem = null;\n\n\t\tthis.handleSearchInput = Runtime.debounce(this.searchInDialog, 500, this);\n\t}\n\n\tdestroy()\n\t{\n\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetSelectorType(): string\n\t{\n\t\treturn ProductSelector.INPUT_FIELD_NAME;\n\t}\n\n\tgetField(fieldName): string\n\t{\n\t\treturn this.model.getField(fieldName);\n\t}\n\n\tgetValue(): string\n\t{\n\t\treturn this.getField(this.inputName);\n\t}\n\n\tgetFilledValue(): string\n\t{\n\t\treturn this.getNameInput().value || '';\n\t}\n\n\tisSearchEnabled(): boolean\n\t{\n\t\treturn this.isEnabledSearch;\n\t}\n\n\ttoggleIcon(icon, value)\n\t{\n\t\tif (Type.isDomNode(icon))\n\t\t{\n\t\t\tDom.style(icon, 'display', value);\n\t\t}\n\t}\n\n\tgetNameBlock(): HTMLElement\n\t{\n\t\treturn this.cache.remember('nameBlock', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t${this.getNameTag()}\n\t\t\t\t\t${this.getNameInput()}\n\t\t\t\t\t${this.getHiddenNameInput()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetNameTag(): ?HTMLElement\n\t{\n\t\tif (!this.model.isNew())\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-ctl-tag\">${Loc.getMessage('CATALOG_SELECTOR_NEW_TAG_TITLE')}</div>\n\t\t`;\n\t}\n\n\tgetNameInput(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('nameInput', () => {\n\t\t\tconst input = Tag.render`\n\t\t\t\t<input type=\"text\"\n\t\t\t\t\tclass=\"ui-ctl-element ui-ctl-textbox\"\n\t\t\t\t\tautocomplete=\"off\"\n\t\t\t\t\tdata-name=\"${Text.encode(this.inputName)}\"\n\t\t\t\t\tvalue=\"${Text.encode(this.getValue())}\"\n\t\t\t\t\tplaceholder=\"${Text.encode(this.getPlaceholder())}\"\n\t\t\t\t\ttitle=\"${Text.encode(this.getValue())}\"\n\t\t\t\t\tonchange=\"${this.handleNameInputHiddenChange.bind(this)}\"\n\t\t\t\t>\n\t\t\t`;\n\n\t\t\tif (this.selector.getConfig('SELECTOR_INPUT_DISABLED', false))\n\t\t\t{\n\t\t\t\tDom.addClass(input, 'ui-ctl-disabled');\n\t\t\t\tinput.setAttribute('disabled', true);\n\t\t\t}\n\n\t\t\treturn input;\n\t\t});\n\t}\n\n\tgetHiddenNameInput(): HTMLInputElement\n\t{\n\t\treturn this.cache.remember('hiddenNameInput', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<input\n\t\t\t\t \ttype=\"hidden\"\n\t\t\t\t\tname=\"${Text.encode(this.inputName)}\"\n\t\t\t\t\tvalue=\"${Text.encode(this.getValue())}\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\thandleNameInputHiddenChange(event: UIEvent)\n\t{\n\t\tthis.getHiddenNameInput().value = event.target.value;\n\t}\n\n\tgetClearIcon(): HTMLElement\n\t{\n\t\treturn this.cache.remember('closeIcon', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-clear\"\n\t\t\t\t\tonclick=\"${this.handleClearIconClick.bind(this)}\"\n\t\t\t\t></button>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetArrowIcon(): HTMLElement\n\t{\n\t\treturn this.cache.remember('arrowIcon', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"${Text.encode(this.model.getDetailPath())}\"\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-forward\"\n\t\t\t\t>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetSearchIcon(): HTMLElement\n\t{\n\t\treturn this.cache.remember('searchIcon', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-ctl-after ui-ctl-icon-search\"\n\t\t\t\t\tonclick=\"${this.handleSearchIconClick.bind(this)}\"\n\t\t\t\t></button>\n\t\t\t`;\n\t\t});\n\t}\n\n\tlayout(): HTMLElement\n\t{\n\t\tthis.clearInputCache();\n\t\tconst block = Tag.render`<div class=\"ui-ctl ui-ctl-w100 ui-ctl-after-icon\"></div>`;\n\n\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\t\tDom.append(this.getClearIcon(), block);\n\n\t\tif (this.isSearchEnabled())\n\t\t{\n\t\t\tif (this.selector.isProductSearchEnabled())\n\t\t\t{\n\t\t\t\tthis.initHasDialogItems();\n\t\t\t}\n\n\t\t\tthis.toggleIcon(\n\t\t\t\tthis.getSearchIcon(),\n\t\t\t\tType.isStringFilled(this.getFilledValue()) ? 'none' : 'block'\n\t\t\t);\n\t\t\tDom.append(this.getSearchIcon(), block);\n\n\t\t\tEvent.bind(this.getNameInput(), 'click', this.handleClickNameInput.bind(this));\n\t\t\tEvent.bind(this.getNameInput(), 'input', this.handleSearchInput);\n\t\t\tEvent.bind(this.getNameInput(), 'blur', this.handleNameInputBlur.bind(this));\n\t\t\tEvent.bind(this.getNameInput(), 'keydown', this.handleNameInputKeyDown.bind(this));\n\n\t\t\tthis.dialogMode =\n\t\t\t\tthis.model.isCatalogExisted()\n\t\t\t\t\t? DialogMode.SHOW_PRODUCT_ITEM\n\t\t\t\t\t: DialogMode.SHOW_RECENT\n\t\t\t;\n\t\t}\n\n\t\tif (this.showDetailLink() && Type.isStringFilled(this.getValue()))\n\t\t{\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\t\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\t\t\tthis.toggleIcon(this.getArrowIcon(), 'block');\n\t\t\tDom.append(this.getArrowIcon(), block);\n\t\t}\n\n\t\tEvent.bind(this.getNameInput(), 'click', this.handleIconsSwitchingOnNameInput.bind(this));\n\t\tEvent.bind(this.getNameInput(), 'input', this.handleIconsSwitchingOnNameInput.bind(this));\n\t\tEvent.bind(this.getNameInput(), 'change', this.handleNameInputChange.bind(this));\n\n\t\tDom.append(this.getNameBlock(), block);\n\t\treturn block;\n\t}\n\n\tshowDetailLink(): boolean\n\t{\n\t\treturn this.isEnabledDetailLink;\n\t}\n\n\tgetDialog(): ?CustomDialog\n\t{\n\t\treturn this.cache.remember('dialog', () => {\n\t\t\tconst searchTypeId = ProductSearchInput.SEARCH_TYPE_ID ;\n\t\t\tconst entity = {\n\t\t\t\tid: searchTypeId,\n\t\t\t\toptions: {\n\t\t\t\t\tiblockId: this.model.getIblockId(),\n\t\t\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\t\t\tcurrency: this.model.getCurrency(),\n\t\t\t\t},\n\t\t\t\tdynamicLoad: true,\n\t\t\t\tdynamicSearch: true,\n\t\t\t};\n\t\t\tconst restrictedProductTypes = this.selector.getConfig('RESTRICTED_PRODUCT_TYPES', null);\n\t\t\tif (!Type.isNil(restrictedProductTypes))\n\t\t\t{\n\t\t\t\tentity.options.restrictedProductTypes = restrictedProductTypes;\n\t\t\t}\n\n\t\t\tconst params = {\n\t\t\t\tid: this.id + '_' + searchTypeId,\n\t\t\t\theight: 300,\n\t\t\t\twidth: Math.max(this.getNameInput()?.offsetWidth, 565),\n\t\t\t\tcontext: 'catalog-products',\n\t\t\t\ttargetNode: this.getNameInput(),\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tsearchTabOptions: {\n\t\t\t\t\tstub: true,\n\t\t\t\t\tstubOptions: {\n\t\t\t\t\t\ttitle: Tag.message`${'CATALOG_SELECTOR_IS_EMPTY_TITLE'}`,\n\t\t\t\t\t\tsubtitle:\n\t\t\t\t\t\t\tthis.isAllowedCreateProduct()\n\t\t\t\t\t\t\t\t? Tag.message`${'CATALOG_SELECTOR_IS_EMPTY_SUBTITLE'}`\n\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t,\n\t\t\t\t\t\tarrow: true\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.onProductSelect.bind(this),\n\t\t\t\t\t'Search:onItemCreateAsync': this.createProduct.bind(this),\n\t\t\t\t\t'ChangeItem:onClick': this.showChangeNotification.bind(this),\n\t\t\t\t},\n\t\t\t\tentities: [entity]\n\t\t\t};\n\n\t\t\tconst settingsCollection = Extension.getSettings('catalog.product-selector');\n\t\t\tif (Type.isObject(settingsCollection.get('limitInfo')))\n\t\t\t{\n\t\t\t\tparams.footer = ProductCreationLimitedFooter;\n\t\t\t}\n\t\t\telse if (this.model && this.model.isCatalogExisted())\n\t\t\t{\n\t\t\t\tparams.footer = ProductSearchSelectorFooter;\n\t\t\t\tparams.footerOptions = {\n\t\t\t\t\tinputName: this.inputName,\n\t\t\t\t\tallowEditItem: this.isAllowedEditProduct(),\n\t\t\t\t\tallowCreateItem: this.isAllowedCreateProduct(),\n\t\t\t\t\terrorAdminHint: settingsCollection.get('errorAdminHint'),\n\t\t\t\t\tcreationLabel: Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_CREATE'),\n\t\t\t\t\tcurrentValue: this.getValue(),\n\t\t\t\t};\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tparams.searchOptions = { allowCreateItem: this.isAllowedCreateProduct() };\n\t\t\t}\n\n\t\t\treturn new CustomDialog(params);\n\t\t});\n\t}\n\n\tinitHasDialogItems()\n\t{\n\t\tif (!Type.isNil(this.selector.getConfig('EXIST_DIALOG_ITEMS')))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.selector.getModel().isEmpty())\n\t\t{\n\t\t\tthis.selector.setConfig('EXIST_DIALOG_ITEMS', true);\n\t\t\treturn;\n\t\t}\n\n\t\t// is null, that not send ajax\n\t\tthis.selector.setConfig('EXIST_DIALOG_ITEMS', false);\n\n\t\tconst dialog = this.getDialog();\n\t\tif (dialog.hasDynamicLoad())\n\t\t{\n\t\t\tthis.#loadPreselectedItems();\n\t\t\tdialog.subscribeOnce('onLoad', () => {\n\t\t\t\tif (dialog.getPreselectedItems().length > 1)\n\t\t\t\t{\n\t\t\t\t\tthis.selector.setConfig('EXIST_DIALOG_ITEMS', true);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.selector.setConfig('EXIST_DIALOG_ITEMS', true);\n\t\t}\n\t}\n\n\tisAllowedCreateProduct(): boolean\n\t{\n\t\treturn this.selector.getConfig('IS_ALLOWED_CREATION_PRODUCT', true) && this.selector.checkProductAddRights();\n\t}\n\n\tisAllowedEditProduct(): boolean\n\t{\n\t\treturn this.selector.checkProductEditRights();\n\t}\n\n\thandleNameInputKeyDown(event: KeyboardEvent): void\n\t{\n\t\tconst dialog = this.getDialog();\n\t\tif (event.key === 'Enter' && dialog.getActiveTab() === dialog.getSearchTab())\n\t\t{\n\t\t\t// prevent a form submit\n\t\t\tevent.stopPropagation();\n\t\t\tevent.preventDefault();\n\n\t\t\tif ((Browser.isMac() && event.metaKey) || event.ctrlKey)\n\t\t\t{\n\t\t\t\tdialog.getSearchTab().getFooter().createItem();\n\t\t\t}\n\t\t}\n\t}\n\n\thandleIconsSwitchingOnNameInput(event: UIEvent): void\n\t{\n\t\tthis.toggleIcon(this.getArrowIcon(), 'none');\n\n\t\tif (Type.isStringFilled(event.target.value))\n\t\t{\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'block');\n\t\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\t\t\tif (this.isSearchEnabled())\n\t\t\t{\n\t\t\t\tthis.toggleIcon(this.getSearchIcon(), 'block');\n\t\t\t}\n\t\t}\n\t}\n\n\tclearInputCache()\n\t{\n\t\tthis.cache.delete('dialog');\n\t\tthis.cache.delete('nameBlock');\n\t\tthis.cache.delete('nameInput');\n\t\tthis.cache.delete('hiddenNameInput');\n\t}\n\n\thandleClearIconClick(event: UIEvent)\n\t{\n\t\tthis.selector.emit('onBeforeClear', {\n\t\t\tselectorId: this.selector.getId(),\n\t\t\trowId: this.selector.getRowId()\n\t\t});\n\n\t\tthis.loadedSelectedItem = null;\n\t\tif (this.selector.isProductSearchEnabled() && !this.model.isEmpty())\n\t\t{\n\t\t\tthis.selector.clearState();\n\t\t\tthis.selector.clearLayout();\n\t\t\tthis.selector.layout();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst newValue = '';\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\t\t\tthis.onChangeValue(newValue);\n\t\t}\n\n\t\tthis.selector.focusName();\n\n\t\tthis.selector.emit('onClear', {\n\t\t\tselectorId: this.selector.getId(),\n\t\t\trowId: this.selector.getRowId()\n\t\t});\n\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\t}\n\n\thandleNameInputChange(event: UIEvent)\n\t{\n\t\tconst value = event.target.value;\n\t\tthis.onChangeValue(value);\n\t}\n\n\tonChangeValue(value: string)\n\t{\n\t\tconst fields = {};\n\t\tthis.getNameInput().title = value;\n\t\tthis.getNameInput().value = value;\n\t\tfields[this.inputName] = value;\n\t\tEventEmitter.emit('ProductSelector::onNameChange', {\n\t\t\trowId: this.selector.getRowId(),\n\t\t\tfields\n\t\t});\n\n\t\tif (!this.selector.isEnabledAutosave())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.selector.getModel().setFields(fields);\n\t\tthis.selector.getModel().save().then(() => {\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tid: 'saving_field_notify_name',\n\t\t\t\tcloseButton: false,\n\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CATALOG_SELECTOR_SAVING_NOTIFICATION_NAME')}</div>`,\n\t\t\t\tautoHide: true,\n\t\t\t});\n\t\t});\n\t}\n\n\tfocusName()\n\t{\n\t\trequestAnimationFrame(() => this.getNameInput().focus());\n\t}\n\n\tsearchInDialog(): void\n\t{\n\t\tconst searchQuery = this.getFilledValue().trim();\n\t\tif (searchQuery === '')\n\t\t{\n\t\t\tif (this.isHasDialogItems === false)\n\t\t\t{\n\t\t\t\tthis.getDialog().hide();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.loadedSelectedItem = null;\n\t\t\tthis.#showPreselectedItems()\n\t\t\treturn;\n\t\t}\n\n\t\tthis.dialogMode = DialogMode.SEARCHING;\n\t\tthis.#searchItem(searchQuery);\n\t\tthis.isSearchingInProcess = true;\n\t}\n\n\t#showSelectedItem()\n\t{\n\t\tif (!this.selector.isProductSearchEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst dialog = this.getDialog();\n\t\tdialog.removeItems();\n\n\t\tnew Promise((resolve) => {\n\t\t\tif (!Type.isNil(this.loadedSelectedItem))\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdialog.showLoader();\n\t\t\tajax.runAction(\n\t\t\t\t'catalog.productSelector.getSkuSelectorItem',\n\t\t\t\t{\n\t\t\t\t\tjson: {\n\t\t\t\t\t\tid: this.selector.getModel().getSkuId(),\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tiblockId: this.model.getIblockId(),\n\t\t\t\t\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\t\t\t\t\tcurrency: this.model.getCurrency(),\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tdialog.hideLoader();\n\t\t\t\t\tthis.loadedSelectedItem = null;\n\t\t\t\t\tif (Type.isObject(response.data) && !dialog.isLoading())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.loadedSelectedItem = dialog.addItem(response.data);\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tif (!Type.isNil(this.loadedSelectedItem))\n\t\t\t\t{\n\t\t\t\t\tdialog.setPreselectedItems([this.selector.getModel().getSkuId()]);\n\t\t\t\t\tdialog.getRecentTab().getRootNode().addItem(this.loadedSelectedItem);\n\t\t\t\t\tdialog.selectFirstTab();\n\t\t\t\t\tdialog.getFooter()?.hide();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.searchInDialog();\n\t\t\t\t}\n\t\t\t});\n\n\t\tdialog.getPopup().show();\n\t\tdialog.getFooter()?.hide();\n\t}\n\n\t#loadPreselectedItems()\n\t{\n\t\tconst dialog = this.getDialog();\n\t\tif (dialog.isLoading())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.loadedSelectedItem)\n\t\t{\n\t\t\tdialog.removeItems();\n\t\t\tdialog.loadState = 'UNSENT';\n\t\t\tthis.loadedSelectedItem = null;\n\t\t}\n\n\t\tdialog.load();\n\t}\n\n\t#showPreselectedItems()\n\t{\n\t\tif (!this.selector.isProductSearchEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.dialogMode = DialogMode.SHOW_RECENT;\n\t\tconst dialog = this.getDialog();\n\t\tthis.#loadPreselectedItems();\n\n\t\tdialog.selectFirstTab();\n\t\tdialog.getFooter()?.hide();\n\t\tdialog.show();\n\t}\n\n\t#searchItem(searchQuery: string = '')\n\t{\n\t\tif (!this.selector.isProductSearchEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst dialog = this.getDialog();\n\t\tdialog.getPopup().show();\n\t\tdialog.search(searchQuery);\n\t}\n\n\thandleClickNameInput(): void\n\t{\n\t\tconst dialog = this.getDialog();\n\n\t\tif (\n\t\t\tdialog.isOpen()\n\t\t\t|| (this.getFilledValue() === '' && this.isHasDialogItems === false)\n\t\t)\n\t\t{\n\t\t\tdialog.hide();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.showItems();\n\t}\n\n\tshowItems()\n\t{\n\t\tif (this.getFilledValue() === '')\n\t\t{\n\t\t\tthis.#showPreselectedItems();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.model.isCatalogExisted() || this.dialogMode !== DialogMode.SHOW_PRODUCT_ITEM)\n\t\t{\n\t\t\tthis.searchInDialog();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#showSelectedItem();\n\t}\n\n\thandleNameInputBlur(event: UIEvent)\n\t{\n\t\t// timeout to toggle clear icon handler while cursor is inside of name input\n\t\tsetTimeout(() => {\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\n\t\t\tif (this.showDetailLink() && Type.isStringFilled(this.getValue()))\n\t\t\t{\n\t\t\t\tif (this.isSearchEnabled())\n\t\t\t\t{\n\t\t\t\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\t\t\t\t}\n\t\t\t\tthis.toggleIcon(this.getArrowIcon(), 'block');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.toggleIcon(this.getArrowIcon(), 'none');\n\t\t\t\tif (this.isSearchEnabled())\n\t\t\t\t{\n\t\t\t\t\tthis.toggleIcon(\n\t\t\t\t\t\tthis.getSearchIcon(),\n\t\t\t\t\t\tType.isStringFilled(this.getFilledValue()) ? 'none' : 'block'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}, 200);\n\n\t\tif (this.isSearchEnabled() && this.selector.isEnabledEmptyProductError())\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (\n\t\t\t\t\t!this.selector.inProcess()\n\t\t\t\t\t&& (\n\t\t\t\t\t\tthis.model.isEmpty()\n\t\t\t\t\t\t|| !Type.isStringFilled(this.getFilledValue())\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.model.getErrorCollection().setError(\n\t\t\t\t\t\tSelectorErrorCode.NOT_SELECTED_PRODUCT,\n\t\t\t\t\t\tthis.selector.getEmptySelectErrorMessage()\n\t\t\t\t\t);\n\n\t\t\t\t\tthis.selector.layoutErrors();\n\t\t\t\t}\n\t\t\t}, 200);\n\t\t}\n\t}\n\n\thandleSearchIconClick(event: UIEvent)\n\t{\n\t\tthis.searchInDialog();\n\t\tthis.focusName();\n\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\t}\n\n\tgetImmutableFieldNames(): []\n\t{\n\t\treturn this.immutableFieldNames;\n\t}\n\n\tsetInputValueOnProductSelect(item: Item)\n\t{\n\t\titem.getDialog().getTargetNode().value = item.getTitle()\n\t}\n\n\tonProductSelect(event)\n\t{\n\t\tconst item = event.getData().item;\n\t\tthis.setInputValueOnProductSelect(item);\n\n\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\t\tthis.clearErrors();\n\t\tif (this.selector)\n\t\t{\n\t\t\tconst isNew = item.getCustomData().get('isNew');\n\t\t\tconst immutableFields = [];\n\t\t\tthis.getImmutableFieldNames().forEach((key) => {\n\t\t\t\tif (!Type.isNil(item.getCustomData().get(key)))\n\t\t\t\t{\n\t\t\t\t\tthis.model.setField(key, item.getCustomData().get(key));\n\t\t\t\t\timmutableFields.push(key);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.selector.onProductSelect(\n\t\t\t\titem.getId(),\n\t\t\t\t\t{\n\t\t\t\t\t\tisNew,\n\t\t\t\t\t\timmutableFields,\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tthis.selector.clearLayout();\n\t\t\tthis.selector.layout();\n\t\t}\n\n\t\tthis.dialogMode = DialogMode.SHOW_PRODUCT_ITEM;\n\t\tthis.loadedSelectedItem = item;\n\t\tthis.cache.delete('dialog');\n\t}\n\n\tclearErrors()\n\t{\n\t\tconst errors = this.model.getErrorCollection().getErrors();\n\t\tfor (const code in errors)\n\t\t{\n\t\t\tif (ProductSelector.ErrorCodes.getCodes().includes(code))\n\t\t\t{\n\t\t\t\tthis.model.getErrorCollection().removeError(code);\n\t\t\t}\n\t\t}\n\t}\n\n\tcreateProductModelFromSearchQuery(searchQuery: string): ProductModel\n\t{\n\t\tconst fields = {...this.selector.getModel().getFields()};\n\t\tfields[this.inputName] = searchQuery;\n\n\t\treturn new ProductModel({\n\t\t\tisSimpleModel: true,\n\t\t\tisNew: true,\n\t\t\tcurrency: this.selector.options.currency,\n\t\t\tiblockId: this.selector.getModel().getIblockId(),\n\t\t\tbasePriceId: this.selector.getModel().getBasePriceId(),\n\t\t\tfields\n\t\t})\n\t}\n\n\tcreateProduct(event): ?Promise\n\t{\n\t\tif (this.ajaxInProcess)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.ajaxInProcess = true;\n\t\tconst dialog: CustomDialog = event.getTarget();\n\t\tconst {searchQuery} = event.getData();\n\t\tconst newProduct = this.createProductModelFromSearchQuery(searchQuery.getQuery());\n\n\t\tEventEmitter.emit(this.selector, 'onBeforeCreate', {model: newProduct});\n\n\t\treturn new Promise(\n\t\t\t(resolve, reject) => {\n\t\t\t\tif (!this.checkCreationModel(newProduct))\n\t\t\t\t{\n\t\t\t\t\tthis.ajaxInProcess = false;\n\t\t\t\t\tdialog.hide();\n\t\t\t\t\treject();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tdialog.showLoader();\n\t\t\t\tnewProduct.save()\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tdialog.hideLoader();\n\t\t\t\t\t\tconst id = Text.toInteger(response.data.id);\n\t\t\t\t\t\tconst item = dialog.addItem({\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\tentityId: ProductSearchInput.SEARCH_TYPE_ID,\n\t\t\t\t\t\t\ttitle: searchQuery.getQuery(),\n\t\t\t\t\t\t\ttabs: dialog.getRecentTab().getId(),\n\t\t\t\t\t\t\tcustomData: {\n\t\t\t\t\t\t\t\tisNew: true,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.selector.getModel().setOption('isSimpleModel', false);\n\t\t\t\t\t\tthis.selector.getModel().setOption('isNew', true);\n\n\t\t\t\t\t\tthis.getImmutableFieldNames().forEach((name) => {\n\t\t\t\t\t\t\tthis.selector.getModel().setField(name, newProduct.getField(name));\n\t\t\t\t\t\t\tthis.selector.getModel().setOption(name, newProduct.getField(name));\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (item)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\titem.select();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdialog.hide();\n\t\t\t\t\t\tthis.cache.delete('dialog');\n\t\t\t\t\t\tthis.ajaxInProcess = false;\n\t\t\t\t\t\tthis.isHasDialogItems = true;\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t})\n\t\t\t\t\t.catch((errorResponse) => {\n\t\t\t\t\t\tdialog.hideLoader();\n\t\t\t\t\t\terrorResponse.errors.forEach((error) => {\n\t\t\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\t\t\tcontent: Tag.render`<div>${error.message}</div>`,\n\t\t\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.ajaxInProcess = false;\n\t\t\t\t\t\treject();\n\t\t\t\t\t});\n\t\t\t});\n\t}\n\n\tcheckCreationModel(creationModel: ProductModel): boolean\n\t{\n\t\treturn true;\n\t}\n\n\tshowChangeNotification(event): void\n\t{\n\t\tconst {query} = event.getData();\n\t\tconst options = {\n\t\t\ttitle: Loc.getMessage('CATALOG_SELECTOR_SAVING_NOTIFICATION_' + this.selector.getType()),\n\t\t\tevents: {\n\t\t\t\tonSave: () => {\n\t\t\t\t\tif (this.selector)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selector.getModel().setField(this.inputName, query);\n\t\t\t\t\t\tthis.selector.getModel().save([this.inputName])\n\t\t\t\t\t\t\t.catch((errorResponse) => {\n\t\t\t\t\t\t\t\terrorResponse.errors.forEach((error) => {\n\t\t\t\t\t\t\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\t\t\t\t\t\t\tcloseButton: true,\n\t\t\t\t\t\t\t\t\t\tcontent: Tag.render`<div>${error.message}</div>`,\n\t\t\t\t\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\n\t\tif (this.selector.getConfig('ROLLBACK_INPUT_AFTER_CANCEL', false))\n\t\t{\n\t\t\toptions.declineCancelTitle = Loc.getMessage('CATALOG_SELECTOR_SAVING_NOTIFICATION_CANCEL_TITLE');\n\t\t\toptions.events.onCancel = () => {\n\t\t\t\tthis.selector.clearLayout();\n\t\t\t\tthis.selector.layout();\n\t\t\t};\n\t\t}\n\n\t\tthis.selector.getModel().showSaveNotifier(\n\t\t\t'nameChanger_' + this.selector.getId(),\n\t\t\toptions\n\t\t);\n\t}\n\n\tgetPlaceholder(): string\n\t{\n\t\treturn (\n\t\t\tthis.isSearchEnabled() && this.model.isEmpty()\n\t\t\t\t? Loc.getMessage('CATALOG_SELECTOR_BEFORE_SEARCH_TITLE')\n\t\t\t\t: Loc.getMessage('CATALOG_SELECTOR_VIEW_NAME_TITLE')\n\t\t);\n\t}\n\n\tremoveSpotlight()\n\t{\n\t}\n\n\tremoveQrAuth()\n\t{\n\t}\n}","import {Runtime, Tag, Text, Type} from 'main.core';\nimport './component.css';\nimport {ProductSelector} from './product-selector';\n\nexport class ProductImageInput\n{\n\tconstructor(id, options = {})\n\t{\n\t\tthis.id = id || Text.getRandom();\n\t\tthis.selector = options.selector || null;\n\t\tif (!(this.selector instanceof ProductSelector))\n\t\t{\n\t\t\tthrow new Error('Product selector instance not found.');\n\t\t}\n\n\t\tthis.config = options.config || {};\n\n\t\tif (!Type.isStringFilled(this.selector.getModel()?.getImageCollection().getEditInput()))\n\t\t{\n\t\t\tthis.restoreDefaultInputHtml();\n\t\t}\n\n\t\tthis.enableSaving = options.enableSaving;\n\n\t\tthis.uploaderFieldMap = {};\n\t}\n\n\tgetId()\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetId(id)\n\t{\n\t\tthis.id = id;\n\t}\n\n\tsetView(html): void\n\t{\n\t\tthis.selector.getModel()?.getImageCollection().setPreview(html);\n\t}\n\n\tsetInputHtml(html): void\n\t{\n\t\tthis.selector.getModel()?.getImageCollection().setEditInput(html);\n\t}\n\n\trestoreDefaultInputHtml(): void\n\t{\n\t\tconst defaultInput = `\n\t\t\t<div class='ui-image-input-container ui-image-input-img--disabled'>\n\t\t\t\t<div class='adm-fileinput-wrapper '>\n\t\t\t\t\t<div class='adm-fileinput-area mode-pict adm-fileinput-drag-area'></div>\n\t\t\t\t</div>\n\t\t\t</div>\n`\t\t;\n\n\t\tthis.selector.getModel()?.getImageCollection().setEditInput(defaultInput);\n\t\tthis.selector.getModel()?.getImageCollection().setPreview(defaultInput);\n\t}\n\n\tisViewMode(): boolean\n\t{\n\t\treturn this.selector && (this.selector.isViewMode() || !this.selector.model.isSaveable());\n\t}\n\n\tisEnabledLiveSaving(): boolean\n\t{\n\t\treturn this.enableSaving;\n\t}\n\n\tlayout(): HTMLElement\n\t{\n\t\tconst imageContainer = Tag.render`<div></div>`;\n\t\tconst html =\n\t\t\tthis.isViewMode()\n\t\t\t\t? this.selector.getModel()?.getImageCollection()?.getPreview()\n\t\t\t\t: this.selector.getModel()?.getImageCollection()?.getEditInput()\n\t\t;\n\n\t\tRuntime.html(imageContainer, html);\n\n\t\treturn imageContainer;\n\t}\n}","import {Loc, Tag, Dom, Type} from 'main.core';\nimport {BaseEvent} from \"main.core.events\";\nimport ProductSearchSelectorFooter from \"./product-search-selector-footer\";\n\nexport class BarcodeSearchSelectorFooter extends ProductSearchSelectorFooter\n{\n\tconstructor(id, options = {})\n\t{\n\t\tsuper(id, options);\n\t\tthis.isEmptyBarcode = options.isEmptyBarcode;\n\t\tthis.getDialog().subscribe('SearchTab:onLoad', this.handleOnSearchLoad.bind(this));\n\t}\n\n\tgetContent(): HTMLElement\n\t{\n\t\tthis.barcodeContent = super.getContent();\n\t\tthis.scannerContent = this.getScannerContent();\n\t\tDom.style(this.barcodeContent, 'display', 'none');\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"catalog-footers-container\">\n\t\t\t\t${this.barcodeContent}\n\t\t\t\t${this.scannerContent}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tisViewEditButton(): boolean\n\t{\n\t\treturn !this.isEmptyBarcode && super.isViewEditButton();\n\t}\n\n\tgetScannerContent(): HTMLElement\n\t{\n\t\tconst phrase = Tag.render`\n\t\t\t<div>${Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_BARCODE')}</div>\n\t\t`;\n\n\t\tconst createButton = phrase.querySelector('create-button');\n\n\t\tDom.replace(createButton, this.getScannerLabelContainer());\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"ui-selector-search-footer-box\">\n\t\t\t\t${phrase}\n\t\t\t\t${this.getLoaderContainer()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetScannerLabelContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('scannerLabel', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span onclick=\"${this.handleScannerClick.bind(this)}\">\n\t\t\t\t\t<span class=\"ui-selector-footer-link ui-selector-footer-link-add footer-link--warehouse-barcode-icon\">\n\t\t\t\t\t\t${Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_BARCODE_START_SCAN_LABEL')}\n\t\t\t\t\t</span>\n\t\t\t\t\t${this.getScannerQueryContainer()}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetScannerQueryContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('scanner_name-container', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span class=\"ui-selector-search-footer-query\"></span>\n\t\t\t`;\n\t\t});\n\t}\n\n\thandleScannerClick(): void\n\t{\n\t\tconst inputEntity = this.options?.inputEntity;\n\t\tif (inputEntity)\n\t\t{\n\t\t\tinputEntity.startMobileScanner();\n\t\t}\n\t}\n\n\thandleOnSearch(event: BaseEvent): void\n\t{\n\t\tconst { query } = event.getData();\n\n\t\tif (!Type.isStringFilled(query))\n\t\t{\n\t\t\tthis.show();\n\t\t\tDom.style(this.scannerContent, 'display', '');\n\t\t\tDom.style(this.barcodeContent, 'display', 'none');\n\t\t}\n\t\telse if (this.options.currentValue === query)\n\t\t{\n\t\t\tthis.hide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.show();\n\t\t\tDom.style(this.barcodeContent, 'display', '');\n\t\t\tDom.style(this.scannerContent, 'display', 'none');\n\t\t}\n\n\t\tthis.getQueryContainer().textContent = \" \" + query;\n\t\tthis.getScannerQueryContainer().textContent = \" \" + query;\n\t}\n\n\thandleOnSearchLoad(event: BaseEvent): void\n\t{\n\t\tconst {searchTab} = event.getData();\n\t\tthis.getDialog().getItems().forEach(item => {\n\t\t\tif (item.getCustomData().get('BARCODE') === searchTab.getLastSearchQuery().getQuery())\n\t\t\t{\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t});\n\t}\n}","import {Extension, Loc, Tag, Type, Text, Dom, Event, userOptions, ajax} from 'main.core';\nimport {Dialog, Item} from 'ui.entity-selector';\nimport './component.css';\nimport {EventEmitter} from 'main.core.events';\nimport {ProductModel} from 'catalog.product-model';\nimport ProductCreationLimitedFooter from './product-creation-limited-footer';\nimport {ProductSearchInput} from './product-search-input';\nimport {ProductSelector} from './product-selector';\nimport {BarcodeScanner} from 'catalog.barcode-scanner';\nimport 'ui.notification';\nimport {BarcodeSearchSelectorFooter} from './barcode-search-selector-footer';\nimport {QrAuthorization} from 'ui.qrauthorization';\nimport {SelectorErrorCode} from './selector-error-code';\nimport 'spotlight';\nimport {Guide} from 'ui.tour';\n\nexport class BarcodeSearchInput extends ProductSearchInput\n{\n\tstatic SEARCH_TYPE_ID = 'barcode';\n\n\tonFocusHandler = this.handleFocusEvent.bind(this);\n\tonBlurHandler = this.handleBlurEvent.bind(this);\n\n\tconstructor(id, options = {})\n\t{\n\t\tsuper(id, options);\n\n\t\tthis.focused = false;\n\t\tthis.settingsCollection = Extension.getSettings('catalog.product-selector');\n\n\t\tthis.isInstalledMobileApp =\n\t\t\tthis.selector.getConfig('IS_INSTALLED_MOBILE_APP')\n\t\t\t|| this.settingsCollection.get('isInstallMobileApp')\n\t\t;\n\n\t\tif (\n\t\t\t!this.settingsCollection.get('isEnabledQrAuth')\n\t\t\t&& this.selector.getConfig('ENABLE_BARCODE_QR_AUTH', true)\n\t\t)\n\t\t{\n\t\t\tthis.qrAuth = new QrAuthorization();\n\t\t\tthis.qrAuth.createQrCodeImage();\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tEvent.unbind(this.getNameInput(), 'focus', this.onFocusHandler);\n\t\tEvent.unbind(this.getNameInput(), 'blur', this.onBlurHandler);\n\t}\n\n\thandleFocusEvent()\n\t{\n\t\tthis.focused = true;\n\t}\n\n\thandleBlurEvent()\n\t{\n\t\tthis.focused = false;\n\t}\n\n\tisSearchEnabled(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\tshowDetailLink(): boolean\n\t{\n\t\treturn false\n\t}\n\n\tgetNameBlock(): HTMLElement\n\t{\n\t\treturn this.cache.remember('nameBlock', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t\t\t${this.getNameInput()}\n\t\t\t\t\t${this.getHiddenNameInput()}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tgetDialog(): ?Dialog\n\t{\n\t\treturn this.cache.remember('dialog', () => {\n\t\t\tconst entity = {\n\t\t\t\tid: BarcodeSearchInput.SEARCH_TYPE_ID,\n\t\t\t\toptions: {\n\t\t\t\t\tiblockId: this.model.getIblockId(),\n\t\t\t\t\tbasePriceId: this.model.getBasePriceId(),\n\t\t\t\t\tcurrency: this.model.getCurrency(),\n\t\t\t\t},\n\t\t\t\tdynamicLoad: true,\n\t\t\t\tdynamicSearch: true,\n\t\t\t\tsearchFields: [\n\t\t\t\t\t{ name: 'title', type: 'string', system: true, searchable: false },\n\t\t\t\t],\n\t\t\t};\n\n\t\t\tconst restrictedProductTypes = this.selector.getConfig('RESTRICTED_PRODUCT_TYPES', null);\n\t\t\tif (!Type.isNil(restrictedProductTypes))\n\t\t\t{\n\t\t\t\tentity.options.restrictedProductTypes = restrictedProductTypes;\n\t\t\t}\n\n\t\t\tconst params = {\n\t\t\t\tid: this.id + '_' + BarcodeSearchInput.SEARCH_TYPE_ID,\n\t\t\t\theight: 300,\n\t\t\t\twidth: Math.max(this.getNameInput()?.offsetWidth, 565),\n\t\t\t\tcontext: null,\n\t\t\t\ttargetNode: this.getNameInput(),\n\t\t\t\tenableSearch: false,\n\t\t\t\tmultiple: false,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tsearchTabOptions: {\n\t\t\t\t\tstub: true,\n\t\t\t\t\tstubOptions: {\n\t\t\t\t\t\ttitle: Tag.message`${'CATALOG_SELECTOR_IS_EMPTY_TITLE'}`,\n\t\t\t\t\t\tsubtitle:\n\t\t\t\t\t\t\tthis.isAllowedCreateProduct()\n\t\t\t\t\t\t\t\t? Tag.message`${'CATALOG_SELECTOR_IS_EMPTY_SUBTITLE'}`\n\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t,\n\t\t\t\t\t\tarrow: true\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.onProductSelect.bind(this),\n\t\t\t\t\t'Search:onItemCreateAsync': this.createProduct.bind(this),\n\t\t\t\t\t'ChangeItem:onClick': this.showChangeNotification.bind(this),\n\t\t\t\t},\n\t\t\t\tentities: [entity]\n\t\t\t};\n\n\t\t\tif (this.model.getSkuId() && !Type.isStringFilled(this.model.getField(this.inputName)))\n\t\t\t{\n\t\t\t\tparams.preselectedItems = [[BarcodeSearchInput.SEARCH_TYPE_ID, this.model.getSkuId()]];\n\t\t\t}\n\n\t\t\tif (Type.isObject(this.settingsCollection.get('limitInfo')))\n\t\t\t{\n\t\t\t\tparams.footer = ProductCreationLimitedFooter;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tparams.footer = BarcodeSearchSelectorFooter;\n\t\t\t\tparams.footerOptions = {\n\t\t\t\t\tinputEntity: this,\n\t\t\t\t\tisEmptyBarcode: !this.model || !this.model.isCatalogExisted(),\n\t\t\t\t\tinputName: this.inputName,\n\t\t\t\t\terrorAdminHint: this.settingsCollection.get('errorAdminHint'),\n\t\t\t\t\tallowEditItem: this.isAllowedEditProduct(),\n\t\t\t\t\tallowCreateItem: this.isAllowedCreateProduct(),\n\t\t\t\t\tcreationLabel: Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_CREATE_WITH_BARCODE'),\n\t\t\t\t\tcurrentValue: this.getValue(),\n\t\t\t\t\tsearchOptions: {\n\t\t\t\t\t\tallowCreateItem: this.isAllowedCreateProduct(),\n\t\t\t\t\t\tfooterOptions: {\n\t\t\t\t\t\t\tlabel: Loc.getMessage('CATALOG_SELECTOR_SEARCH_POPUP_FOOTER_CREATE_WITH_BARCODE')\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn new Dialog(params);\n\t\t});\n\t}\n\n\tlayoutMobileQrPopup(): HTMLElement\n\t{\n\t\treturn this.cache.remember('qrMobilePopup', () => {\n\n\t\t\tconst closeIcon = Tag.render`<span class=\"popup-window-close-icon\"></span>`;\n\t\t\tEvent.bind(closeIcon, 'click', this.closeMobilePopup.bind(this));\n\n\t\t\tlet sendButton = '';\n\t\t\tlet helpButton = '';\n\t\t\tif (top.BX.Helper)\n\t\t\t{\n\t\t\t\thelpButton = Tag.render`\n\t\t\t\t\t<a class=\"product-selector-mobile-popup-link ui-btn ui-btn-light-border ui-btn-round\">\n\t\t\t\t\t\t${Loc.getMessage('CATALOG_SELECTOR_MOBILE_POPUP_HELP_BUTTON')}\n\t\t\t\t\t</a>\n\t\t\t\t`;\n\t\t\t\tEvent.bind(helpButton, 'click', () => {\n\t\t\t\t\ttop.BX.Helper.show(\"redirect=detail&code=14956818\");\n\t\t\t\t});\n\n\t\t\t\tsendButton = Tag.render`\n\t\t\t\t\t<a class=\"product-selector-mobile-popup-link ui-btn ui-btn-link\">\n\t\t\t\t\t\t${Loc.getMessage('CATALOG_SELECTOR_MOBILE_POPUP_SEND_PUSH_BUTTON')}\n\t\t\t\t\t</a>\n\t\t\t\t`;\n\n\t\t\t\tEvent.bind(sendButton, 'click', () => {\n\t\t\t\t\ttop.BX.Helper.show(\"redirect=detail&code=15042444\");\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div data-role=\"mobile-popup\">\n\t\t\t\t\t<div class=\"product-selector-mobile-popup-overlay\"></div>\n\t\t\t\t\t<div class=\"product-selector-mobile-popup-content\">\n\t\t\t\t\t\t<div class=\"product-selector-mobile-popup-title\">${Loc.getMessage('CATALOG_SELECTOR_MOBILE_POPUP_TITLE')}</div>\n\t\t\t\t\t\t<div class=\"product-selector-mobile-popup-text\">${Loc.getMessage('CATALOG_SELECTOR_MOBILE_POPUP_INSTRUCTION')}</div>\n\t\t\t\t\t\t<div class=\"product-selector-mobile-popup-qr\">\n\t\t\t\t\t\t\t${this.qrAuth.getQrNode()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"product-selector-mobile-popup-link-container\">\n\t\t\t\t\t\t\t${helpButton}\n\t\t\t\t\t\t\t${sendButton}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t${closeIcon}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t}\n\n\tcloseMobilePopup()\n\t{\n\t\tthis.removeQrAuth();\n\n\t\tajax\n\t\t\t.runAction(\n\t\t\t\t'catalog.ProductSelector.isInstalledMobileApp',\n\t\t\t\t{\n\t\t\t\t\tjson: {}\n\t\t\t\t}\n\t\t\t)\n\t\t\t.then((result) => {\n\t\t\t\tthis.selector.emit('onBarcodeQrClose', {});\n\n\t\t\t\tif (result.data === true)\n\t\t\t\t{\n\t\t\t\t\tthis.selector.emit('onBarcodeScannerInstallChecked', {});\n\t\t\t\t\tthis.isInstalledMobileApp = true;\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t\tuserOptions.save('product-selector', 'barcodeQrAuth', 'showed', 'Y');\n\t}\n\n\thandleClickNameInput(event: UIEvent)\n\t{\n\t\tif (this.qrAuth && this.getDialog().getContainer())\n\t\t{\n\t\t\tif (!Dom.hasClass(this.getDialog().getContainer(), 'qr-barcode-info'))\n\t\t\t{\n\t\t\t\tDom.addClass(this.getDialog().getContainer(),'qr-barcode-info');\n\t\t\t}\n\n\t\t\tif (this.getDialog().getContainer())\n\t\t\t{\n\t\t\t\tDom.append(this.layoutMobileQrPopup(), this.getDialog().getContainer());\n\t\t\t}\n\t\t}\n\n\t\tsuper.handleClickNameInput(event);\n\t}\n\n\tshowItems()\n\t{\n\t\tthis.searchInDialog();\n\t}\n\n\tonChangeValue(value: string)\n\t{\n\t\tconst fields = {};\n\n\t\tthis.getNameInput().title = value;\n\t\tthis.getNameInput().value = value;\n\n\t\tfields[this.inputName] = value;\n\n\t\tEventEmitter.emit('ProductSelector::onBarcodeChange', {\n\t\t\trowId: this.selector.getRowId(),\n\t\t\tfields\n\t\t});\n\n\t\tthis.selector.emit('onBarcodeChange', {value});\n\n\t\tif (this.selector.isEnabledAutosave())\n\t\t{\n\t\t\tthis.selector.getModel().setField(this.inputName, value);\n\t\t\tthis.selector.getModel().showSaveNotifier(\n\t\t\t\t'barcodeChanger_' + this.selector.getId(),\n\t\t\t\t{\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_SELECTOR_SAVING_NOTIFICATION_BARCODE'),\n\t\t\t\t\tdisableCancel: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSave: () => {\n\t\t\t\t\t\t\tif (this.selector)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.selector.getModel().save([this.inputName]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\tsearchInDialog(): void\n\t{\n\t\tconst searchQuery = this.getFilledValue().trim();\n\t\tthis.searchByBarcode(searchQuery);\n\t}\n\n\tsearchByBarcode(searchQuery: string = ''): void\n\t{\n\t\tif (!this.selector.isProductSearchEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst dialog = this.getDialog();\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdialog.removeItems();\n\t\tif (!Type.isStringFilled(searchQuery))\n\t\t{\n\t\t\tif (this.model && this.model.isCatalogExisted())\n\t\t\t{\n\t\t\t\tdialog.setPreselectedItems([[BarcodeSearchInput.SEARCH_TYPE_ID, this.model.getSkuId()]])\n\t\t\t\tdialog.loadState = 'UNSENT';\n\t\t\t\tdialog.load();\n\t\t\t}\n\t\t}\n\n\t\tdialog.show();\n\t\tdialog.search(searchQuery);\n\t}\n\n\thandleNameInputBlur(event: UIEvent)\n\t{\n\t\t// timeout to toggle clear icon handler while cursor is inside of name input\n\t\tsetTimeout(() => {\n\t\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\n\t\t\tif (this.showDetailLink() && Type.isStringFilled(this.getValue()))\n\t\t\t{\n\t\t\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\t\t\t\tthis.toggleIcon(this.getArrowIcon(), 'block');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.toggleIcon(this.getArrowIcon(), 'none');\n\t\t\t\tthis.toggleIcon(\n\t\t\t\t\tthis.getSearchIcon(),\n\t\t\t\t\tType.isStringFilled(this.getFilledValue()) ? 'none' : 'block'\n\t\t\t\t);\n\t\t\t}\n\t\t}, 200);\n\t}\n\n\tsetInputValueOnProductSelect(item: Item)\n\t{\n\t\titem.getDialog().getTargetNode().value = item.getSubtitle()\n\t}\n\n\tgetCreationProduct(name)\n\t{\n\t\tconst fields = {...this.selector.getModel().getFields()};\n\t\tfields[ProductSelector.INPUT_FIELD_NAME] = name;\n\n\t\treturn new ProductModel({\n\t\t\tisSimpleModel: true,\n\t\t\tisNew: true,\n\t\t\tcurrency: this.selector.options.currency,\n\t\t\tiblockId: this.selector.getModel().getIblockId(),\n\t\t\tbasePriceId: this.selector.getModel().getBasePriceId(),\n\t\t\tfields\n\t\t})\n\t}\n\n\tcreateProductModelFromSearchQuery(searchQuery: string)\n\t{\n\t\tconst model = super.createProductModelFromSearchQuery(searchQuery);\n\t\tmodel.setField(ProductSelector.INPUT_FIELD_NAME, Loc.getMessage('CATALOG_SELECTOR_NEW_BARCODE_PRODUCT_NAME'));\n\t\tmodel.setField(this.inputName, searchQuery);\n\n\t\treturn model;\n\t}\n\n\tcheckCreationModel(creationModel: ProductModel): boolean\n\t{\n\t\tif (!Type.isStringFilled(creationModel.getField(ProductSelector.INPUT_FIELD_NAME)))\n\t\t{\n\t\t\tthis.model.getErrorCollection().setError(\n\t\t\t\tSelectorErrorCode.NOT_SELECTED_PRODUCT,\n\t\t\t\tLoc.getMessage('CATALOG_SELECTOR_EMPTY_TITLE')\n\t\t\t);\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tgetPlaceholder(): string\n\t{\n\t\treturn (\n\t\t\tthis.isSearchEnabled() && this.model.isEmpty()\n\t\t\t\t? Loc.getMessage('CATALOG_SELECTOR_BEFORE_SEARCH_BARCODE_TITLE')\n\t\t\t\t: Loc.getMessage('CATALOG_SELECTOR_VIEW_BARCODE_TITLE')\n\t\t);\n\t}\n\n\thandleClearIconClick(event: UIEvent)\n\t{\n\t\tthis.toggleIcon(this.getClearIcon(), 'none');\n\t\tthis.onChangeValue('');\n\n\t\tthis.selector.focusName();\n\n\t\tevent.stopPropagation();\n\t\tevent.preventDefault();\n\t}\n\n\tstartMobileScanner(event)\n\t{\n\t\tif (this.isInstalledMobileApp)\n\t\t{\n\t\t\tthis.sendMobilePush(event);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.qrAuth)\n\t\t{\n\t\t\tthis.qrAuth = new QrAuthorization();\n\t\t\tthis.qrAuth.createQrCodeImage();\n\t\t}\n\n\t\tif (this.getDialog().isOpen())\n\t\t{\n\t\t\tthis.getDialog().hide();\n\t\t\tthis.getDialog().subscribeOnce('onHide', this.handleClickNameInput.bind(this));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.handleClickNameInput(event);\n\t\t}\n\t}\n\n\tsendMobilePush(event)\n\t{\n\t\tevent?.preventDefault();\n\t\tthis.getDialog().hide();\n\t\tthis.getNameInput().focus();\n\n\t\tif (!this.selector.isEnabledMobileScanning())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst token = this.selector.getMobileScannerToken();\n\t\tBarcodeScanner.open(token);\n\n\t\tconst repeatLink = Tag.render`<span class='ui-notification-balloon-action'>${Loc.getMessage('CATALOG_SELECTOR_SEND_PUSH_ON_SCANNER_NOTIFICATION_REPEAT')}</span>`;\n\t\tEvent.bind(repeatLink, 'click', this.sendMobilePush.bind(this));\n\n\t\tconst content = Tag.render`\n\t\t\t<div>\n\t\t\t\t<span>${Loc.getMessage('CATALOG_SELECTOR_SEND_PUSH_ON_SCANNER_NOTIFICATION')}</span>\n\t\t\t\t${repeatLink}\n\t\t\t</div>\n\t\t`;\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent,\n\t\t\tcategory: 'sending_push_barcode_scanner_notification',\n\t\t\tautoHideDelay: 5000,\n\t\t});\n\t}\n\n\tgetProductIdByBarcode(barcode)\n\t{\n\t\treturn ajax.runAction(\n\t\t\t'catalog.ProductSelector.getProductIdByBarcode',\n\t\t\t{\n\t\t\t\tjson: {\n\t\t\t\t\tbarcode: barcode,\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t}\n\n\tapplyScannerData(barcode)\n\t{\n\t\tthis.getProductIdByBarcode(barcode).then((response) => {\n\t\t\tconst productId = response?.data;\n\t\t\tif (productId)\n\t\t\t{\n\t\t\t\tthis.selectScannedBarcodeProduct(productId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.searchByBarcode(barcode);\n\t\t\t}\n\t\t\tthis.getNameInput().value = Text.encode(barcode);\n\t\t});\n\t}\n\n\tselectScannedBarcodeProduct(productId)\n\t{\n\t\tthis.toggleIcon(this.getSearchIcon(), 'none');\n\t\tthis.clearErrors();\n\t\tif (this.selector)\n\t\t{\n\t\t\tthis.selector.onProductSelect(\n\t\t\t\tproductId,\n\t\t\t\t{\n\t\t\t\t\tisNew: false,\n\t\t\t\t\timmutableFields: [],\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tthis.selector.clearLayout();\n\t\t\tthis.selector.layout();\n\t\t}\n\n\t\tthis.cache.delete('dialog');\n\t}\n\n\tgetBarcodeIcon(): HTMLElement\n\t{\n\t\treturn this.cache.remember('barcodeIcon', () => {\n\t\t\tconst barcodeIcon = Tag.render`\n\t\t\t\t<button\tclass=\"ui-ctl-before warehouse-barcode-icon\" title=\"${Loc.getMessage('CATALOG_SELECTOR_BARCODE_ICON_TITLE')}\"></button>\n\t\t\t`;\n\n\t\t\tif (\n\t\t\t\t!this.settingsCollection.get('isShowedBarcodeSpotlightInfo')\n\t\t\t\t&& this.settingsCollection.get('isAllowedShowBarcodeSpotlightInfo')\n\t\t\t\t&& this.selector.getConfig('ENABLE_INFO_SPOTLIGHT', true)\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.spotlight = new BX.SpotLight(\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'selector_barcode_scanner_info',\n\t\t\t\t\t\ttargetElement: barcodeIcon,\n\t\t\t\t\t\tautoSave: true,\n\t\t\t\t\t\ttargetVertex: \"middle-center\",\n\t\t\t\t\t\tzIndex: 200\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tthis.spotlight.show();\n\n\t\t\t\tEventEmitter.subscribe(this.spotlight, 'BX.SpotLight:onTargetEnter', () => {\n\t\t\t\t\tconst guide = new Guide({\n\t\t\t\t\t\tsteps: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttarget: barcodeIcon,\n\t\t\t\t\t\t\t\ttitle: Loc.getMessage('CATALOG_SELECTOR_BARCODE_SCANNER_FIRST_TIME_HINT_TITLE'),\n\t\t\t\t\t\t\t\ttext: Loc.getMessage('CATALOG_SELECTOR_BARCODE_SCANNER_FIRST_TIME_HINT_TEXT'),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t\tonEvents: true,\n\t\t\t\t\t});\n\n\t\t\t\t\tguide.getPopup().setAutoHide(true);\n\t\t\t\t\tguide.showNextStep();\n\t\t\t\t\tthis.selector.setConfig('ENABLE_INFO_SPOTLIGHT', false);\n\t\t\t\t\tthis.selector.emit('onSpotlightClose', {});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tEvent.bind(barcodeIcon, 'click', (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tif (this.qrAuth)\n\t\t\t\t{\n\t\t\t\t\tthis.handleClickNameInput(event);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.startMobileScanner(event);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn barcodeIcon;\n\t\t});\n\t}\n\n\tlayout(): HTMLElement\n\t{\n\t\tconst block = super.layout();\n\t\tDom.append(this.getBarcodeIcon(), block);\n\t\tthis.getNameInput().className += ' catalog-product-field-input-barcode';\n\t\tEvent.bind(this.getNameInput(), 'focus', this.onFocusHandler);\n\t\tEvent.bind(this.getNameInput(), 'blur', this.onBlurHandler);\n\n\t\treturn block;\n\t}\n\n\tremoveSpotlight()\n\t{\n\t\tif (this.spotlight)\n\t\t{\n\t\t\tthis.spotlight.close();\n\t\t}\n\t}\n\n\tremoveQrAuth()\n\t{\n\t\tconst mobilePopup = this.getDialog().getContainer()?.querySelector('[data-role=\"mobile-popup\"]');\n\t\tif (mobilePopup)\n\t\t{\n\t\t\tDom.remove(mobilePopup);\n\t\t\tif (Dom.hasClass(this.getDialog().getContainer(), 'qr-barcode-info'))\n\t\t\t{\n\t\t\t\tDom.removeClass(this.getDialog().getContainer(),'qr-barcode-info');\n\t\t\t}\n\t\t}\n\n\t\tthis.qrAuth = null;\n\t}\n}\n","import {ajax, Cache, Dom, Event, Extension, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\nimport 'ui.design-tokens';\nimport 'ui.forms';\nimport 'fileinput';\nimport 'ui.notification';\nimport {EventEmitter} from 'main.core.events';\nimport {SkuTree} from 'catalog.sku-tree';\nimport {ProductSearchInput} from \"./product-search-input\";\nimport {ProductImageInput} from \"./product-image-input\";\nimport {ProductModel, RightActionDictionary} from \"catalog.product-model\";\nimport './component.css';\nimport {BarcodeSearchInput} from \"./barcode-search-input\";\nimport {SelectorErrorCode} from \"./selector-error-code\";\n\nconst instances = new Map();\nconst iblockSkuTreeProperties = new Map();\n\nexport class ProductSelector extends EventEmitter\n{\n\tstatic MODE_VIEW = 'view';\n\tstatic MODE_EDIT = 'edit';\n\tstatic INPUT_FIELD_NAME = 'NAME';\n\tstatic INPUT_FIELD_BARCODE = 'BARCODE';\n\n\tstatic ErrorCodes = SelectorErrorCode;\n\t#inAjaxProcess = false;\n\tmode: ProductSelector.MODE_EDIT | ProductSelector.MODE_VIEW = ProductSelector.MODE_EDIT;\n\tcache = new Cache.MemoryCache();\n\ttype = ProductSelector.INPUT_FIELD_NAME;\n\tfileInput: ?ProductImageInput;\n\tsearchInput: ?ProductSearchInput;\n\tskuTreeInstance: ?SkuTree;\n\tmobileScannerToken = null;\n\n\tvariationChangeHandler = this.handleVariationChange.bind(this);\n\tonSaveImageHandler = this.onSaveImage.bind(this);\n\tonChangeFieldsHandler = Runtime.debounce(this.onChangeFields, 500, this);\n\tonUploaderIsInitedHandler = this.onUploaderIsInited.bind(this);\n\tonNameChangeFieldHandler = Runtime.debounce(this.onNameChange, 500, this);\n\n\tstatic getById(id: string): ?ProductSelector\n\t{\n\t\treturn instances.get(id) || null;\n\t}\n\n\tconstructor(id, options = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Catalog.ProductSelector');\n\n\t\tthis.id = id || Text.getRandom();\n\t\toptions.inputFieldName = options.inputFieldName || ProductSelector.INPUT_FIELD_NAME;\n\t\tthis.options = options || {};\n\t\tthis.settings = Extension.getSettings('catalog.product-selector');\n\n\t\tthis.type = this.options.type || ProductSelector.INPUT_FIELD_NAME;\n\n\t\tthis.setMode(options.mode);\n\n\t\tif (options.model && (options.model instanceof ProductModel))\n\t\t{\n\t\t\tthis.model = options.model;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.model = ProductModel.getById(this.id);\n\t\t}\n\n\t\tif (!(this.model instanceof ProductModel))\n\t\t{\n\t\t\tthis.model = new ProductModel(\n\t\t\t\t{\n\t\t\t\t\tcurrency: options.currency,\n\t\t\t\t\tiblockId: Text.toNumber(options.iblockId),\n\t\t\t\t\tbasePriceId: Text.toNumber(options.basePriceId),\n\t\t\t\t\tfields: options.fields,\n\t\t\t\t\tskuTree: options.skuTree,\n\t\t\t\t\tstoreMap: options.storeMap,\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis.model.getImageCollection().setMorePhotoValues(options.morePhotoValues);\n\t\tif (!Type.isNil(this.getConfig('DETAIL_PATH')))\n\t\t{\n\t\t\tthis.model.setDetailPath(this.getConfig('DETAIL_PATH'));\n\t\t}\n\n\t\tif (options.failedProduct)\n\t\t{\n\t\t\tthis.model.getErrorCollection().setError(\n\t\t\t\tSelectorErrorCode.FAILED_PRODUCT,\n\t\t\t\t''\n\t\t\t);\n\t\t}\n\n\t\tif (this.isShowableEmptyProductError())\n\t\t{\n\t\t\tthis.model.getErrorCollection().setError(\n\t\t\t\tSelectorErrorCode.NOT_SELECTED_PRODUCT,\n\t\t\t\tthis.getEmptySelectErrorMessage()\n\t\t\t);\n\t\t}\n\n\t\tif (options.fileView)\n\t\t{\n\t\t\tthis.model.getImageCollection().setPreview(options.fileView);\n\t\t}\n\t\tif (options.fileInput)\n\t\t{\n\t\t\tthis.model.getImageCollection().setEditInput(options.fileInput);\n\t\t}\n\n\t\tthis.layout();\n\n\t\tif (options.skuTree)\n\t\t{\n\t\t\tthis.updateSkuTree(options.skuTree);\n\t\t}\n\n\t\tif (options.scannerToken)\n\t\t{\n\t\t\tthis.setMobileScannerToken(options.scannerToken);\n\t\t}\n\n\t\tthis.subscribeEvents();\n\n\t\tinstances.set(this.id, this);\n\t}\n\n\tsetModel(model: ProductModel): void\n\t{\n\t\tthis.model = model;\n\t}\n\n\tgetModel(): ProductModel\n\t{\n\t\treturn this.model;\n\t}\n\n\tsetMode(mode: ProductSelector.MODE_VIEW | ProductSelector.MODE_EDIT ): void\n\t{\n\t\tif (!Type.isNil(mode))\n\t\t{\n\t\t\tthis.mode = mode === ProductSelector.MODE_VIEW ? ProductSelector.MODE_VIEW : ProductSelector.MODE_EDIT;\n\t\t}\n\t}\n\n\tisViewMode(): boolean\n\t{\n\t\treturn this.mode === ProductSelector.MODE_VIEW;\n\t}\n\n\tisSaveable(): boolean\n\t{\n\t\treturn !this.isViewMode() && this.model.isSaveable();\n\t}\n\n\tisEnabledAutosave(): boolean\n\t{\n\t\treturn this.isSaveable() && this.getConfig('ENABLE_AUTO_SAVE', false);\n\t}\n\n\tisEnabledMobileScanning(): boolean\n\t{\n\t\treturn !this.isViewMode() && this.getConfig('ENABLE_MOBILE_SCANNING', true);\n\t}\n\n\tgetEmptySelectErrorMessage()\n\t{\n\t\treturn this.checkProductAddRights()\n\t\t\t? Loc.getMessage('CATALOG_SELECTOR_SELECTED_PRODUCT_TITLE')\n\t\t\t: Loc.getMessage('CATALOG_SELECTOR_SELECT_PRODUCT_TITLE')\n\t\t;\n\t}\n\n\n\tgetMobileScannerToken(): string\n\t{\n\t\treturn this.mobileScannerToken || Text.getRandom(16);\n\t}\n\n\tcheckProductViewRights(): boolean\n\t{\n\t\treturn this.model.checkAccess(RightActionDictionary.ACTION_PRODUCT_VIEW) ?? true;\n\t}\n\n\tcheckProductEditRights(): boolean\n\t{\n\t\treturn this.model.checkAccess(RightActionDictionary.ACTION_PRODUCT_EDIT) ?? false;\n\t}\n\n\tcheckProductAddRights(): boolean\n\t{\n\t\treturn this.model.checkAccess(RightActionDictionary.ACTION_PRODUCT_ADD) ?? false;\n\t}\n\n\tsetMobileScannerToken(token: string): void\n\t{\n\t\tthis.mobileScannerToken = token;\n\t}\n\n\tremoveMobileScannerToken(): void\n\t{\n\t\tthis.mobileScannerToken = null;\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tgetType(): string\n\t{\n\t\treturn this.type;\n\t}\n\n\tgetConfig(name, defaultValue)\n\t{\n\t\treturn BX.prop.get(this.options.config, name, defaultValue);\n\t}\n\n\tsetConfig(name, value): this\n\t{\n\t\tthis.options.config[name] = value;\n\n\t\treturn this;\n\t}\n\n\tgetRowId(): string\n\t{\n\t\treturn this.getConfig('ROW_ID');\n\t}\n\n\tgetFileInput(): ProductImageInput\n\t{\n\t\tif (!this.fileInput)\n\t\t{\n\t\t\tthis.fileInput = new ProductImageInput(\n\t\t\t\tthis.options.fileInputId,\n\t\t\t\t{\n\t\t\t\t\tselector: this,\n\t\t\t\t\tenableSaving: this.getConfig('ENABLE_IMAGE_CHANGE_SAVING', false)\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\treturn this.fileInput;\n\t}\n\n\tisProductSearchEnabled(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_SEARCH', false)\n\t\t\t&& this.model.getIblockId() > 0\n\t\t\t&& this.checkProductViewRights()\n\t\t;\n\t}\n\n\tisSkuTreeEnabled(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_SKU_TREE', true) !== false;\n\t}\n\n\tisImageFieldEnabled(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_IMAGE_INPUT', true) !== false;\n\t}\n\n\tisShowableEmptyProductError(): boolean\n\t{\n\t\treturn this.isEnabledEmptyProductError() &&\n\t\t\t(\n\t\t\t\tthis.model.isEmpty() && this.model.isChanged()\n\t\t\t\t|| this.model.isSimple()\n\t\t\t);\n\t}\n\n\tisShowableErrors(): boolean\n\t{\n\t\treturn this.isEnabledEmptyProductError() || this.isEnabledEmptyImagesError();\n\t}\n\n\tisEnabledEmptyProductError(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_EMPTY_PRODUCT_ERROR', false);\n\t}\n\n\tisEnabledEmptyImagesError(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_EMPTY_IMAGES_ERROR', false);\n\t}\n\n\tisEnabledChangesRendering(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_CHANGES_RENDERING', true);\n\t}\n\n\tisInputDetailLinkEnabled(): boolean\n\t{\n\t\treturn this.getConfig('ENABLE_INPUT_DETAIL_LINK', false)\n\t\t\t&& Type.isStringFilled(this.model.getDetailPath())\n\t\t\t&& this.checkProductViewRights()\n\t\t;\n\t}\n\n\tgetWrapper(): HTMLElement\n\t{\n\t\tif (!this.wrapper)\n\t\t{\n\t\t\tthis.wrapper = document.getElementById(this.id);\n\t\t}\n\n\t\treturn this.wrapper;\n\t}\n\n\trenderTo(node)\n\t{\n\t\tthis.clearLayout();\n\t\tthis.wrapper = node;\n\t\tthis.layout();\n\t}\n\n\tlayout()\n\t{\n\t\tconst wrapper = this.getWrapper();\n\t\tif (!wrapper)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.defineWrapperClass(wrapper);\n\t\twrapper.innerHTML = '';\n\n\t\tconst block = Tag.render`<div class=\"catalog-product-field-inner\"></div>`;\n\t\tDom.append(this.layoutNameBlock(), block);\n\n\t\tif (this.getSkuTreeInstance())\n\t\t{\n\t\t\tDom.append(this.getSkuTreeInstance().layout(), block);\n\t\t}\n\n\t\tDom.append(this.getErrorContainer(), block);\n\n\t\tif (!this.isViewMode())\n\t\t{\n\t\t\tDom.append(block, wrapper);\n\t\t}\n\n\t\tif (this.isImageFieldEnabled())\n\t\t{\n\t\t\tif (!Reflection.getClass('BX.UI.ImageInput'))\n\t\t\t{\n\t\t\t\tajax\n\t\t\t\t\t.runAction(\t'catalog.productSelector.getFileInput', {\n\t\t\t\t\t\tjson:{\n\t\t\t\t\t\t\tiblockId: this.getModel().getIblockId()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tthis.layoutImage();\n\t\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.layoutImage();\n\t\t\t}\n\n\t\t\tDom.append(this.getImageContainer(), wrapper);\n\t\t}\n\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tDom.append(block, wrapper);\n\t\t}\n\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tDom.append(block, wrapper);\n\t\t}\n\n\t\tif (this.isShowableErrors)\n\t\t{\n\t\t\tthis.layoutErrors();\n\t\t}\n\n\t\tthis.subscribeToVariationChange();\n\t}\n\n\tfocusName(): this\n\t{\n\t\tif (this.searchInput)\n\t\t{\n\t\t\tthis.searchInput.focusName();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tgetImageContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('imageContainer', () => (\n\t\t\tTag.render`<div class=\"catalog-product-img\"></div>`\n\t\t));\n\t}\n\n\tgetErrorContainer(): HTMLElement\n\t{\n\t\treturn this.cache.remember('errorContainer', () => (\n\t\t\tTag.render`<div class=\"catalog-product-error\"></div>`\n\t\t));\n\t}\n\n\tlayoutErrors()\n\t{\n\t\tthis.getErrorContainer().innerHTML = '';\n\t\tthis.clearImageErrorBorder();\n\t\tif (!this.model.getErrorCollection().hasErrors())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst errors = this.model.getErrorCollection().getErrors();\n\t\tfor (const code in errors)\n\t\t{\n\t\t\tif (!ProductSelector.ErrorCodes.getCodes().includes(code))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (code === 'EMPTY_IMAGE')\n\t\t\t{\n\t\t\t\tthis.setImageErrorBorder();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.append(\n\t\t\t\t\tTag.render`<div class=\"catalog-product-error-item\">${errors[code].text}</div>`,\n\t\t\t\t\tthis.getErrorContainer()\n\t\t\t\t);\n\n\t\t\t\tif (this.searchInput)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(this.searchInput.getNameBlock(), 'ui-ctl-danger');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tsetImageErrorBorder()\n\t{\n\t\tDom.addClass(\n\t\t\tthis.getImageContainer().querySelector('.adm-fileinput-area'),\n\t\t\t'adm-fileinput-drag-area-error'\n\t\t);\n\t}\n\n\tclearImageErrorBorder()\n\t{\n\t\tDom.removeClass(\n\t\t\tthis.getImageContainer().querySelector('.adm-fileinput-area'),\n\t\t\t'adm-fileinput-drag-area-error'\n\t\t);\n\t}\n\n\tonUploaderIsInited()\n\t{\n\t\tif (this.isEnabledEmptyImagesError())\n\t\t{\n\t\t\trequestAnimationFrame(this.layoutErrors.bind(this));\n\t\t}\n\t}\n\n\tlayoutImage()\n\t{\n\t\tthis.getImageContainer().innerHTML = '';\n\t\tDom.append(this.getFileInput().layout(), this.getImageContainer());\n\t\tthis.refreshImageSelectorId = null;\n\t}\n\n\tclearState(): void\n\t{\n\t\tthis\n\t\t\t.getModel()\n\t\t\t.initFields({\n\t\t\t\tID: '',\n\t\t\t\tNAME: '',\n\t\t\t\tBARCODE: '',\n\t\t\t\tPRODUCT_ID: null,\n\t\t\t\tSKU_ID: null,\n\t\t\t})\n\t\t\t.setOption('isNew', false)\n\t\t;\n\n\t\tthis\n\t\t\t.getFileInput()\n\t\t\t.restoreDefaultInputHtml()\n\t\t;\n\n\t\tthis\n\t\t\t.getModel()\n\t\t\t.clearSkuTree()\n\t\t;\n\t\tthis.skuTreeInstance = null;\n\n\t\tthis\n\t\t\t.getModel()\n\t\t\t.getStoreCollection()\n\t\t\t.clear()\n\t\t;\n\t}\n\n\tclearLayout(): void\n\t{\n\t\tconst wrapper = this.getWrapper();\n\t\tif (wrapper)\n\t\t{\n\t\t\twrapper.innerHTML = '';\n\t\t}\n\n\t\tthis.unsubscribeToVariationChange();\n\t}\n\n\tsubscribeEvents()\n\t{\n\t\tEventEmitter.subscribe('ProductList::onChangeFields', this.onChangeFieldsHandler);\n\t\tEventEmitter.subscribe('ProductSelector::onNameChange', this.onNameChangeFieldHandler);\n\t\tEventEmitter.subscribe('Catalog.ImageInput::save', this.onSaveImageHandler);\n\t\tEventEmitter.subscribe('onUploaderIsInited', this.onUploaderIsInitedHandler);\n\t}\n\n\tunsubscribeEvents()\n\t{\n\t\tthis.unsubscribeToVariationChange();\n\n\t\tEventEmitter.unsubscribe('Catalog.ImageInput::save', this.onSaveImageHandler);\n\t\tEventEmitter.unsubscribe('ProductList::onChangeFields', this.onChangeFieldsHandler);\n\t\tEventEmitter.unsubscribe('onUploaderIsInited', this.onUploaderIsInitedHandler);\n\t\tEventEmitter.unsubscribe('onUploaderIsInited', this.onUploaderIsInitedHandler);\n\t\tEventEmitter.unsubscribe('ProductSelector::onNameChange', this.onNameChangeFieldHandler);\n\t}\n\n\tdefineWrapperClass(wrapper)\n\t{\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tDom.addClass(wrapper, 'catalog-product-view');\n\t\t\tDom.removeClass(wrapper, 'catalog-product-edit');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(wrapper, 'catalog-product-edit');\n\t\t\tDom.removeClass(wrapper, 'catalog-product-view');\n\t\t}\n\t}\n\n\tgetNameBlockView(): HTMLElement\n\t{\n\t\tconst productName = Text.encode(this.model.getField('NAME'));\n\t\tconst namePlaceholder = Loc.getMessage('CATALOG_SELECTOR_VIEW_NAME_TITLE');\n\n\t\tif (this.getModel().getDetailPath())\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<a href=\"${this.getModel().getDetailPath()}\" title=\"${namePlaceholder}\">${productName}</a>\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`<span title=\"${namePlaceholder}\">${productName}</span>`;\n\n\t}\n\n\tgetNameInputFilledValue(): string\n\t{\n\t\tif (this.searchInput)\n\t\t{\n\t\t\treturn this.searchInput.getFilledValue();\n\t\t}\n\n\t\treturn '';\n\t}\n\n\tlayoutNameBlock(): HTMLElement\n\t{\n\t\tconst block = Tag.render`<div class=\"catalog-product-field-input\"></div>`;\n\n\t\tif (this.isViewMode())\n\t\t{\n\t\t\tDom.append(this.getNameBlockView(), block);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.getType() === ProductSelector.INPUT_FIELD_BARCODE)\n\t\t\t{\n\t\t\t\tif (!this.searchInput)\n\t\t\t\t{\n\t\t\t\t\tthis.searchInput = new BarcodeSearchInput(\n\t\t\t\t\t\tthis.id,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tselector: this,\n\t\t\t\t\t\t\tmodel: this.getModel(),\n\t\t\t\t\t\t\tinputName: this.options.inputFieldName,\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.searchInput = new ProductSearchInput(\n\t\t\t\t\tthis.id,\n\t\t\t\t\t{\n\t\t\t\t\t\tselector: this,\n\t\t\t\t\t\tmodel: this.getModel(),\n\t\t\t\t\t\tinputName: this.options.inputFieldName,\n\t\t\t\t\t\tisSearchEnabled: this.isProductSearchEnabled(),\n\t\t\t\t\t\tisEnabledEmptyProductError: this.isEnabledEmptyProductError(),\n\t\t\t\t\t\tisEnabledDetailLink: this.isInputDetailLinkEnabled()\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tDom.append(this.searchInput.layout(), block);\n\t\t}\n\n\t\treturn block;\n\t}\n\n\tsearchInDialog(): ProductSelector\n\t{\n\t\tthis.searchInput.searchInDialog();\n\n\t\treturn this;\n\t}\n\n\tupdateSkuTree(tree): ProductSelector\n\t{\n\t\tthis.getModel().setSkuTree(tree);\n\t\tthis.skuTreeInstance = null;\n\n\t\treturn this;\n\t}\n\n\tgetIblockSkuTreeProperties(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif (iblockSkuTreeProperties.has(this.getModel().getIblockId()))\n\t\t\t{\n\t\t\t\tresolve(iblockSkuTreeProperties.get(this.getModel().getIblockId()));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tajax.runAction(\n\t\t\t\t\t'catalog.productSelector.getSkuTreeProperties',\n\t\t\t\t\t{\n\t\t\t\t\t\tjson: {\n\t\t\t\t\t\t\tiblockId: this.getModel().getIblockId(),\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t\t.then(response => {\n\t\t\t\t\t\tiblockSkuTreeProperties.set(this.getModel().getIblockId(), response)\n\t\t\t\t\t\tresolve(response);\n\t\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tgetSkuTreeInstance(): SkuTree\n\t{\n\t\tif (this.isSkuTreeEnabled() && this.getModel()?.getSkuTree() && !this.skuTreeInstance)\n\t\t{\n\t\t\tthis.skuTreeInstance = new SkuTree({\n\t\t\t\tskuTree: this.getModel().getSkuTree(),\n\t\t\t\tselectable: this.getConfig('ENABLE_SKU_SELECTION', true),\n\t\t\t\thideUnselected: this.getConfig('HIDE_UNSELECTED_ITEMS', false),\n\t\t\t});\n\t\t}\n\n\t\treturn this.skuTreeInstance;\n\t}\n\n\tsubscribeToVariationChange()\n\t{\n\t\tconst skuTree = this.getSkuTreeInstance();\n\t\tif (skuTree)\n\t\t{\n\t\t\tthis.unsubscribeToVariationChange();\n\t\t\tskuTree.subscribe('SkuProperty::onChange', this.variationChangeHandler);\n\t\t}\n\t}\n\n\tunsubscribeToVariationChange()\n\t{\n\t\tconst skuTree = this.getSkuTreeInstance();\n\t\tif (skuTree)\n\t\t{\n\t\t\tskuTree.unsubscribe('SkuProperty::onChange', this.variationChangeHandler);\n\t\t}\n\t}\n\n\thandleVariationChange(event)\n\t{\n\t\tconst [skuFields] = event.getData();\n\t\tconst productId = Text.toNumber(skuFields.PARENT_PRODUCT_ID);\n\t\tconst variationId = Text.toNumber(skuFields.ID);\n\n\t\tif (productId <= 0 || variationId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.emit('onBeforeChange', {\n\t\t\tselectorId: this.getId(),\n\t\t\trowId: this.getRowId()\n\t\t});\n\n\t\tthis.#inAjaxProcess = true;\n\t\tajax.runAction(\n\t\t\t'catalog.productSelector.getSelectedSku',\n\t\t\t{\n\t\t\t\tjson: {\n\t\t\t\t\tvariationId,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tpriceId: this.basePriceId,\n\t\t\t\t\t\tcurrency: this.model.getCurrency(),\n\t\t\t\t\t\turlBuilder: this.getConfig('URL_BUILDER_CONTEXT')\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t)\n\t\t\t.then(response => this.processResponse(response, {...this.options.config}));\n\t}\n\n\tonChangeFields(event)\n\t{\n\t\tconst eventData = event.getData();\n\n\t\tif (eventData.rowId !== this.getRowId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fields = eventData.fields;\n\t\tthis.getModel().setFields(fields);\n\t}\n\n\treloadFileInput()\n\t{\n\t\tajax\n\t\t\t.runAction(\t'catalog.productSelector.getFileInput', {\n\t\t\t\tjson:{\n\t\t\t\t\tiblockId: this.getModel().getIblockId(),\n\t\t\t\t\tskuId: this.getModel()?.getSkuId()\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then((event) => {\n\t\t\t\tthis.getModel().getImageCollection().setEditInput(event.data.html);\n\t\t\t\tif (this.isImageFieldEnabled())\n\t\t\t\t{\n\t\t\t\t\tthis.layoutImage();\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tonNameChange(event)\n\t{\n\t\tconst eventData = event.getData();\n\n\t\tif (eventData.rowId !== this.getRowId() || !this.isEnabledAutosave())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst fields = eventData.fields;\n\t\tthis.getModel().setFields(fields);\n\t\tthis.getModel().save().then(() => {\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tid: 'saving_field_notify_name',\n\t\t\t\tcloseButton: false,\n\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CATALOG_SELECTOR_SAVING_NOTIFICATION_NAME_CHANGED')}</div>`,\n\t\t\t\tautoHide: true,\n\t\t\t});\n\t\t});\n\t}\n\n\tonSaveImage(event)\n\t{\n\t\tconst [, inputId, response] = event.getData();\n\t\tif (inputId !== this.getFileInput().getId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getFileInput().setId(response.data.id);\n\t\tthis.getFileInput().setInputHtml(response.data.input);\n\t\tthis.getFileInput().setView(response.data.preview);\n\t\tthis.getModel().getImageCollection().setMorePhotoValues(response.data.values);\n\t\tif (this.isImageFieldEnabled())\n\t\t{\n\t\t\tthis.layoutImage();\n\t\t}\n\n\t\tthis.emit('onChange', {\n\t\t\tselectorId: this.id,\n\t\t\trowId: this.getRowId(),\n\t\t\tfields: this.getModel().getFields(),\n\t\t\tmorePhoto: this.getModel().getImageCollection().getMorePhotoValues(),\n\t\t});\n\t}\n\n\tinProcess()\n\t{\n\t\treturn this.#inAjaxProcess;\n\t}\n\n\tonProductSelect(productId, itemConfig)\n\t{\n\t\tthis.emit('onProductSelect', {\n\t\t\tselectorId: this.getId(),\n\t\t\trowId: this.getRowId()\n\t\t});\n\n\t\tthis.emit('onBeforeChange', {\n\t\t\tselectorId: this.getId(),\n\t\t\trowId: this.getRowId()\n\t\t});\n\n\t\tthis.productSelectAjaxAction(productId, itemConfig);\n\t}\n\n\tproductSelectAjaxAction(\n\t\tproductId,\n\t\titemConfig = {\n\t\t\tisNew: false,\n\t\t\timmutableFields: [],\n\t\t}\n\t)\n\t{\n\t\tthis.#inAjaxProcess = true\n\t\tajax\n\t\t\t.runComponentAction(\n\t\t\t\t'kitconsulting:crm.entity.extendedproduct.list', //crm.entity.extendedproduct.list\n\t\t\t\t'getProduct',\n\t\t\t\t{\n\t\t\t\t\tmode: 'ajax',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tproductId: productId,\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tpriceId: this.basePriceId,\n\t\t\t\t\t\t\tcurrency: this.model.getCurrency(),\n\t\t\t\t\t\t\turlBuilder: this.getConfig('URL_BUILDER_CONTEXT')\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t)\n\t\t\t.then(response => this.processResponse(response, {...this.options.config, ...itemConfig}, true));\n\t}\n\n\tprocessResponse(response, config = {}, isProductAction = false)\n\t{\n\t\tconst data = response?.data || null;\n\t\tconsole.log(data, config);\n\t\tthis.#inAjaxProcess = false;\n\n\t\tconst fields = data?.fields || [];\n\t\tif (Type.isArray(config.immutableFields))\n\t\t{\n\t\t\tconfig.immutableFields.forEach((field) => {\n\t\t\t\tfields[field] = this.getModel().getField(field);\n\t\t\t});\n\n\t\t\tdata.fields = fields;\n\t\t}\n\n\t\tif (isProductAction)\n\t\t{\n\t\t\tthis.clearState();\n\t\t}\n\n\t\tif (data)\n\t\t{\n\t\t\tthis.changeSelectedElement(data, config);\n\t\t}\n\t\telse if (!isProductAction)\n\t\t{\n\t\t\tthis.productSelectAjaxAction(this.getModel().getProductId());\n\t\t}\n\n\t\tthis.unsubscribeToVariationChange();\n\n\t\tif (this.isEnabledChangesRendering())\n\t\t{\n\t\t\tthis.clearLayout();\n\t\t\tthis.layout();\n\t\t}\n\n\t\tthis.emit('onChange', {\n\t\t\tselectorId: this.id,\n\t\t\trowId: this.getRowId(),\n\t\t\tisNew: config.isNew || false,\n\t\t\tfields,\n\t\t\tmorePhoto: this.getModel().getImageCollection().getMorePhotoValues(),\n\t\t});\n\t}\n\n\tchangeSelectedElement(data, config)\n\t{\n\t\tconst productId = Text.toInteger(data.productId);\n\t\tconst productChanged = this.getModel().getProductId() !== productId;\n\n\t\tif (productChanged)\n\t\t{\n\t\t\tthis.getModel().setOption('productId', productId);\n\t\t\tthis.getModel().setOption('skuId', Text.toInteger(data.skuId));\n\t\t\tthis.getModel().setOption('isSimpleModel', false);\n\t\t\tthis.getModel().setOption('isNew', config.isNew);\n\t\t}\n\n\t\tthis.getModel().initFields(data.fields);\n\n\t\tconst imageField = {\n\t\t\tid: '',\n\t\t\tinput: '',\n\t\t\tpreview: '',\n\t\t\tvalues: []\n\t\t};\n\n\t\tif (Type.isObject(data.image))\n\t\t{\n\t\t\timageField.id = data.image.id;\n\t\t\timageField.input = data.image.input;\n\t\t\timageField.preview = data.image.preview;\n\t\t\timageField.values = data.image.values;\n\t\t}\n\n\t\tthis.getFileInput().setId(imageField.id);\n\t\tthis.getFileInput().setInputHtml(imageField.input);\n\t\tthis.getFileInput().setView(imageField.preview);\n\n\t\tthis.getModel().getImageCollection().setMorePhotoValues(imageField.values);\n\t\tthis.checkEmptyImageError();\n\n\t\tif (data.detailUrl)\n\t\t{\n\t\t\tthis.getModel().setDetailPath(data.detailUrl);\n\t\t}\n\n\t\tif (Type.isObject(data.skuTree))\n\t\t{\n\t\t\tthis.updateSkuTree(data.skuTree);\n\t\t}\n\t}\n\n\tcheckEmptyImageError()\n\t{\n\t\tif (\n\t\t\t!Type.isArrayFilled(this.getModel().getImageCollection().getMorePhotoValues())\n\t\t\t&& this.isEnabledEmptyImagesError()\n\t\t)\n\t\t{\n\t\t\tthis.getModel().getErrorCollection().setError(\n\t\t\t\t'EMPTY_IMAGE',\n\t\t\t\tLoc.getMessage('CATALOG_SELECTOR_EMPTY_IMAGE_ERROR'),\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getModel().getErrorCollection().removeError('EMPTY_IMAGE');\n\t\t}\n\t}\n\n\tremoveSpotlight()\n\t{\n\t\tthis.searchInput?.removeSpotlight();\n\t\tthis.setConfig('ENABLE_INFO_SPOTLIGHT', false);\n\t}\n\n\tremoveQrAuth()\n\t{\n\t\tthis.searchInput?.removeQrAuth();\n\t\tthis.setConfig('ENABLE_BARCODE_QR_AUTH', false);\n\t}\n}\n","import { Event, Loc, Tag, Uri } from 'main.core';\nimport { Popup, PopupManager } from 'main.popup';\nimport { ProductModel } from \"catalog.product-model\";\n\nexport default class StoreAvailablePopup\n{\n\t#rowId;\n\t#model: ProductModel;\n\t#node: HTMLElement;\n\t#popup: ?Popup;\n\n\tconstructor(options)\n\t{\n\t\tthis.#rowId = options.rowId\n\t\tthis.#model = options.model;\n\t\tthis.setNode(options.node);\n\t}\n\n\tsetNode(node: HTMLElement)\n\t{\n\t\tthis.#node = node;\n\t\tthis.#node.classList.add('store-available-popup-link');\n\n\t\tEvent.bind(this.#node, 'click', this.togglePopup.bind(this));\n\t}\n\n\t#createPopup()\n\t{\n\t\tconst popupId = `store-available-popup-row-${this.#rowId}`;\n\t\tconst popup = PopupManager.getPopupById(popupId);\n\t\tif (popup)\n\t\t{\n\t\t\tthis.#popup = popup;\n\t\t\tthis.#popup.setBindElement(this.#node);\n\t\t\tthis.#popup.setContent(this.getPopupContent());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#popup = PopupManager.create({\n\t\t\t\tid: popupId,\n\t\t\t\tbindElement: this.#node,\n\t\t\t\tautoHide: true,\n\t\t\t\tdraggable: false,\n\t\t\t\toffsetLeft: -218,\n\t\t\t\toffsetTop: 0,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 250\n\t\t\t\t},\n\t\t\t\tnoAllPaddings: true,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true\n\t\t\t\t},\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tcontent: this.getPopupContent(),\n\t\t\t});\n\t\t}\n\t}\n\n\trefreshStoreInfo()\n\t{\n\t\tthis.#model.getStoreCollection().refresh();\n\t}\n\n\tgetPopupContent()\n\t{\n\t\tconst storeId = this.#model.getField('STORE_ID');\n\t\tconst storeCollection = this.#model.getStoreCollection();\n\n\t\tconst storeQuantity = storeCollection.getStoreAmount(storeId);\n\t\tconst reservedQuantity = storeCollection.getStoreReserved(storeId);\n\t\tconst availableQuantity = storeCollection.getStoreAvailableAmount(storeId);\n\n\t\tconst renderHead = (value) => {\n\t\t\treturn `<td class=\"main-grid-cell-head main-grid-col-no-sortable main-grid-cell-right\">\n\t\t\t\t<div class=\"main-grid-cell-inner\">\n\t\t\t\t\t<span class=\"main-grid-cell-head-container\">${value}</span>\n\t\t\t\t</div>\n\t\t\t</td>`;\n\t\t};\n\n\t\tconst renderRow = (value) => {\n\t\t\treturn `<td class=\"main-grid-cell main-grid-cell-right\">\n\t\t\t\t<div class=\"main-grid-cell-inner\">\n\t\t\t\t\t<span class=\"main-grid-cell-content\">${value}</span>\n\t\t\t\t</div>\n\t\t\t</td>`;\n\t\t};\n\n\t\tlet reservedQuantityLink =\n\t\t\treservedQuantity > 0\n\t\t\t? `<a href=\"#\" class=\"store-available-popup-reserves-slider-link\">${reservedQuantity}</a>`\n\t\t\t: reservedQuantity\n\t\t;\n\n\t\tconst result = Tag.render`\n\t\t\t<div class=\"store-available-popup-container\">\n\t\t\t\t<table class=\"main-grid-table\">\n\t\t\t\t\t<thead class=\"main-grid-header\">\n\t\t\t\t\t\t<tr class=\"main-grid-row-head\">\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_COMMON'))}\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_RESERVED'))}\n\t\t\t\t\t\t\t${renderHead(Loc.getMessage('CRM_ENTITY_PL_STORE_AVAILABLE_POPUP_QUANTITY_AVAILABLE'))}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<tr class=\"main-grid-row main-grid-row-body\">\n\t\t\t\t\t\t\t${renderRow(storeQuantity)}\n\t\t\t\t\t\t\t${renderRow(reservedQuantityLink)}\n\t\t\t\t\t\t\t${renderRow(availableQuantity)}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t`;\n\n\t\tif (reservedQuantity > 0)\n\t\t{\n\t\t\treservedQuantityLink = result.querySelector('.store-available-popup-reserves-slider-link');\n\t\t\tEvent.bind(reservedQuantityLink, 'click', (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.openDealsWithReservedProductSlider();\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}\n\n\topenDealsWithReservedProductSlider()\n\t{\n\t\tconst reservedDealsSliderLink = '/bitrix/components/bitrix/catalog.productcard.reserved.deal.list/slider.php';\n\n\t\tconst storeId = this.#model.getField('STORE_ID');\n\t\tconst productId = this.#model.getField('PRODUCT_ID');\n\n\t\tconst sliderLink = new Uri(reservedDealsSliderLink);\n\t\tsliderLink.setQueryParam('productId', productId);\n\t\tsliderLink.setQueryParam('storeId', storeId);\n\n\t\tBX.SidePanel.Instance.open(sliderLink.toString(), {\n\t\t\tallowChangeHistory: false,\n\t\t\tcacheable: false\n\t\t});\n\t}\n\n\ttogglePopup()\n\t{\n\t\tif (this.#popup)\n\t\t{\n\t\t\tif (this.#popup.isShown())\n\t\t\t{\n\t\t\t\tthis.#popup.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#popup.setContent(this.getPopupContent());\n\t\t\t\tthis.#popup.show();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#createPopup();\n\t\t\tthis.#popup.show();\n\t\t}\n\t}\n}\n","import {PopupWindow, PopupWindowManager} from \"main.popup\";\r\nimport {Row} from \"./product.list.row\";\r\n\r\nexport class ProductApplication\r\n{\r\n    _popupPrefix = 'application_popup_';\r\n    _gridPrefix = 'applications_grid_';\r\n    _productRow: ?Row = null;\r\n    _popup: ?PopupWindow = null;\r\n    _popupLoaded: boolean = false;\r\n\r\n    /*static unsetCheckbox(rowId)\r\n    {\r\n        let checkbox = null;\r\n\r\n        if ((checkbox = document.querySelector('[data-application-row-id=\"'+rowId+'\"]')) !== null) {\r\n            checkbox.checked = false;\r\n            delete checkbox.dataset.applicationRowId;\r\n        }\r\n    }*/\r\n\r\n    constructor(productRow: Row)\r\n    {\r\n        this._productRow = productRow;\r\n        let popupId = this.getPopupId(this._productRow.getId());\r\n        let popup = PopupWindowManager.getPopupById(popupId);\r\n\r\n        if (null === popup) {\r\n            popup = new PopupWindow(this.getPopupId(this._productRow.getId()), window.body,{\r\n                autoHide: true,\r\n                closeIcon: true,\r\n                closeByEsc: true,\r\n                overlay: {\r\n                    backgroundColor: 'grey', opacity: '80'\r\n                },\r\n                width: 800,\r\n                offsetLeft: 0,\r\n                offsetTop: 0\r\n            });\r\n        }\r\n        this._popup = popup;\r\n    }\r\n\r\n    getPopupId(productRowId)\r\n    {\r\n        return this._popupPrefix + productRowId;\r\n    }\r\n\r\n    showPopup()\r\n    {\r\n        let self = this;\r\n\r\n        if (!self._popupLoaded) {\r\n            BX.ajax.runComponentAction('kitconsulting:crm.entity.extendedproduct.applications', 'getApplications', {\r\n                mode: 'class',\r\n                data: {\r\n                    sessid: BX.bitrix_sessid(),\r\n                    ajax: 'Y',\r\n                    format: 'Y',\r\n                    raw: 'Y',\r\n                    productId: this._productRow.getModel().getField('PARENT_PRODUCT_ID', null)\r\n                        || this._productRow.getModel().getProductId(),\r\n                    rowId: this._productRow.getId().replace(this._productRow.getEditor().getRowIdPrefix(), '')\r\n                }\r\n            }).then(async (res) => {\r\n                let applicationsResponse = await res;\r\n                let table = self.createApplicationsTable(applicationsResponse.data);\r\n                self._popup.setContent(table);\r\n                self._popupLoaded = true;\r\n                self._popup.show();\r\n                self.applyListeners();\r\n            });\r\n        } else {\r\n            self._popup.show();\r\n        }\r\n    }\r\n\r\n    createApplicationsTable(data)\r\n    {\r\n        let container = document.createElement('DIV');\r\n        let table = document.createElement('TABLE');\r\n        let head = document.createElement('THEAD');\r\n        let headRow = document.createElement('TR');\r\n        let body = document.createElement('TBODY');\r\n        let useAdvPrice = false;\r\n\r\n        if (BX.Crm.EntityEditor.defaultInstance.getOwnerInfo().ownerType.startsWith('DEAL')) {\r\n            let control = BX.Crm.EntityEditor.defaultInstance.getActiveControlById(\"UF_ADV_AGENT\")\r\n\r\n            if (control != null) {\r\n                useAdvPrice = control.getContainer().querySelector('input[type=\"checkbox\"]').checked;\r\n            } else {\r\n                useAdvPrice = BX.Crm.EntityEditor.defaultInstance.getModel().getField(\"UF_ADV_AGENT\").VALUE != \"0\";\r\n            }\r\n        }\r\n\r\n        container.id = this.getTableId(this._productRow.getId());\r\n        container.append(table);\r\n        table.append(head);\r\n        head.append(headRow);\r\n        table.append(body);\r\n\r\n        data.columnNames.forEach((columnName) => {\r\n            let headColumn = document.createElement('TH');\r\n\r\n            headColumn.innerText = columnName;\r\n            headRow.append(headColumn);\r\n        });\r\n\r\n        data.applications.forEach((elem) => {\r\n            let bodyRow = document.createElement('TR');\r\n            let checkboxColumn = document.createElement('TD');\r\n            let checkbox = document.createElement('INPUT');\r\n            let nameColumn = document.createElement('TD');\r\n\r\n            checkbox.setAttribute('type', 'checkbox');\r\n            checkbox.setAttribute('value', elem['APPLICATION_ID']);\r\n            checkbox.dataset.price = useAdvPrice ? elem['APPLICATION_PRICE_ADV'] : elem['APPLICATION_PRICE_OPT'];\r\n            checkbox.classList.add('product_application_checkbox');\r\n\r\n            if (elem['APPLICATION_PRODUCT_ROW'] != null && this._productRow.getEditor().getProductById(elem['APPLICATION_PRODUCT_ROW']['ID']) != null) {\r\n                checkbox.checked = true;\r\n                //checkbox.dataset.applicationRowId = elem['APPLICATION_PRODUCT_ROW']['ID'];\r\n            }\r\n            checkboxColumn.append(checkbox)\r\n            bodyRow.append(checkboxColumn);\r\n            nameColumn.innerText = elem['APPLICATION_NAME']\r\n            if (elem.PRODUCT_HAS)\r\n                nameColumn.classList.add(\"product-bold\");\r\n            bodyRow.append(nameColumn);\r\n            body.append(bodyRow);\r\n        });\r\n\r\n        return container;\r\n    }\r\n\r\n    applyListeners()\r\n    {\r\n        let tableElement = document.querySelector(\"#\"+ this.getTableId(this._productRow.getId()));\r\n\r\n        tableElement.querySelectorAll('.product_application_checkbox')\r\n            .forEach((elem, id) => {\r\n                elem.addEventListener('change', this.changeApplication.bind(this));\r\n            });\r\n    }\r\n\r\n    destroy()\r\n    {\r\n        document.getElementById(this.getTableId(this._productRow.getId())).remove()\r\n        this._popup.destroy();\r\n    }\r\n\r\n    getTableId(productRowId)\r\n    {\r\n        return this._gridPrefix + productRowId;\r\n    }\r\n\r\n    changeApplication(event)\r\n    {\r\n        let editor = this._productRow.getEditor();\r\n\r\n        if (event.target.checked) {\r\n            let adjustedProduct = this._productRow.getAdjustedProductRow();\r\n            let id = editor.addProductRowAfter(adjustedProduct || this._productRow);\r\n            let productRow = editor.getProductById(id);\r\n            let selector = editor.getProductSelector(id);\r\n\r\n            selector.onProductSelect(event.target.value);\r\n            productRow.setField(\r\n                'UF_APPLICATION_PARENT_PRODUCT_ROW_ID',\r\n                this._productRow.getId().replace(editor.getRowIdPrefix(), '')\r\n            );\r\n            productRow.setApplicationPrice(event.target.dataset.price);\r\n            productRow.disableUiField('UF_NEED_ADJUSTMENT');\r\n            productRow.disableUiField('UF_CRM_PR_ADJUSTMENT');\r\n            productRow.getNode().querySelector('[data-field-code=\"UF_APPLICATION_PRICE\"]').style.display = null;\r\n            editor.numerateRows();\r\n            //event.target.dataset.applicationRowId = id;\r\n        } else {\r\n            editor.deleteApplicationsForRow(this._productRow.getField('ID'), event.target.value);\r\n            editor.numerateRows();\r\n            //delete event.target.dataset.applicationRowId;\r\n        }\r\n    }\r\n}","import {ajax, Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\r\nimport {Editor} from './product.list.editor';\r\nimport {DiscountType, DiscountTypes, FieldScheme, ProductCalculator} from 'catalog.product-calculator';\r\nimport {CurrencyCore} from 'currency.currency-core';\r\nimport 'ui.hint';\r\nimport 'ui.notification';\r\nimport HintPopup from './hint.popup';\r\nimport {ProductModel} from \"catalog.product-model\";\r\nimport {EventEmitter} from \"main.core.events\";\r\nimport {StoreSelector} from \"catalog.store-selector\";\r\nimport ReserveControl from \"./reserve.control\";\r\nimport {PopupMenu} from \"main.popup\";\r\nimport {ProductSelector} from './product-selector/product-selector';\r\nimport StoreAvailablePopup from './store.available.popup';\r\nimport {ProductApplication} from \"./product.application\";\r\n\r\ntype Action = {\r\n\ttype: string,\r\n\tfield?: string,\r\n\tvalue?: string,\r\n};\r\n\r\ntype Settings = {}\r\n\r\nconst MODE_EDIT = 'EDIT';\r\nconst MODE_SET = 'SET';\r\n\r\nexport class Row\r\n{\r\n\tstatic CATALOG_PRICE_CHANGING_DISABLED = 'CATALOG_PRICE_CHANGING_DISABLED';\r\n\r\n\tid: ?string;\r\n\tsettings: Object;\r\n\teditor: ?Editor;\r\n\tmodel: ?ProductModel;\r\n\tmainSelector: ?ProductSelector;\r\n\treserveControl: ?ReserveControl;\r\n\tstoreSelector: ?StoreSelector;\r\n\tstoreAvailablePopup: ?StoreAvailablePopup;\r\n\tfields: Object = {};\r\n\texternalActions: Array<Action> = [];\r\n\r\n\thandleFocusUnchangeablePrice = this.#showChangePriceNotify.bind(this);\r\n\thandleChangeStoreData = this.#onChangeStoreData.bind(this);\r\n\thandleProductErrorsChange = Runtime.debounce(this.#onProductErrorsChange, 500, this);\r\n\thandleMainSelectorClear = Runtime.debounce(this.#onMainSelectorClear.bind(this), 500, this);\r\n\t// handleMainSelectorChange = Runtime.debounce(this.#onMainSelectorChange.bind(this), 500, this);\r\n\thandleMainSelectorChange = this.#onMainSelectorChange.bind(this);\r\n\thandleStoreFieldChange = Runtime.debounce(this.#onStoreFieldChange.bind(this), 500, this);\r\n\thandleStoreFieldClear = Runtime.debounce(this.#onStoreFieldClear.bind(this), 500, this);\r\n\thandleOnGridUpdated = this.#onGridUpdated.bind(this);\r\n\r\n\tcache = new Cache.MemoryCache();\r\n\tmodeChanges = {\r\n\t\tEDIT: MODE_EDIT,\r\n\t\tSET: MODE_SET,\r\n\t};\r\n\tonAfterExecuteExternalActions: ?CallableFunction;\r\n\t_productApplication: ?ProductApplication = null;\r\n\r\n\tconstructor(id: string, fields: Object, settings: Settings, editor: Editor): void\r\n\t{\r\n\t\tthis.setId(id);\r\n\t\tthis.setSettings(settings);\r\n\t\tthis.setEditor(editor);\r\n\t\tthis.setModel(fields, settings);\r\n\t\tthis.setFields(fields);\r\n\t\tthis.#initActions();\r\n\t\tthis.#initSelector();\r\n\t\tthis.#initStoreSelector();\r\n\t\tthis.#initStoreAvailablePopup();\r\n\t\tthis.#initReservedControl();\r\n\t\tthis.modifyBasePriceInput();\r\n\t\tthis.refreshFieldsLayout();\r\n\r\n\t\trequestAnimationFrame(this.initHandlers.bind(this));\r\n\t}\r\n\r\n\tgetNode(): ?HTMLElement\r\n\t{\r\n\t\treturn this.cache.remember('node', () => {\r\n\t\t\tconst rowId = this.getField('ID', 0);\r\n\r\n\t\t\treturn this.getEditorContainer().querySelector('[data-id=\"' + rowId + '\"]');\r\n\t\t});\r\n\t}\r\n\r\n\tgetSelector(): ?ProductSelector\r\n\t{\r\n\t\treturn this.mainSelector;\r\n\t}\r\n\r\n\tclearChanges()\r\n\t{\r\n\t\tthis.getModel().clearChangedList();\r\n\t}\r\n\r\n\tisNewRow(): Boolean\r\n\t{\r\n\t\treturn isNaN(+this.getField('ID'));\r\n\t}\r\n\r\n\tgetId(): string\r\n\t{\r\n\t\treturn this.id;\r\n\t}\r\n\r\n\tsetId(id: string): void\r\n\t{\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\tgetSettings()\r\n\t{\r\n\t\treturn this.settings;\r\n\t}\r\n\r\n\tsetSettings(settings: Settings): void\r\n\t{\r\n\t\tthis.settings = Type.isPlainObject(settings) ? settings : {};\r\n\t}\r\n\r\n\tgetSettingValue(name, defaultValue)\r\n\t{\r\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\r\n\t}\r\n\r\n\tsetSettingValue(name, value): void\r\n\t{\r\n\t\tthis.settings[name] = value;\r\n\t}\r\n\r\n\tsetEditor(editor: Editor): void\r\n\t{\r\n\t\tthis.editor = editor;\r\n\t}\r\n\r\n\tgetEditor(): Editor\r\n\t{\r\n\t\treturn this.editor;\r\n\t}\r\n\r\n\tgetEditorContainer(): HTMLElement\r\n\t{\r\n\t\treturn this.getEditor().getContainer();\r\n\t}\r\n\r\n\tgetHintPopup(): HintPopup\r\n\t{\r\n\t\treturn this.getEditor().getHintPopup();\r\n\t}\r\n\r\n\tinitHandlers()\r\n\t{\r\n\t\tconst editor = this.getEditor();\r\n\r\n\t\tthis.getNode().querySelectorAll('input').forEach((node) => {\r\n\t\t\t/*if (node.classList.contains('main-grid-row-checkbox')) {\r\n\t\t\t\tEvent.bind(node, 'change', this.changeMassActionField.bind(this));\r\n\t\t\t\treturn;\r\n\t\t\t}*/\r\n\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\r\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\r\n\t\t\t// disable drag-n-drop events for text fields\r\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\r\n\t\t});\r\n\t\tthis.getNode().querySelectorAll('select').forEach((node) => {\r\n\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\r\n\t\t\t// disable drag-n-drop events for select fields\r\n\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\r\n\t\t});\r\n\t}\r\n\r\n\tinitHandlersForSelectors()\r\n\t{\r\n\t\tconst editor = this.getEditor();\r\n\r\n\t\tconst selectorNames = ['MAIN_INFO', 'STORE_INFO', 'RESERVE_INFO'];\r\n\r\n\t\tselectorNames.forEach((name) => {\r\n\t\t\tthis.getNode().querySelectorAll('[data-name=\"'+ name +'\"] input[type=\"text\"]').forEach(node => {\r\n\t\t\t\tEvent.bind(node, 'input', editor.changeProductFieldHandler);\r\n\t\t\t\tEvent.bind(node, 'change', editor.changeProductFieldHandler);\r\n\t\t\t\t// disable drag-n-drop events for select fields\r\n\t\t\t\tEvent.bind(node, 'mousedown', (event) => event.stopPropagation());\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tunsubscribeCustomEvents()\r\n\t{\r\n\t\tif (this.mainSelector)\r\n\t\t{\r\n\t\t\tthis.mainSelector.unsubscribeEvents();\r\n\t\t\tEventEmitter.unsubscribe(\r\n\t\t\t\tthis.mainSelector,\r\n\t\t\t\t'onClear',\r\n\t\t\t\tthis.handleMainSelectorClear\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (this.storeSelector)\r\n\t\t{\r\n\t\t\tthis.storeSelector.unsubscribeEvents();\r\n\t\t\tEventEmitter.unsubscribe(\r\n\t\t\t\tthis.storeSelector,\r\n\t\t\t\t'onChange',\r\n\t\t\t\tthis.handleStoreFieldChange\r\n\t\t\t);\r\n\r\n\t\t\tEventEmitter.unsubscribe(\r\n\t\t\t\tthis.storeSelector,\r\n\t\t\t\t'onClear',\r\n\t\t\t\tthis.handleStoreFieldClear\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (this.reserveControl)\r\n\t\t{\r\n\t\t\tEventEmitter.unsubscribeAll(\r\n\t\t\t\tthis.reserveControl,\r\n\t\t\t\t'onChange'\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tEventEmitter.unsubscribe(\r\n\t\t\tthis.model,\r\n\t\t\t'onChangeStoreData',\r\n\t\t\tthis.handleChangeStoreData,\r\n\t\t);\r\n\r\n\t\tEventEmitter.unsubscribe(\r\n\t\t\tthis.model,\r\n\t\t\t'onErrorsChange',\r\n\t\t\tthis.handleProductErrorsChange,\r\n\t\t);\r\n\t}\r\n\r\n\tchangeMassActionField(event)\r\n\t{\r\n\t\tconsole.log(this);\r\n\t}\r\n\r\n\t#initActions()\r\n\t{\r\n\t\tif (this.getEditor().isReadOnly())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst actionCellContentContainer = this.getNode().querySelector('.main-grid-cell-action .main-grid-cell-content');\r\n\t\tif (Type.isDomNode(actionCellContentContainer))\r\n\t\t{\r\n\t\t\tconst actionsButton = Tag.render`\r\n\t\t\t\t<a\r\n\t\t\t\t\thref=\"#\"\r\n\t\t\t\t\tclass=\"main-grid-row-action-button\"\r\n\t\t\t\t></a>\r\n\t\t\t`;\r\n\r\n\t\t\tEvent.bind(actionsButton, 'click', (event) => {\r\n\t\t\t\tconst menuItems = [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_PL_COPY'),\r\n\t\t\t\t\t\tonclick: this.handleCopyAction.bind(this),\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttext: Loc.getMessage('CRM_ENTITY_PL_DELETE'),\r\n\t\t\t\t\t\tonclick: this.handleDeleteAction.bind(this),\r\n\t\t\t\t\t\tdisabled: this.getModel().isEmpty() && this.getEditor().products.length <= 1,\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\ttext: Loc.getMessage('ADD_APPLICATION'),\r\n\t\t\t\t\t\tonclick: this.showProductApplication.bind(this),\r\n\t\t\t\t\t\tdisabled: Number(this.getField('UF_APPLICATION_PARENT_PRODUCT_ROW_ID', 0)) != 0 || this.getModel().isEmpty() || this.isAdjusted()\r\n\t\t\t\t\t}\r\n\t\t\t\t];\r\n\r\n\t\t\t\tPopupMenu.show({\r\n\t\t\t\t\tid: this.getId() + '_actions_popup',\r\n\t\t\t\t\tbindElement: actionsButton,\r\n\t\t\t\t\titems: menuItems,\r\n\t\t\t\t\tcacheable: false,\r\n\t\t\t\t});\r\n\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t});\r\n\r\n\t\t\tDom.append(actionsButton, actionCellContentContainer);\r\n\t\t}\r\n\t}\r\n\r\n\tmodifyBasePriceInput(): void\r\n\t{\r\n\t\tconst priceNode = this.#getNodeChildByDataName('PRICE');\r\n\t\tif (!priceNode)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.#isEditableCatalogPrice())\r\n\t\t{\r\n\t\t\tpriceNode.setAttribute('disabled', true);\r\n\t\t\tDom.addClass(priceNode,'ui-ctl-element');\r\n\t\t\tpriceNode\r\n\t\t\t\t.querySelector('.main-grid-editor-money-price')\r\n\t\t\t\t?.setAttribute('disabled', 'true')\r\n\t\t\t;\r\n\t\t\tif (!this.editor.getSettingValue('disableNotifyChangingPrice'))\r\n\t\t\t{\r\n\t\t\t\tEvent.bind(priceNode, 'mouseenter', this.handleFocusUnchangeablePrice);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tpriceNode.removeAttribute('disabled');\r\n\t\t\tDom.removeClass(priceNode,'ui-ctl-element');\r\n\t\t\tpriceNode\r\n\t\t\t\t.querySelector('.main-grid-editor-money-price')\r\n\t\t\t\t?.removeAttribute('disabled')\r\n\t\t\t;\r\n\t\t\tEvent.unbind(priceNode, 'mouseenter', this.handleFocusUnchangeablePrice);\r\n\t\t}\r\n\t}\r\n\r\n\t#showChangePriceNotify()\r\n\t{\r\n\t\tif (this.editor.getSettingValue('disableNotifyChangingPrice'))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst hint = Text.encode(this.editor.getSettingValue('catalogPriceEditArticleHint'));\r\n\r\n\t\tconst changePriceNotifyId = 'disabled-crm-changing-price';\r\n\t\tlet changePriceNotify = BX.UI.Notification.Center.getBalloonById(changePriceNotifyId);\r\n\t\tif (!changePriceNotify)\r\n\t\t{\r\n\t\t\tconst content = Tag.render`\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<div style=\"padding: 9px\">${hint}</div>\r\n\t\t\t\t</div>\r\n\t\t\t`;\r\n\r\n\t\t\tconst buttonRow = Tag.render`<div></div>`;\r\n\t\t\tcontent.appendChild(buttonRow);\r\n\r\n\t\t\tconst articleCode = this.editor.getSettingValue('catalogPriceEditArticleCode');\r\n\t\t\tif (articleCode)\r\n\t\t\t{\r\n\t\t\t\tconst moreLink = Tag.render`\r\n\t\t\t\t\t<span class=\"ui-notification-balloon-action\">\r\n\t\t\t\t\t\t${Loc.getMessage('CRM_ENTITY_MORE_LINK')}\r\n\t\t\t\t\t</span>\r\n\t\t\t\t`;\r\n\r\n\t\t\t\tEvent.bind(moreLink, 'click', () => {\r\n\t\t\t\t\ttop.BX.Helper.show(\"redirect=detail&code=\" + articleCode);\r\n\t\t\t\t\tchangePriceNotify.close();\r\n\t\t\t\t});\r\n\t\t\t\tbuttonRow.appendChild(moreLink);\r\n\t\t\t}\r\n\r\n\t\t\tconst disableNotificationLink = Tag.render`\r\n\t\t\t\t<span class=\"ui-notification-balloon-action\">\r\n\t\t\t\t\t${Loc.getMessage('CRM_ENTITY_DISABLE_NOTIFICATION')}\r\n\t\t\t\t</span>\r\n\t\t\t`;\r\n\r\n\t\t\tEvent.bind(disableNotificationLink, 'click', () => {\r\n\t\t\t\tchangePriceNotify.close();\r\n\t\t\t\tthis.editor.setSettingValue('disableNotifyChangingPrice', true);\r\n\t\t\t\tajax\r\n\t\t\t\t\t.runComponentAction(\r\n\t\t\t\t\t\tthis.editor.getComponentName(),\r\n\t\t\t\t\t\t'setGridSetting',\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tmode: 'class',\r\n\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\tsignedParameters: this.editor.getSignedParameters(),\r\n\t\t\t\t\t\t\t\tsettingId: 'DISABLE_NOTIFY_CHANGING_PRICE',\r\n\t\t\t\t\t\t\t\tselected: true,\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\tbuttonRow.appendChild(disableNotificationLink);\r\n\r\n\t\t\tconst notificationOptions = {\r\n\t\t\t\tid: changePriceNotifyId,\r\n\t\t\t\tcloseButton: true,\r\n\t\t\t\tcategory: Row.CATALOG_PRICE_CHANGING_DISABLED,\r\n\t\t\t\tautoHideDelay: 10000,\r\n\t\t\t\tcontent,\r\n\t\t\t};\r\n\r\n\t\t\tchangePriceNotify = BX.UI.Notification.Center.notify(notificationOptions);\r\n\t\t}\r\n\r\n\t\tchangePriceNotify.show();\r\n\t}\r\n\r\n\t#isEditableCatalogPrice()\r\n\t{\r\n\t\treturn this.editor.canEditCatalogPrice()\r\n\t\t\t|| !this.getModel().isCatalogExisted()\r\n\t\t\t|| this.getModel().isNew()\r\n\t\t;\r\n\t}\r\n\r\n\t#isSaveableCatalogPrice()\r\n\t{\r\n\t\treturn this.editor.canSaveCatalogPrice()\r\n\t\t\t|| (this.getModel().isCatalogExisted() && this.getModel().isNew())\r\n\t\t;\r\n\t}\r\n\r\n\t#initSelector()\r\n\t{\r\n\t\tconst id = 'crm_grid_' + this.getId();\r\n\t\tthis.mainSelector = ProductSelector.getById(id);\r\n\t\tif (!this.mainSelector)\r\n\t\t{\r\n\t\t\tconst selectorOptions = {\r\n\t\t\t\tiblockId: this.model.getIblockId(),\r\n\t\t\t\tbasePriceId: this.model.getBasePriceId(),\r\n\t\t\t\tcurrency: this.model.getCurrency(),\r\n\t\t\t\tmodel: this.model,\r\n\t\t\t\tconfig: {\r\n\t\t\t\t\tENABLE_SEARCH: true,\r\n\t\t\t\t\tIS_ALLOWED_CREATION_PRODUCT: true,\r\n\t\t\t\t\tENABLE_IMAGE_INPUT: true,\r\n\t\t\t\t\tROLLBACK_INPUT_AFTER_CANCEL: true,\r\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: true,\r\n\t\t\t\t\tROW_ID: this.getId(),\r\n\t\t\t\t\tENABLE_SKU_SELECTION: true,\r\n\t\t\t\t\tURL_BUILDER_CONTEXT: this.editor.getSettingValue('productUrlBuilderContext'),\r\n\t\t\t\t},\r\n\t\t\t\tmode: ProductSelector.MODE_EDIT,\r\n\t\t\t};\r\n\r\n\t\t\tthis.mainSelector = new ProductSelector('crm_grid_' + this.getId(), selectorOptions);\r\n\t\t}\r\n\r\n\t\tconst mainInfoNode = this.#getNodeChildByDataName('MAIN_INFO');\r\n\t\tif (mainInfoNode)\r\n\t\t{\r\n\t\t\tconst plusButton = mainInfoNode.querySelector('.main-grid-plus-button');\r\n\t\t\tif(!Type.isDomNode(plusButton)) {\r\n\t\t\t\tmainInfoNode.appendChild(Tag.render`<span class=\"main-grid-plus-button\"></span>`);\r\n\t\t\t}\r\n\r\n\t\t\tconst numberSelector = mainInfoNode.querySelector('.main-grid-row-number');\r\n\t\t\tif (!Type.isDomNode(numberSelector))\r\n\t\t\t{\r\n\t\t\t\tmainInfoNode.appendChild(Tag.render`<div class=\"main-grid-row-number\"></div>`);\r\n\t\t\t}\r\n\r\n\t\t\tlet selectorWrapper =  mainInfoNode.querySelector('.main-grid-row-product-selector');\r\n\t\t\tif (!Type.isDomNode(selectorWrapper))\r\n\t\t\t{\r\n\t\t\t\tselectorWrapper = Tag.render`<div class=\"main-grid-row-product-selector\"></div>`\r\n\t\t\t\tmainInfoNode.appendChild(selectorWrapper)\r\n\t\t\t}\r\n\r\n\t\t\tthis.mainSelector.skuTreeInstance = null;\r\n\t\t\tthis.mainSelector.renderTo(selectorWrapper);\r\n\t\t}\r\n\r\n\t\tEventEmitter.subscribe(\r\n\t\t\tthis.mainSelector,\r\n\t\t\t'onClear',\r\n\t\t\tthis.handleMainSelectorClear\r\n\t\t);\r\n\r\n\t\tEventEmitter.subscribe(\r\n\t\t\tthis.mainSelector,\r\n\t\t\t'onChange',\r\n\t\t\tthis.handleMainSelectorChange\r\n\t\t);\r\n\t}\r\n\r\n\t#onMainSelectorClear()\r\n\t{\r\n\t\tthis.updateField('OFFER_ID', 0);\r\n\t\tthis.updateField('PRODUCT_NAME', '');\r\n\t\tthis.updateUiStoreAmountData();\r\n\t\tthis.updateField('DEDUCTED_QUANTITY', 0);\r\n\t\tthis.updateField('ROW_RESERVED', 0);\r\n\r\n\t\tif(!this.isAdjusted()) {\r\n\t\t\tlet adjustedRow = this.getAdjustedProductRow();\r\n\t\t\tif(adjustedRow) {\r\n\t\t\t\tadjustedRow.#onMainSelectorClear();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.getEditor().deleteApplicationsForRow(this.getField('ID'));\r\n\t}\r\n\r\n\t#onMainSelectorChange(event)\r\n\t{\r\n\t\tconst item = event.getData().fields;\r\n\t\tthis.updateUiHtmlField('STORE_GENERAL', item.STORE_GENERAL);\r\n\t\tthis.updateUiHtmlField('STORE_VIRTUAL', item.STORE_VIRTUAL);\r\n\t\tthis.updateUiHtmlField('SUPPLIER_OF_GOODS', item.SUPPLIER_OF_GOODS);\r\n\r\n\t\tthis.updateUiHtmlField('COMMON_RESERVED', `${item.ROW_RESERVED} ${item.MEASURE_NAME}`);\r\n\t\tthis.updateUiHtmlField('UF_RESERVE_QUANTITY', `${item.UF_RESERVE_QUANTITY} ${item.MEASURE_NAME}`);\r\n\t\tthis.updateUiHtmlField('FREE_STORE', `${item.FREE_STORE} ${item.MEASURE_NAME}`);\r\n\r\n\t\titem.PROPERTIES?.forEach((property) => {\r\n\t\t\tObject.values(property.PROPERTY_VALUES)?.forEach((propertyValue) => {\r\n\t\t\t\tthis.updateUiHtmlField(property.CODE, propertyValue.VALUE);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t#initStoreSelector()\r\n\t{\r\n\t\tthis.storeSelector = new StoreSelector(\r\n\t\t\tthis.getId(),\r\n\t\t\t{\r\n\t\t\t\tinputFieldId: 'STORE_ID',\r\n\t\t\t\tinputFieldTitle: 'STORE_TITLE',\r\n\t\t\t\tconfig: {\r\n\t\t\t\t\tENABLE_SEARCH: true,\r\n\t\t\t\t\tENABLE_INPUT_DETAIL_LINK: false,\r\n\t\t\t\t\tROW_ID: this.getId(),\r\n\t\t\t\t},\r\n\t\t\t\tmode: StoreSelector.MODE_EDIT,\r\n\t\t\t\tmodel: this.model,\r\n\t\t\t}\r\n\t\t);\r\n\t\tconst storeWrapper = this.#getNodeChildByDataName('STORE_INFO');\r\n\t\tif (this.storeSelector && storeWrapper)\r\n\t\t{\r\n\t\t\tstoreWrapper.innerHTML = '';\r\n\t\t\tthis.storeSelector.renderTo(storeWrapper);\r\n\r\n\t\t\tif (this.isReserveBlocked())\r\n\t\t\t{\r\n\t\t\t\tthis.#applyStoreSelectorRestrictionTweaks();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tEventEmitter.subscribe(\r\n\t\t\tthis.storeSelector,\r\n\t\t\t'onChange',\r\n\t\t\tthis.handleStoreFieldChange\r\n\t\t);\r\n\r\n\t\tEventEmitter.subscribe(\r\n\t\t\tthis.storeSelector,\r\n\t\t\t'onClear',\r\n\t\t\tthis.handleStoreFieldClear\r\n\t\t);\r\n\t}\r\n\r\n\t#initStoreAvailablePopup()\r\n\t{\r\n\t\tconst storeAvaiableNode = this.#getNodeChildByDataName('STORE_AVAILABLE');\r\n\t\tif (!storeAvaiableNode)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.storeAvailablePopup = new StoreAvailablePopup({\r\n\t\t\trowId: this.id,\r\n\t\t\tmodel: this.getModel(),\r\n\t\t\tnode: storeAvaiableNode,\r\n\t\t});\r\n\r\n\t\t// runs once because after grid update, row re-created.\r\n\t\tEventEmitter.subscribeOnce(\r\n\t\t\t'Grid::updated',\r\n\t\t\tthis.handleOnGridUpdated\r\n\t\t);\r\n\t}\r\n\r\n\t#applyStoreSelectorRestrictionTweaks()\r\n\t{\r\n\t\tconst storeSearchInput = this.storeSelector.searchInput;\r\n\t\tif (!storeSearchInput || !storeSearchInput.getNameInput())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tstoreSearchInput.toggleIcon(this.storeSelector.searchInput.getSearchIcon(), 'none');\r\n\t\tstoreSearchInput.getNameInput().disabled = true;\r\n\t\tstoreSearchInput.getNameInput().classList.add('crm-entity-product-list-locked-field');\r\n\t\tif (this.storeSelector.getWrapper())\r\n\t\t{\r\n\t\t\tthis.storeSelector.getWrapper().onclick = () => top.BX.UI.InfoHelper.show('limit_store_crm_integration');\r\n\t\t}\r\n\t}\r\n\r\n\t#initReservedControl()\r\n\t{\r\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\r\n\t\tif (storeWrapper)\r\n\t\t{\r\n\t\t\tthis.reserveControl = new ReserveControl({\r\n\t\t\t\tmodel: this.getModel(),\r\n\t\t\t\tisReserveEqualProductQuantity: this.#isReserveEqualProductQuantity(),\r\n\t\t\t\tdefaultDateReservation: this.editor.getSettingValue('defaultDateReservation'),\r\n\t\t\t\tisBlocked: this.isReserveBlocked(),\r\n\t\t\t});\r\n\r\n\t\t\tEventEmitter.subscribe(\r\n\t\t\t\tthis.reserveControl,\r\n\t\t\t\t'onChange',\r\n\t\t\t\t(event) => {\r\n\t\t\t\t\tconst item = event.getData();\r\n\t\t\t\t\tthis.updateField(item.NAME, item.VALUE);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tthis.layoutReserveControl();\r\n\t\t}\r\n\r\n\t\tconst quantityInput = this.getNode().querySelector('div[data-name=\"QUANTITY\"] input');\r\n\t\tif (quantityInput)\r\n\t\t{\r\n\t\t\tEvent.bind(\r\n\t\t\t\tquantityInput,\r\n\t\t\t\t'change',\r\n\t\t\t\t(event) => {\r\n\t\t\t\t\tconst isReserveEqualProductQuantity =\r\n\t\t\t\t\t\tthis.#isReserveEqualProductQuantity()\r\n\t\t\t\t\t\t&& this.reserveControl?.isReserveEqualProductQuantity\r\n\t\t\t\t\t;\r\n\t\t\t\t\tif (isReserveEqualProductQuantity)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.setReserveQuantity(this.getField('QUANTITY'));\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst value = Text.toNumber(event.target.value);\r\n\t\t\t\t\tconst errorNotifyId = 'quantityReservedCountError';\r\n\t\t\t\t\tlet notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\r\n\t\t\t\t\tif (value < this.getField('INPUT_RESERVE_QUANTITY'))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (!notify)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tconst notificationOptions = {\r\n\t\t\t\t\t\t\t\tid: errorNotifyId,\r\n\t\t\t\t\t\t\t\tcloseButton: true,\r\n\t\t\t\t\t\t\t\tautoHideDelay: 3000,\r\n\t\t\t\t\t\t\t\tcontent: Tag.render`<div>${Loc.getMessage('CRM_ENTITY_PL_IS_LESS_QUANTITY_THEN_RESERVED')}</div>`,\r\n\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\tnotify = BX.UI.Notification.Center.notify(notificationOptions);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis.setReserveQuantity(this.getField('QUANTITY'));\r\n\t\t\t\t\t\tnotify.show();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t#onStoreFieldChange(event)\r\n\t{\r\n\t\tconst data = event.getData();\r\n\t\tdata.fields.forEach((item) => {\r\n\t\t\tthis.updateField(item.NAME, item.VALUE);\r\n\t\t});\r\n\r\n\t\tthis.initHandlersForSelectors();\r\n\t}\r\n\r\n\t#onStoreFieldClear(event)\r\n\t{\r\n\t\tthis.initHandlersForSelectors();\r\n\t}\r\n\r\n\tlayoutReserveControl()\r\n\t{\r\n\t\tconst storeWrapper = this.#getNodeChildByDataName('RESERVE_INFO');\r\n\t\tif (storeWrapper && this.reserveControl)\r\n\t\t{\r\n\t\t\tstoreWrapper.innerHTML = '';\r\n\t\t\tthis.reserveControl.clearCache();\r\n\t\t\tthis.reserveControl.renderTo(storeWrapper);\r\n\t\t}\r\n\t}\r\n\r\n\tsetRowNumber(number)\r\n\t{\r\n\t\tthis.getNode().querySelectorAll('.main-grid-row-number').forEach(node => {\r\n\t\t\tnode.textContent = number + '.';\r\n\t\t});\r\n\t}\r\n\r\n\tgetFields(fields: Array = [])\r\n\t{\r\n\t\tlet result;\r\n\r\n\t\tif (!Type.isArrayFilled(fields))\r\n\t\t{\r\n\t\t\tresult = Runtime.clone(this.fields);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tresult = {};\r\n\r\n\t\t\tfor (let fieldName of fields)\r\n\t\t\t{\r\n\t\t\t\tresult[fieldName] = this.getField(fieldName);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ('PRODUCT_NAME' in result)\r\n\t\t{\r\n\t\t\tlet fixedProductName = this.getField('FIXED_PRODUCT_NAME', '');\r\n\r\n\t\t\tif (Type.isStringFilled(fixedProductName))\r\n\t\t\t{\r\n\t\t\t\tresult['PRODUCT_NAME'] = fixedProductName;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetCatalogFields(): Object\r\n\t{\r\n\t\tconst fields = this.getFields(['CURRENCY', 'QUANTITY', 'MEASURE_CODE']);\r\n\r\n\t\tfields['PRICE'] = this.getBasePrice();\r\n\t\tfields['VAT_INCLUDED'] = this.getTaxIncluded();\r\n\t\tfields['VAT_ID'] = this.getTaxId();\r\n\r\n\t\treturn fields;\r\n\t}\r\n\r\n\tgetCalculateFields(): FieldScheme\r\n\t{\r\n\t\treturn {\r\n\t\t\t'PRICE': this.getPrice(),\r\n\t\t\t'BASE_PRICE': this.getBasePrice(),\r\n\t\t\t'PRICE_EXCLUSIVE': this.getPriceExclusive(),\r\n\t\t\t'PRICE_NETTO': this.getPriceNetto(),\r\n\t\t\t'PRICE_BRUTTO': this.getPriceBrutto(),\r\n\t\t\t'QUANTITY': this.getQuantity(),\r\n\t\t\t'DISCOUNT_TYPE_ID': this.getDiscountType(),\r\n\t\t\t'DISCOUNT_RATE': this.getDiscountRate(),\r\n\t\t\t'DISCOUNT_SUM': this.getDiscountSum(),\r\n\t\t\t'DISCOUNT_ROW': this.getDiscountRow(),\r\n\t\t\t'TAX_INCLUDED': this.getTaxIncluded(),\r\n\t\t\t'TAX_RATE': this.getTaxRate()\r\n\t\t};\r\n\t}\r\n\r\n\tsetFields(fields: Object): void\r\n\t{\r\n\t\tfor (let name in fields)\r\n\t\t{\r\n\t\t\tif (fields.hasOwnProperty(name))\r\n\t\t\t{\r\n\t\t\t\tthis.setField(name, fields[name]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetField(name: string, defaultValue)\r\n\t{\r\n\t\treturn this.fields.hasOwnProperty(name) ? this.fields[name] : defaultValue;\r\n\t}\r\n\r\n\tsetField(name: string, value, changeModel: boolean = true): void\r\n\t{\r\n\t\tthis.fields[name] = value;\r\n\r\n\t\tif (changeModel)\r\n\t\t{\r\n\t\t\tthis.getModel().setField(name, value);\r\n\t\t}\r\n\t}\r\n\r\n\tgetUiFieldId(field): string\r\n\t{\r\n\t\treturn this.getId() + '_' + field;\r\n\t}\r\n\r\n\tgetBasePrice(): number\r\n\t{\r\n\t\treturn this.getField('BASE_PRICE', 0);\r\n\t}\r\n\r\n\tgetEnteredPrice(): number\r\n\t{\r\n\t\treturn this.getField('ENTERED_PRICE', this.getBasePrice());\r\n\t}\r\n\r\n\tgetCatalogPrice(): number\r\n\t{\r\n\t\treturn this.getField('CATALOG_PRICE', this.getBasePrice());\r\n\t}\r\n\r\n\tisPriceNetto(): boolean\r\n\t{\r\n\t\treturn this.getEditor().isTaxAllowed() && !this.isTaxIncluded();\r\n\t}\r\n\r\n\tgetPrice(): number\r\n\t{\r\n\t\treturn this.getField('PRICE', 0);\r\n\t}\r\n\r\n\tgetPriceExclusive(): number\r\n\t{\r\n\t\treturn this.getField('PRICE_EXCLUSIVE', 0);\r\n\t}\r\n\r\n\tgetPriceNetto(): number\r\n\t{\r\n\t\treturn this.getField('PRICE_NETTO', 0);\r\n\t}\r\n\r\n\tgetPriceBrutto(): number\r\n\t{\r\n\t\treturn this.getField('PRICE_BRUTTO', 0);\r\n\t}\r\n\r\n\tgetQuantity(): number\r\n\t{\r\n\t\treturn this.getField('QUANTITY', 1);\r\n\t}\r\n\r\n\tgetDiscountType(): DiscountTypes\r\n\t{\r\n\t\treturn this.getField('DISCOUNT_TYPE_ID', DiscountType.UNDEFINED);\r\n\t}\r\n\r\n\tisDiscountUndefined(): boolean\r\n\t{\r\n\t\treturn this.getDiscountType() === DiscountType.UNDEFINED;\r\n\t}\r\n\r\n\tisDiscountPercentage(): boolean\r\n\t{\r\n\t\treturn this.getDiscountType() === DiscountType.PERCENTAGE;\r\n\t}\r\n\r\n\tisDiscountMonetary(): boolean\r\n\t{\r\n\t\treturn this.getDiscountType() === DiscountType.MONETARY;\r\n\t}\r\n\r\n\tisDiscountHandmade(): boolean\r\n\t{\r\n\t\treturn this.isDiscountPercentage() || this.isDiscountMonetary();\r\n\t}\r\n\r\n\tgetDiscountRate(): number\r\n\t{\r\n\t\treturn this.getField('DISCOUNT_RATE', 0);\r\n\t}\r\n\r\n\tgetDiscountSum(): number\r\n\t{\r\n\t\treturn this.getField('DISCOUNT_SUM', 0);\r\n\t}\r\n\r\n\tgetDiscountRow(): number\r\n\t{\r\n\t\treturn this.getField('DISCOUNT_ROW', 0);\r\n\t}\r\n\r\n\tisEmptyDiscount(): boolean\r\n\t{\r\n\t\tif (this.isDiscountPercentage())\r\n\t\t{\r\n\t\t\treturn this.getDiscountRate() === 0;\r\n\t\t}\r\n\t\telse if (this.isDiscountMonetary())\r\n\t\t{\r\n\t\t\treturn this.getDiscountSum() === 0;\r\n\t\t}\r\n\t\telse if (this.isDiscountUndefined())\r\n\t\t{\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgetTaxIncluded(): 'Y' | 'N'\r\n\t{\r\n\t\treturn this.getField('TAX_INCLUDED', 'N');\r\n\t}\r\n\r\n\tisTaxIncluded(): boolean\r\n\t{\r\n\t\treturn this.getTaxIncluded() === 'Y';\r\n\t}\r\n\r\n\tgetTaxRate(): number\r\n\t{\r\n\t\treturn this.getField('TAX_RATE', 0);\r\n\t}\r\n\r\n\tgetTaxSum(): number\r\n\t{\r\n\t\treturn this.isTaxIncluded()\r\n\t\t\t? this.getPrice() * this.getQuantity() * (1 - 1 / (1 + this.getTaxRate() / 100))\r\n\t\t\t: this.getPriceExclusive() * this.getQuantity() * this.getTaxRate() / 100;\r\n\t}\r\n\r\n\tgetTaxNode(): ?HTMLSelectElement\r\n\t{\r\n\t\treturn this.getNode().querySelector('select[data-field-code=\"TAX_RATE\"]');\r\n\t}\r\n\r\n\tgetTaxId(): number\r\n\t{\r\n\t\tconst taxNode = this.getTaxNode();\r\n\r\n\t\tif (Type.isDomNode(taxNode) && taxNode.options[taxNode.selectedIndex])\r\n\t\t{\r\n\t\t\treturn Text.toNumber(taxNode.options[taxNode.selectedIndex].getAttribute('data-tax-id'));\r\n\t\t}\r\n\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tupdateFieldByEvent(fieldCode: string, event: UIEvent): void\r\n\t{\r\n\t\tconst target = event.target;\r\n\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\r\n\t\tconst mode = event.type === 'input' ? MODE_EDIT : MODE_SET;\r\n\r\n\t\tthis.updateField(fieldCode, value, mode);\r\n\t}\r\n\r\n\tupdateField(fieldCode: string, value, mode = MODE_SET): void\r\n\t{\r\n\t\tthis.resetExternalActions();\r\n\t\tthis.updateFieldValue(fieldCode, value, mode);\r\n\t\tthis.executeExternalActions();\r\n\t}\r\n\r\n\tupdateFieldValue(code: string, value, mode = MODE_SET): void\r\n\t{\r\n\t\tswitch (code)\r\n\t\t{\r\n\t\t\tcase 'ID':\r\n\t\t\tcase 'OFFER_ID':\r\n\t\t\t\tthis.changeProductId(value);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'ENTERED_PRICE':\r\n\t\t\tcase 'PRICE':\r\n\t\t\t\tthis.changeEnteredPrice(value, mode);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'CATALOG_PRICE':\r\n\t\t\t\tthis.changeCatalogPrice(value, mode);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'QUANTITY':\r\n\t\t\t\tthis.changeQuantity(value, mode);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'MEASURE_CODE':\r\n\t\t\t\tthis.changeMeasureCode(value, mode);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'DISCOUNT':\r\n\t\t\tcase 'DISCOUNT_PRICE':\r\n\t\t\t\tthis.changeDiscount(value, mode);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'DISCOUNT_TYPE_ID':\r\n\t\t\t\tthis.changeDiscountType(value);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'DISCOUNT_ROW':\r\n\t\t\t\tthis.changeRowDiscount(value, mode);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'VAT_ID':\r\n\t\t\tcase 'TAX_ID':\r\n\t\t\t\tthis.changeTaxId(value);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'TAX_RATE':\r\n\t\t\t\tthis.changeTaxRate(value);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'VAT_INCLUDED':\r\n\t\t\tcase 'TAX_INCLUDED':\r\n\t\t\t\tthis.changeTaxIncluded(value);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'SUM':\r\n\t\t\t\tthis.changeRowSum(value, mode);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'NAME':\r\n\t\t\tcase 'PRODUCT_NAME':\r\n\t\t\tcase 'MAIN_INFO':\r\n\t\t\t\tthis.changeProductName(value);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'SORT':\r\n\t\t\t\tthis.changeSort(value, mode);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'STORE_ID':\r\n\t\t\t\tthis.changeStore(value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'STORE_TITLE':\r\n\t\t\t\tthis.changeStoreName(value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'INPUT_RESERVE_QUANTITY':\r\n\t\t\t\tthis.changeReserveQuantity(value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'DATE_RESERVE_END':\r\n\t\t\t\tthis.changeDateReserveEnd(value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'BASE_PRICE':\r\n\t\t\t\tthis.setBasePrice(value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'DEDUCTED_QUANTITY':\r\n\t\t\t\tthis.setDeductedQuantity(value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'ROW_RESERVED':\r\n\t\t\t\tthis.setRowReserved(value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'SKU_TREE':\r\n\t\t\tcase 'DETAIL_URL':\r\n\t\t\tcase 'IMAGE_INFO':\r\n\t\t\tcase 'COMMON_STORE_AMOUNT':\r\n\t\t\t\tthis.setField(code, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'UF_NEED_ADJUSTMENT':\r\n\t\t\t\tthis.changeAdjustment(value, mode);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'UF_APPLICATION_PRICE':\r\n\t\t\t\tthis.setApplicationPrice(value, mode);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'UF_PURCHASE_PRICE':\r\n\t\t\t\tthis.setPurchasePrice(value, mode);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'MINIMAL_PRICE':\r\n\t\t\t\tthis.setMinimalPrice(value, mode);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tupdateFieldByName(field, value)\r\n\t{\r\n\t\tswitch (field)\r\n\t\t{\r\n\t\t\tcase 'TAX_INCLUDED':\r\n\t\t\t\tthis.setTaxIncluded(value);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\thandleCopyAction(event, menuItem)\r\n\t{\r\n\t\tthis.getEditor()?.copyRow(this);\r\n\t\tconst menu = menuItem.getMenuWindow();\r\n\t\tif (menu)\r\n\t\t{\r\n\t\t\tmenu.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\thandleDeleteAction(event, menuItem)\r\n\t{\r\n\t\tif(!this.isAdjusted() && this.getField('UF_NEED_ADJUSTMENT') == 1) {\r\n\t\t\tlet adjustedRow = this.getAdjustedProductRow();\r\n\t\t\tif(adjustedRow) {\r\n\t\t\t\tthis.getEditor()?.deleteRow(adjustedRow.getField('ID'));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/*if ((this.getField('UF_APPLICATION_PARENT_PRODUCT_ROW_ID', 0)) != 0) {\r\n\t\t\tProductApplication.unsetCheckbox(this.getId().replace(this.getEditor().getRowIdPrefix(), ''));\r\n\t\t}*/\r\n\r\n\t\tthis.getEditor()?.deleteRow(this.getField('ID'));\r\n\r\n\t\tconst menu = menuItem.getMenuWindow();\r\n\t\tif (menu)\r\n\t\t{\r\n\t\t\tmenu.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tshowProductApplication()\r\n\t{\r\n\t\tif (this._productApplication === null) {\r\n\t\t\tthis._productApplication = new ProductApplication(this);\r\n\t\t}\r\n\t\tthis._productApplication.showPopup();\r\n\t}\r\n\r\n\tchangeProductId(value)\r\n\t{\r\n\t\tconst preparedValue = this.parseInt(value);\r\n\r\n\t\tthis.setProductId(preparedValue);\r\n\r\n\t\tif(!this.isAdjusted()) {\r\n\t\t\tlet adjustedRow = this.getAdjustedProductRow();\r\n\t\t\tif(adjustedRow) {\r\n\t\t\t\tadjustedRow.setProductId(value);\r\n\t\t\t\tlet productName = this.getField('NAME', '');\r\n\t\t\t\tadjustedRow.mainSelector.searchInput.onChangeValue(productName);\r\n\t\t\t\tadjustedRow.changeProductName(productName);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.getEditor().deleteApplicationsForRow(this.getField('ID'));\r\n\r\n\t\tif (this._productApplication) {\r\n\t\t\tthis._productApplication.destroy();\r\n\t\t\tthis._productApplication = null;\r\n\t\t}\r\n\t}\r\n\r\n\tchangeEnteredPrice(value, mode = MODE_SET)\r\n\t{\r\n\t\tconst originalPrice = value;\r\n\t\tlet minimalPriceAvailable = false;\r\n\r\n\t\tif (BX.Crm.EntityEditor.defaultInstance.getOwnerInfo().ownerType.startsWith('DEAL')) {\r\n\t\t\tminimalPriceAvailable = BX.Crm.EntityEditor.defaultInstance.getModel().getField(\"UF_AVAILABLE_MINIMAL_PRICE\").VALUE == \"0\"\r\n\t\t}\r\n\r\n\t\t// price can't be less than zero\r\n\t\tif (minimalPriceAvailable) {\r\n\t\t\tvalue = Math.max(value, this.getField('MINIMAL_PRICE'), 0);\r\n\t\t} else {\r\n\t\t\tvalue = Math.max(value, 0);\r\n\t\t}\r\n\r\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\r\n\r\n\t\tthis.setField('ENTERED_PRICE', preparedValue);\r\n\t\tif (mode === MODE_EDIT && originalPrice >= 0)\r\n\t\t{\r\n\t\t\tif (!this.#isEditableCatalogPrice)\r\n\t\t\t{\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.getModel().isCatalogExisted() && this.#isSaveableCatalogPrice())\r\n\t\t\t{\r\n\t\t\t\tthis.#showPriceNotifier(preparedValue);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthis.setBasePrice(preparedValue, mode);\r\n\t\t\t}\r\n\r\n\t\t\tthis.addActionProductChange();\r\n\t\t\tthis.addActionUpdateTotal();\r\n\t\t\tthis.addActionDisableSaveButton();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.refreshFieldsLayout();\r\n\t\t}\r\n\r\n\t\tthis.#togglePriceHintPopup(originalPrice < 0 && originalPrice !== value);\r\n\r\n\t\tif (!(originalPrice < 0 && originalPrice !== value) && minimalPriceAvailable) {\r\n\t\t\tthis.#toggleMinimalPricePopup(originalPrice < this.getField('MINIMAL_PRICE'));\r\n\t\t}\r\n\t}\r\n\r\n\tchangeCatalogPrice(value)\r\n\t{\r\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\r\n\t\tthis.setField('CATALOG_PRICE', preparedValue);\r\n\t\tthis.refreshFieldsLayout();\r\n\t}\r\n\r\n\t#showPriceNotifier(enteredPrice)\r\n\t{\r\n\t\tconst disabledPriceNotify = BX.UI.Notification.Center.getBalloonByCategory(Row.CATALOG_PRICE_CHANGING_DISABLED);\r\n\t\tif (disabledPriceNotify)\r\n\t\t{\r\n\t\t\tdisabledPriceNotify.close();\r\n\t\t}\r\n\t\tthis.getModel().showSaveNotifier(\r\n\t\t\t'priceChanger_' + this.getId(),\r\n\t\t\t{\r\n\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_PRICE_CHANGED_QUERY'),\r\n\t\t\t\tevents: {\r\n\t\t\t\t\tonCancel: () => {\r\n\t\t\t\t\t\tif (this.getBasePrice() > this.getEnteredPrice())\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tthis.setField('ENTERED_PRICE', this.getBasePrice());\r\n\t\t\t\t\t\t\tthis.updateUiInputField('PRICE', this.getBasePrice())\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis.setPrice(enteredPrice);\r\n\r\n\t\t\t\t\t\tif (this.getField('DISCOUNT_SUM') > 0)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tconst settingPopup = this.getEditor().getSettingsPopup();\r\n\t\t\t\t\t\t\tconst setting = settingPopup?.getSetting('DISCOUNTS');\r\n\t\t\t\t\t\t\tif (setting && setting.checked === false)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tsettingPopup.requestGridSettings(setting, true);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonSave: () => {\r\n\t\t\t\t\t\tthis.setField('ENTERED_PRICE', enteredPrice);\r\n\t\t\t\t\t\tthis.setField('PRICE', enteredPrice);\r\n\t\t\t\t\t\tthis.changeCatalogPrice('CATALOG_PRICE', enteredPrice);\r\n\t\t\t\t\t\tthis.setBasePrice(enteredPrice);\r\n\t\t\t\t\t\tthis.getModel().save(['BASE_PRICE', 'CURRENCY']);\r\n\r\n\t\t\t\t\t\tthis.refreshFieldsLayout();\r\n\t\t\t\t\t\tthis.addActionUpdateTotal();\r\n\t\t\t\t\t\tthis.executeExternalActions();\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tgetAdjustedProductRow() {\r\n\t\tif(this.getField('UF_NEED_ADJUSTMENT')) {\r\n\t\t\treturn this.getEditor().getAdjustedProductRow(this.getField('SORT'));\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tchangeAdjustment(value, mode = MODE_SET) {\r\n\t\tvalue = +value;\r\n\t\tthis.setField('UF_NEED_ADJUSTMENT', value);\r\n\t\tif(value && mode == MODE_SET) {\r\n\t\t\tlet productId = this.getEditor().copyRowAndReturnProductId(this);\r\n\t\t\tlet adjustedProduct = this.getEditor().getProductById(productId);\r\n\t\t\tadjustedProduct.setField('UF_NEED_ADJUSTMENT', 0);\r\n\t\t\tadjustedProduct.setField('UF_CRM_PR_ADJUSTMENT', 1);\r\n\t\t\tadjustedProduct.setQuantity(0);\r\n\t\t\tadjustedProduct.setDiscount(100, DiscountType.PERCENTAGE);\r\n\t\t\tadjustedProduct.disableUiField('UF_NEED_ADJUSTMENT', true);\r\n\t\t\tadjustedProduct.updateUiCheckboxField('UF_CRM_PR_ADJUSTMENT', 'Y');\r\n\t\t\tadjustedProduct.updateUiInputField('PRICE', adjustedProduct.getPrice());\r\n\r\n\t\t} else if(!value && mode == MODE_SET) {\r\n\t\t\tlet adjustedProduct = this.getEditor().getAdjustedProductRow(this.getField('SORT'));\r\n\r\n\t\t\tif(adjustedProduct && adjustedProduct.getField('UF_APPLICATION_PARENT_PRODUCT_ROW_ID', 0) == 0) {\r\n\t\t\t\tthis.getEditor().deleteRow(adjustedProduct.getField('ID'));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsetApplicationPrice(value, mode = MODE_SET)\r\n\t{\r\n\t\t// price can't be less than zero\r\n\t\tvalue = Number.parseFloat(value);\r\n\t\tvalue = Math.max(value, 0);\r\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\r\n\t\tthis.setField('UF_APPLICATION_PRICE', preparedValue);\r\n\t\tthis.updateUiInputField('UF_APPLICATION_PRICE', preparedValue);\r\n\t\tthis.addActionProductChange();\r\n\t\tthis.addActionUpdateTotal();\r\n\t\tthis.addActionDisableSaveButton();\r\n\t}\r\n\r\n\tsetPurchasePrice(value, mode = MODE_SET)\r\n\t{\r\n\t\t// price can't be less than zero\r\n\t\tvalue = Number.parseFloat(value);\r\n\t\tvalue = Math.max(value, 0);\r\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\r\n\t\tthis.setField('UF_PURCHASE_PRICE', preparedValue);\r\n\t\tthis.updateUiInputField('UF_PURCHASE_PRICE', preparedValue);\r\n\t\tthis.addActionProductChange();\r\n\t}\r\n\r\n\tsetMinimalPrice(value, mode = MODE_SET)\r\n\t{\r\n\t\t// price can't be less than zero\r\n\t\tvalue = Number.parseFloat(value);\r\n\t\tvalue = Math.max(value, 0);\r\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\r\n\t\tthis.setField('MINIMAL_PRICE', preparedValue);\r\n\t}\r\n\r\n\tchangeQuantity(value, mode = MODE_SET)\r\n\t{\r\n\t\tconst preparedValue = this.parseFloat(value, this.getQuantityPrecision());\r\n\t\tthis.setQuantity(preparedValue, mode);\r\n\t}\r\n\r\n\tchangeMeasureCode(value: string, mode = MODE_SET): void\r\n\t{\r\n\t\tthis\r\n\t\t\t.getEditor()\r\n\t\t\t.getMeasures()\r\n\t\t\t.filter((item) => item.CODE === value)\r\n\t\t\t.forEach((item) => this.setMeasure(item, mode))\r\n\t\t;\r\n\t}\r\n\r\n\tchangeDiscount(value, mode = MODE_SET)\r\n\t{\r\n\t\tlet preparedValue;\r\n\r\n\t\tif (this.isDiscountPercentage())\r\n\t\t{\r\n\t\t\tpreparedValue = this.parseFloat(value, this.getCommonPrecision());\r\n\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tpreparedValue = this\r\n\t\t\t\t.parseFloat(value, this.getPricePrecision())\r\n\t\t\t\t.toFixed(this.getPricePrecision())\r\n\t\t\t;\r\n\t\t}\r\n\r\n\t\tthis.setDiscount(preparedValue, mode);\r\n\t}\r\n\r\n\tchangeDiscountType(value)\r\n\t{\r\n\t\tconst preparedValue = this.parseInt(value, DiscountType.UNDEFINED);\r\n\r\n\t\tthis.setDiscountType(preparedValue);\r\n\t}\r\n\r\n\tchangeRowDiscount(value, mode = MODE_SET)\r\n\t{\r\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\r\n\r\n\t\tthis.setRowDiscount(preparedValue, mode);\r\n\t}\r\n\r\n\tchangeTaxId(value: number): void\r\n\t{\r\n\t\tconst taxList = this.getEditor().getTaxList();\r\n\t\tif (Type.isArrayFilled(taxList))\r\n\t\t{\r\n\t\t\tconst taxRate = taxList.find((item) => parseInt(item.ID) === parseInt(value));\r\n\t\t\tif (taxRate)\r\n\t\t\t{\r\n\t\t\t\tthis.changeTaxRate(this.parseFloat(taxRate.VALUE));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tchangeTaxRate(value: number): void\r\n\t{\r\n\t\tconst preparedValue = this.parseFloat(value, this.getCommonPrecision());\r\n\r\n\t\tthis.setTaxRate(preparedValue);\r\n\t}\r\n\r\n\tchangeTaxIncluded(value)\r\n\t{\r\n\t\tif (Type.isBoolean(value))\r\n\t\t{\r\n\t\t\tvalue = value ? 'Y' : 'N';\r\n\t\t}\r\n\r\n\t\tthis.setTaxIncluded(value);\r\n\t}\r\n\r\n\tchangeRowSum(value, mode = MODE_SET)\r\n\t{\r\n\t\tconst preparedValue = this.parseFloat(value, this.getPricePrecision());\r\n\r\n\t\tthis.setRowSum(preparedValue, mode);\r\n\t}\r\n\r\n\tchangeProductName(value)\r\n\t{\r\n\t\tconst preparedValue = value.toString();\r\n\t\tconst isChangedValue = this.getField('PRODUCT_NAME') !== preparedValue;\r\n\r\n\t\tif (isChangedValue)\r\n\t\t{\r\n\t\t\tthis.setField('PRODUCT_NAME', preparedValue);\r\n\t\t\tthis.setField('NAME', preparedValue);\r\n\t\t\tthis.addActionProductChange();\r\n\r\n\t\t\tif(!this.isAdjusted()) {\r\n\t\t\t\tlet adjustedRow = this.getAdjustedProductRow();\r\n\t\t\t\tif(adjustedRow) {\r\n\t\t\t\t\t// adjustedRow.changeProductName(value);\r\n\t\t\t\t\tadjustedRow.mainSelector.searchInput.onChangeValue(value);\r\n\t\t\t\t\tadjustedRow.changeProductName(value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.getEditor().deleteApplicationsForRow(this.getField('ID'));\r\n\t\t}\r\n\t}\r\n\r\n\tchangeSort(value, mode = MODE_SET)\r\n\t{\r\n\t\tconst preparedValue = this.parseInt(value);\r\n\r\n\t\tif (mode === MODE_SET)\r\n\t\t{\r\n\t\t\tthis.setField('SORT', preparedValue);\r\n\t\t}\r\n\r\n\t\tconst isChangedValue = this.getField('SORT') !== preparedValue;\r\n\r\n\t\tif (isChangedValue)\r\n\t\t{\r\n\t\t\tthis.addActionProductChange();\r\n\t\t}\r\n\t}\r\n\r\n\tchangeStore(value: number): void\r\n\t{\r\n\t\tif (this.isReserveBlocked())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst preparedValue = Text.toNumber(value);\r\n\t\tif (this.getField('STORE_ID') === preparedValue)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.setField('STORE_ID', preparedValue);\r\n\t\tthis.setField('STORE_AVAILABLE', this.model.getStoreCollection().getStoreAvailableAmount(value));\r\n\r\n\t\tthis.updateUiStoreAmountData();\r\n\t\tthis.addActionProductChange();\r\n\t}\r\n\r\n\t#onChangeStoreData()\r\n\t{\r\n\t\tconst storeId = this.getField('STORE_ID');\r\n\r\n\t\tif (!this.isReserveBlocked() && this.isNewRow())\r\n\t\t{\r\n\t\t\tconst currentAmount = this.getModel().getStoreCollection().getStoreAmount(storeId);\r\n\t\t\tif (currentAmount <= 0 && this.getModel().isChanged())\r\n\t\t\t{\r\n\t\t\t\tconst maxStore = this.getModel().getStoreCollection().getMaxFilledStore();\r\n\t\t\t\tif (maxStore.AMOUNT > currentAmount && this.storeSelector)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.storeSelector.onStoreSelect(maxStore.STORE_ID, Text.decode(maxStore.STORE_TITLE));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.setField('STORE_AVAILABLE', this.model.getStoreCollection().getStoreAvailableAmount(storeId));\r\n\r\n\t\tthis.updateUiStoreAmountData();\r\n\t}\r\n\r\n\tupdateUiStoreAmountData()\r\n\t{\r\n\t\tconst availableWrapper = this.#getNodeChildByDataName('STORE_AVAILABLE');\r\n\t\tif (!Type.isDomNode(availableWrapper))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst storeId = this.getField('STORE_ID');\r\n\t\tconst available = this.model.getStoreCollection().getStoreAvailableAmount(storeId);\r\n\r\n\t\tconst measureName =\r\n\t\t\tType.isStringFilled(this.model.getField('MEASURE_NAME'))\r\n\t\t\t\t? this.model.getField('MEASURE_NAME')\r\n\t\t\t\t: this.editor.getDefaultMeasure()?.SYMBOL || ''\r\n\t\t;\r\n\r\n\t\tif (!this.getModel().isCatalogExisted())\r\n\t\t{\r\n\t\t\tavailableWrapper.innerHTML = '';\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tavailableWrapper.innerHTML = Text.toNumber(available) + ' ' + Text.encode(measureName);\r\n\t\t}\r\n\t}\r\n\r\n\tsetRowReserved(value)\r\n\t{\r\n\t\tthis.setField('ROW_RESERVED', value)\r\n\t\tconst reserveWrapper = this.#getNodeChildByDataName('ROW_RESERVED');\r\n\t\tif (!Type.isDomNode(reserveWrapper))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.getModel().isCatalogExisted())\r\n\t\t{\r\n\t\t\treserveWrapper.innerHTML = '';\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst measureName =\r\n\t\t\tType.isStringFilled(this.model.getField('MEASURE_NAME'))\r\n\t\t\t\t? this.model.getField('MEASURE_NAME')\r\n\t\t\t\t: this.editor.getDefaultMeasure()?.SYMBOL || ''\r\n\t\t;\r\n\r\n\t\treserveWrapper.innerHTML = Text.toNumber(this.getField('ROW_RESERVED')) + ' ' + Text.encode(measureName);\r\n\t}\r\n\r\n\tsetDeductedQuantity(value)\r\n\t{\r\n\t\tthis.setField('DEDUCTED_QUANTITY', value);\r\n\t\tconst deductedWrapper = this.#getNodeChildByDataName('DEDUCTED_QUANTITY');\r\n\t\tif (!Type.isDomNode(deductedWrapper))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.getModel().isCatalogExisted())\r\n\t\t{\r\n\t\t\tdeductedWrapper.innerHTML = '';\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst measureName =\r\n\t\t\tType.isStringFilled(this.model.getField('MEASURE_NAME'))\r\n\t\t\t\t? this.model.getField('MEASURE_NAME')\r\n\t\t\t\t: this.editor.getDefaultMeasure()?.SYMBOL || ''\r\n\t\t;\r\n\r\n\t\tdeductedWrapper.innerHTML = Text.toNumber(this.getField('DEDUCTED_QUANTITY')) + ' ' + Text.encode(measureName);\r\n\t}\r\n\r\n\tchangeStoreName(value: number)\r\n\t{\r\n\t\tconst preparedValue = value.toString();\r\n\t\tthis.setField('STORE_TITLE', preparedValue);\r\n\t\tthis.addActionProductChange();\r\n\t}\r\n\r\n\tchangeDateReserveEnd(value: string)\r\n\t{\r\n\t\tconst preparedValue = Type.isNil(value) ? '' : value.toString();\r\n\t\tthis.setField('DATE_RESERVE_END', preparedValue);\r\n\t\tthis.addActionProductChange();\r\n\t}\r\n\r\n\tchangeReserveQuantity(value: number)\r\n\t{\r\n\t\tconst preparedValue = Text.toNumber(value);\r\n\t\tconst reserveDifference = preparedValue - this.getField('INPUT_RESERVE_QUANTITY');\r\n\r\n\t\tif (reserveDifference == 0 || isNaN(reserveDifference))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst newReserve = this.getField('ROW_RESERVED') + reserveDifference;\r\n\r\n\t\tthis.setField('ROW_RESERVED', newReserve);\r\n\t\tthis.setField('RESERVE_QUANTITY', Math.max(newReserve, 0));\r\n\t\tthis.setField('INPUT_RESERVE_QUANTITY', preparedValue);\r\n\r\n\t\tthis.addActionProductChange();\r\n\t}\r\n\r\n\tresetReserveFields()\r\n\t{\r\n\t\tthis.setField('ROW_RESERVED', null);\r\n\t\tthis.setField('RESERVE_QUANTITY', null);\r\n\t\tthis.setField('INPUT_RESERVE_QUANTITY', null);\r\n\t}\r\n\r\n\trefreshFieldsLayout(exceptFields: Array<string> = []): void\r\n\t{\r\n\t\tfor (const field in this.fields)\r\n\t\t{\r\n\t\t\tif (this.fields.hasOwnProperty(field) && !exceptFields.includes(field))\r\n\t\t\t{\r\n\t\t\t\tthis.updateUiField(field, this.fields[field]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetCalculator(): ProductCalculator\r\n\t{\r\n\t\treturn this.getModel()\r\n\t\t\t.getCalculator()\r\n\t\t\t.setFields(this.getCalculateFields())\r\n\t\t\t.setSettings(this.getEditor().getSettings())\r\n\t\t;\r\n\t}\r\n\r\n\tsetModel(fields: {} = {}, settings: Settings = {}): void\r\n\t{\r\n\t\tconst selectorId = settings.selectorId;\r\n\t\tif (selectorId)\r\n\t\t{\r\n\t\t\tconst model = ProductModel.getById(selectorId);\r\n\t\t\tif (model)\r\n\t\t\t{\r\n\t\t\t\tthis.model = model;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!this.model)\r\n\t\t{\r\n\t\t\tthis.model = new ProductModel({\r\n\t\t\t\tid: selectorId,\r\n\t\t\t\tcurrency: this.getEditor().getCurrencyId(),\r\n\t\t\t\tiblockId: fields['IBLOCK_ID'],\r\n\t\t\t\tbasePriceId: fields['BASE_PRICE_ID'],\r\n\t\t\t\tisSimpleModel: Text.toInteger(fields['PRODUCT_ID']) <= 0 && Type.isStringFilled(fields['NAME']),\r\n\t\t\t\tskuTree: Type.isStringFilled(fields['SKU_TREE']) ? JSON.parse(fields['SKU_TREE']) : null,\r\n\t\t\t\tfields,\r\n\t\t\t});\r\n\r\n\t\t\tconst imageInfo = Type.isStringFilled(fields['IMAGE_INFO']) ? JSON.parse(fields['IMAGE_INFO']) : null\r\n\r\n\t\t\tif (Type.isObject(imageInfo))\r\n\t\t\t{\r\n\t\t\t\tthis.model.getImageCollection().setPreview(imageInfo['preview']);\r\n\t\t\t\tthis.model.getImageCollection().setEditInput(imageInfo['input']);\r\n\t\t\t\tthis.model.getImageCollection().setMorePhotoValues(imageInfo['values']);\r\n\t\t\t}\r\n\r\n\t\t\tif (!Type.isNil(fields['DETAIL_URL']))\r\n\t\t\t{\r\n\t\t\t\tthis.model.setDetailPath(fields['DETAIL_URL']);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.#isReserveEqualProductQuantity())\r\n\t\t{\r\n\t\t\tif (!this.getModel().getField('DATE_RESERVE_END'))\r\n\t\t\t{\r\n\t\t\t\tthis.setField('DATE_RESERVE_END', this.editor.getSettingValue('defaultDateReservation'));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tEventEmitter.subscribe(\r\n\t\t\tthis.model,\r\n\t\t\t'onErrorsChange',\r\n\t\t\tthis.handleProductErrorsChange,\r\n\t\t);\r\n\r\n\t\tEventEmitter.subscribe(\r\n\t\t\tthis.model,\r\n\t\t\t'onChangeStoreData',\r\n\t\t\tthis.handleChangeStoreData,\r\n\t\t);\r\n\t}\r\n\r\n\tgetModel(): ?ProductModel\r\n\t{\r\n\t\treturn this.model;\r\n\t}\r\n\r\n\t#onProductErrorsChange()\r\n\t{\r\n\t\tthis.getEditor().handleProductErrorsChange();\r\n\t}\r\n\r\n\tsetProductId(value)\r\n\t{\r\n\t\tconst isChangedValue = this.getField('PRODUCT_ID') !== value;\r\n\r\n\t\tif (isChangedValue)\r\n\t\t{\r\n\t\t\tthis.getModel().setOption('isSimpleModel', value <= 0 && Type.isStringFilled(this.getField('NAME')));\r\n\t\t\tthis.setField('PRODUCT_ID', value, false);\r\n\t\t\tthis.setField('OFFER_ID', value, false);\r\n\t\t\tthis.storeSelector?.setProductId(value);\r\n\r\n\t\t\tthis.addActionProductChange();\r\n\t\t\tthis.addActionUpdateTotal();\r\n\r\n\t\t\tif (this.#isReserveEqualProductQuantity())\r\n\t\t\t{\r\n\t\t\t\tif (!this.getModel().getField('DATE_RESERVE_END'))\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.setField('DATE_RESERVE_END', this.editor.getSettingValue('defaultDateReservation'));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.resetReserveFields();\r\n\r\n\t\t\t\tthis.onAfterExecuteExternalActions = () => {\r\n\t\t\t\t\tthis.reserveControl?.setReservedQuantity(\r\n\t\t\t\t\t\tthis.getField('QUANTITY'),\r\n\t\t\t\t\t\ttrue\r\n\t\t\t\t\t);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif(!this.isAdjusted()) {\r\n\t\t\t\tlet adjustedRow = this.getAdjustedProductRow();\r\n\t\t\t\tif(adjustedRow) {\r\n\t\t\t\t\tadjustedRow.setProductId(value);\r\n\t\t\t\t\tadjustedRow.changeProductName(this.getField('NAME'))\r\n\t\t\t\t\tadjustedRow.updateUiInputField(['NAME']);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.getEditor().deleteApplicationsForRow(this.getField('ID'));\r\n\t\t}\r\n\t}\r\n\r\n\tisAdjusted() {\r\n\t\treturn !!+this.getField('UF_CRM_PR_ADJUSTMENT');\r\n\t}\r\n\r\n\tsetPrice(value)\r\n\t{\r\n\t\tconst originalPrice = value;\r\n\t\t// price can't be less than zero\r\n\t\tvalue = Math.max(value, 0);\r\n\t\tconst calculatedFields = this.getCalculator()\r\n\t\t\t.setFields(this.getCalculator().calculateBasePrice(this.getBasePrice()))\r\n\t\t\t.calculatePrice(value)\r\n\t\t;\r\n\r\n\t\tdelete(calculatedFields['BASE_PRICE']);\r\n\t\tthis.setFields(calculatedFields);\r\n\t\tthis.refreshFieldsLayout(['PRICE_NETTO', 'PRICE_BRUTTO']);\r\n\t\tthis.addActionProductChange();\r\n\t\tthis.addActionUpdateTotal();\r\n\t\tthis.executeExternalActions();\r\n\t\tthis.#togglePriceHintPopup(originalPrice < 0 && originalPrice !== value);\r\n\t}\r\n\r\n\tsetBasePrice(value, mode = MODE_SET)\r\n\t{\r\n\t\tconst originalPrice = value;\r\n\t\t// price can't be less than zero\r\n\t\tvalue = Math.max(value, 0);\r\n\r\n\t\tif (mode === MODE_SET)\r\n\t\t{\r\n\t\t\tthis.updateUiInputField('PRICE', value.toFixed(this.getPricePrecision()));\r\n\t\t}\r\n\r\n\t\tconst isChangedValue = this.getBasePrice() !== value;\r\n\t\tif (isChangedValue)\r\n\t\t{\r\n\t\t\tconst calculatedFields = this.getCalculator().calculateBasePrice(value);\r\n\t\t\tthis.setFields(calculatedFields);\r\n\r\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['BASE_PRICE', 'PRICE', 'ENTERED_PRICE'] : [];\r\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\r\n\r\n\t\t\tthis.addActionProductChange();\r\n\t\t\tthis.addActionUpdateTotal();\r\n\t\t}\r\n\r\n\t\tthis.#togglePriceHintPopup(originalPrice < 0 && originalPrice !== value);\r\n\t}\r\n\r\n\t#shouldShowSmallPriceHint(): boolean\r\n\t{\r\n\t\treturn (\r\n\t\t\tText.toNumber(this.getField('PRICE')) > 0\r\n\t\t\t&& Text.toNumber(this.getField('PRICE')) < 1\r\n\t\t\t&& this.isDiscountPercentage()\r\n\t\t\t&& (\r\n\t\t\t\tText.toNumber(this.getField('DISCOUNT_SUM')) > 0\r\n\t\t\t\t|| Text.toNumber(this.getField('DISCOUNT_RATE')) > 0\r\n\t\t\t\t|| Text.toNumber(this.getField('DISCOUNT_ROW')) > 0\r\n\t\t\t)\r\n\t\t);\r\n\t}\r\n\r\n\t#togglePriceHintPopup(showNegative: boolean = false): void\r\n\t{\r\n\t\tif (this.#shouldShowSmallPriceHint())\r\n\t\t{\r\n\t\t\tthis.getHintPopup()\r\n\t\t\t\t.load(\r\n\t\t\t\t\tthis.getInputByFieldName('PRICE'),\r\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_SMALL_PRICE_NOTICE')\r\n\t\t\t\t)\r\n\t\t\t\t.show()\r\n\t\t\t;\r\n\t\t}\r\n\t\telse if (showNegative)\r\n\t\t{\r\n\t\t\tthis.getHintPopup()\r\n\t\t\t\t.load(\r\n\t\t\t\t\tthis.getInputByFieldName('PRICE'),\r\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_NEGATIVE_PRICE_NOTICE')\r\n\t\t\t\t)\r\n\t\t\t\t.show()\r\n\t\t\t;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.getHintPopup().close();\r\n\t\t}\r\n\t}\r\n\r\n\t#toggleMinimalPricePopup(show: boolean = false): void\r\n\t{\r\n\t\tif (show)\r\n\t\t{\r\n\t\t\tthis.getHintPopup()\r\n\t\t\t\t.load(\r\n\t\t\t\t\tthis.getInputByFieldName('PRICE'),\r\n\t\t\t\t\tLoc.getMessage('CRM_ENTITY_PL_MINIMAL_PRICE_NOTICE')\r\n\t\t\t\t)\r\n\t\t\t\t.show()\r\n\t\t\t;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.getHintPopup().close();\r\n\t\t}\r\n\t}\r\n\r\n\tsetQuantity(value, mode = MODE_SET)\r\n\t{\r\n\t\tif (mode === MODE_SET)\r\n\t\t{\r\n\t\t\tthis.updateUiInputField('QUANTITY', value);\r\n\t\t}\r\n\r\n\t\tconst isChangedValue = this.getField('QUANTITY') !== value;\r\n\t\tif (isChangedValue)\r\n\t\t{\r\n\t\t\tconst errorNotifyId = 'quantityReservedCountError';\r\n\t\t\tconst notify = BX.UI.Notification.Center.getBalloonById(errorNotifyId);\r\n\t\t\tif (notify)\r\n\t\t\t{\r\n\t\t\t\tnotify.close();\r\n\t\t\t}\r\n\r\n\t\t\tconst calculatedFields = this.getCalculator().calculateQuantity(value);\r\n\t\t\tthis.setFields(calculatedFields);\r\n\t\t\tthis.refreshFieldsLayout(['QUANTITY']);\r\n\r\n\t\t\tthis.addActionProductChange();\r\n\t\t\tthis.addActionUpdateTotal();\r\n\t\t}\r\n\t}\r\n\r\n\tsetReserveQuantity(value)\r\n\t{\r\n\t\tconst node = this.#getNodeChildByDataName('RESERVE_INFO');\r\n\t\tconst input = node?.querySelector('input[name=\"INPUT_RESERVE_QUANTITY\"]');\r\n\t\tif (Type.isElementNode(input))\r\n\t\t{\r\n\t\t\tinput.value = value;\r\n\t\t\tthis.reserveControl?.changeInputValue(value);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.changeReserveQuantity(value)\r\n\t\t}\r\n\t}\r\n\r\n\tsetMeasure(measure, mode = MODE_SET)\r\n\t{\r\n\t\tthis.setField('MEASURE_CODE', measure.CODE);\r\n\t\tthis.setField('MEASURE_NAME', measure.SYMBOL);\r\n\r\n\t\tthis.updateUiMoneyField('MEASURE_CODE', measure.CODE, Text.encode(measure.SYMBOL));\r\n\r\n\t\tif (this.getModel().isNew())\r\n\t\t{\r\n\t\t\tthis.getModel().save(['MEASURE_CODE']);\r\n\t\t}\r\n\t\telse if (mode === MODE_EDIT)\r\n\t\t{\r\n\t\t\tthis.getModel().showSaveNotifier(\r\n\t\t\t\t'measureChanger_' + this.getId(),\r\n\t\t\t\t{\r\n\t\t\t\t\ttitle: Loc.getMessage('CATALOG_PRODUCT_MODEL_SAVING_NOTIFICATION_MEASURE_CHANGED_QUERY'),\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tonSave: () => {\r\n\t\t\t\t\t\t\tthis.getModel().save(['MEASURE_CODE', 'MEASURE_NAME']);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tthis.addActionProductChange();\r\n\t}\r\n\r\n\tsetDiscount(value, mode = MODE_SET)\r\n\t{\r\n\t\tif (!this.isDiscountHandmade())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst fieldName = this.isDiscountPercentage() ? 'DISCOUNT_RATE' : 'DISCOUNT_SUM';\r\n\t\tconst isChangedValue = this.getField(fieldName) !== value;\r\n\t\tif (isChangedValue)\r\n\t\t{\r\n\t\t\tconst calculatedFields = this.getCalculator().calculateDiscount(value);\r\n\t\t\tthis.setFields(calculatedFields);\r\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['DISCOUNT_RATE', 'DISCOUNT_SUM', 'DISCOUNT'] : [];\r\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\r\n\r\n\t\t\tthis.addActionProductChange();\r\n\t\t\tthis.addActionUpdateTotal();\r\n\t\t}\r\n\r\n\t\tthis.#togglePriceHintPopup();\r\n\t}\r\n\r\n\tsetDiscountType(value)\r\n\t{\r\n\t\tconst isChangedValue = value !== DiscountType.UNDEFINED\r\n\t\t\t&& this.getField('DISCOUNT_TYPE_ID') !== value;\r\n\r\n\t\tif (isChangedValue)\r\n\t\t{\r\n\t\t\tconst calculatedFields = this.getCalculator().calculateDiscountType(value);\r\n\t\t\tthis.setFields(calculatedFields);\r\n\t\t\tthis.refreshFieldsLayout();\r\n\r\n\t\t\tthis.addActionProductChange();\r\n\t\t\tthis.addActionUpdateTotal();\r\n\t\t}\r\n\t}\r\n\r\n\tsetRowDiscount(value, mode = MODE_SET)\r\n\t{\r\n\t\tconst isChangedValue = this.getField('DISCOUNT_ROW') !== value;\r\n\t\tif (isChangedValue)\r\n\t\t{\r\n\t\t\tconst calculatedFields = this.getCalculator().calculateRowDiscount(value);\r\n\t\t\tthis.setFields(calculatedFields);\r\n\r\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['DISCOUNT_ROW'] : [];\r\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\r\n\r\n\t\t\tthis.addActionProductChange();\r\n\t\t\tthis.addActionUpdateTotal();\r\n\t\t}\r\n\t}\r\n\r\n\tsetTaxRate(value)\r\n\t{\r\n\t\tif (!this.getEditor().isTaxAllowed())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst isChangedValue = this.getTaxRate() !== value;\r\n\t\tif (isChangedValue)\r\n\t\t{\r\n\t\t\tconst calculatedFields = this.getCalculator().calculateTax(value);\r\n\t\t\tthis.setFields(calculatedFields);\r\n\t\t\tthis.refreshFieldsLayout();\r\n\r\n\t\t\tthis.addActionProductChange();\r\n\t\t\tthis.addActionUpdateTotal();\r\n\t\t}\r\n\t}\r\n\r\n\tsetTaxIncluded(value: 'Y' | 'N', mode = MODE_SET)\r\n\t{\r\n\t\tif (!this.getEditor().isTaxAllowed())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (mode === MODE_SET)\r\n\t\t{\r\n\t\t\tthis.updateUiCheckboxField('TAX_INCLUDED', value);\r\n\t\t}\r\n\r\n\t\tconst isChangedValue = this.getTaxIncluded() !== value;\r\n\t\tif (isChangedValue)\r\n\t\t{\r\n\t\t\tconst calculatedFields = this.getCalculator().calculateTaxIncluded(value);\r\n\t\t\tthis.setFields(calculatedFields);\r\n\t\t\tthis.refreshFieldsLayout();\r\n\r\n\t\t\tthis.addActionUpdateFieldList('TAX_INCLUDED', value);\r\n\t\t\tthis.addActionProductChange();\r\n\t\t\tthis.addActionUpdateTotal();\r\n\t\t}\r\n\t}\r\n\r\n\tsetRowSum(value, mode = MODE_SET)\r\n\t{\r\n\t\tconst isChangedValue = this.getField('SUM') !== value;\r\n\t\tif (isChangedValue)\r\n\t\t{\r\n\t\t\tconst calculatedFields = this.getCalculator().calculateRowSum(value);\r\n\t\t\tthis.setFields(calculatedFields);\r\n\t\t\tconst exceptFieldNames = (mode === MODE_EDIT) ? ['SUM'] : [];\r\n\t\t\tthis.refreshFieldsLayout(exceptFieldNames);\r\n\r\n\t\t\tthis.addActionProductChange();\r\n\t\t\tthis.addActionUpdateTotal();\r\n\t\t}\r\n\t}\r\n\r\n\t// controls\r\n\tgetInputByFieldName(fieldName: string): ?HTMLElement\r\n\t{\r\n\t\tconst fieldId = this.getUiFieldId(fieldName);\r\n\t\tlet item = document.getElementById(fieldId);\r\n\r\n\t\tif (!Type.isElementNode(item))\r\n\t\t{\r\n\t\t\titem = this.getNode().querySelector('[name=\"' + fieldId + '\"]');\r\n\t\t}\r\n\r\n\t\treturn item;\r\n\t}\r\n\r\n\tupdateUiInputField(name, value)\r\n\t{\r\n\t\tconst item = this.getInputByFieldName(name);\r\n\r\n\t\tif (Type.isElementNode(item))\r\n\t\t{\r\n\t\t\titem.value = value;\r\n\t\t}\r\n\t}\r\n\r\n\tupdateUiCheckboxField(name, value)\r\n\t{\r\n\t\tconst item = this.getInputByFieldName(name);\r\n\r\n\t\tif (Type.isElementNode(item))\r\n\t\t{\r\n\t\t\titem.checked = value === 'Y';\r\n\t\t}\r\n\t}\r\n\r\n\tdisableUiField(name, disabled = true) {\r\n\t\tconst item = this.getInputByFieldName(name);\r\n\r\n\t\tif (Type.isElementNode(item))\r\n\t\t{\r\n\t\t\titem.disabled = disabled;\r\n\t\t}\r\n\t}\r\n\r\n\tupdateUiDiscountTypeField(name: string, value: number): void\r\n\t{\r\n\t\tconst text =\r\n\t\t\tvalue === DiscountType.MONETARY\r\n\t\t\t\t? this.getEditor().getCurrencyText()\r\n\t\t\t\t: '%'\r\n\t\t;\r\n\r\n\t\tthis.updateUiMoneyField(name, value, text);\r\n\t}\r\n\r\n\tgetMoneyFieldDropdownApi(name): ?BX.Main.dropdown\r\n\t{\r\n\t\tif (!Reflection.getClass('BX.Main.dropdownManager'))\r\n\t\t{\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn BX.Main.dropdownManager.getById(this.getId() + '_' + name + '_control');\r\n\t}\r\n\r\n\tupdateMoneyFieldUiWithDropdownApi(dropdown: BX.Main.dropdown, value: number | string)\r\n\t{\r\n\t\tif (dropdown.getValue() === value)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst item = dropdown.menu.itemsContainer.querySelector('[data-value=\"' + value + '\"]');\r\n\t\tconst menuItem = item && dropdown.getMenuItem(item);\r\n\t\tif (menuItem)\r\n\t\t{\r\n\t\t\tdropdown.refresh(menuItem);\r\n\t\t\tdropdown.selectItem(menuItem);\r\n\t\t}\r\n\t}\r\n\r\n\tupdateMoneyFieldUiManually(name: string, value: number | string, text: string): void\r\n\t{\r\n\t\tconst item = this.getInputByFieldName(name);\r\n\t\tif (!Type.isElementNode(item))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\titem.dataset.value = value;\r\n\r\n\t\tconst span = item.querySelector('span.main-dropdown-inner');\r\n\t\tif (!Type.isElementNode(span))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tspan.innerHTML = text;\r\n\t}\r\n\r\n\tupdateUiMoneyField(name: string, value: number | string, text: string): void\r\n\t{\r\n\t\tconst dropdownApi = this.getMoneyFieldDropdownApi(name);\r\n\t\tif (dropdownApi)\r\n\t\t{\r\n\t\t\tthis.updateMoneyFieldUiWithDropdownApi(dropdownApi, value);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.updateMoneyFieldUiManually(name, value, text);\r\n\t\t}\r\n\t}\r\n\r\n\tupdateUiMeasure(code, name)\r\n\t{\r\n\t\tthis.updateUiMoneyField(\r\n\t\t\t'MEASURE_CODE',\r\n\t\t\tcode,\r\n\t\t\tname\r\n\t\t);\r\n\r\n\t\tthis.updateUiStoreAmountData();\r\n\t}\r\n\r\n\tupdateUiHtmlField(name, html)\r\n\t{\r\n\t\tconst item = this.getNode().querySelector('[data-name=\"' + name + '\"]');\r\n\r\n\t\tif (Type.isElementNode(item))\r\n\t\t{\r\n\t\t\titem.innerHTML = html;\r\n\t\t}\r\n\t}\r\n\r\n\tupdateUiCurrencyFields()\r\n\t{\r\n\t\tconst currencyText = this.getEditor().getCurrencyText();\r\n\t\tconst currencyId = '' + this.getEditor().getCurrencyId();\r\n\r\n\t\tconst currencyFieldNames = ['PRICE_CURRENCY', 'SUM_CURRENCY', 'DISCOUNT_TYPE_ID', 'DISCOUNT_ROW_CURRENCY'];\r\n\t\tcurrencyFieldNames.forEach((name) => {\r\n\t\t\tconst dropdownValues = [];\r\n\t\t\tif (name === 'DISCOUNT_TYPE_ID')\r\n\t\t\t{\r\n\t\t\t\tdropdownValues.push({\r\n\t\t\t\t\tNAME: '%',\r\n\t\t\t\t\tVALUE: '' + DiscountType.PERCENTAGE\r\n\t\t\t\t});\r\n\t\t\t\tdropdownValues.push({\r\n\t\t\t\t\tNAME: currencyText,\r\n\t\t\t\t\tVALUE: '' + DiscountType.MONETARY\r\n\t\t\t\t});\r\n\t\t\t\tif (this.getDiscountType() === DiscountType.MONETARY)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.updateMoneyFieldUiManually(name, DiscountType.MONETARY, currencyText);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tdropdownValues.push({\r\n\t\t\t\t\tNAME: currencyText,\r\n\t\t\t\t\tVALUE: currencyId\r\n\t\t\t\t});\r\n\t\t\t\tthis.updateUiMoneyField(name, currencyId, currencyText);\r\n\t\t\t}\r\n\r\n\t\t\tDom.attr(this.getInputByFieldName(name), 'data-items', dropdownValues);\r\n\t\t});\r\n\r\n\t\tthis.updateUiField('TAX_SUM', this.getField('TAX_SUM'));\r\n\t}\r\n\r\n\tupdateUiField(field, value): void\r\n\t{\r\n\t\tconst uiName = this.getUiFieldName(field);\r\n\t\tif (!uiName)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst uiType = this.getUiFieldType(field);\r\n\t\tif (!uiType)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.allowUpdateUiField(field))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tswitch (uiType)\r\n\t\t{\r\n\t\t\tcase 'input':\r\n\t\t\t\tif (field === 'QUANTITY')\r\n\t\t\t\t{\r\n\t\t\t\t\tvalue = this.parseFloat(value, this.getQuantityPrecision());\r\n\t\t\t\t}\r\n\t\t\t\telse if (field === 'DISCOUNT_RATE' || field === 'TAX_RATE')\r\n\t\t\t\t{\r\n\t\t\t\t\tvalue = this.parseFloat(value, this.getCommonPrecision());\r\n\t\t\t\t}\r\n\t\t\t\telse if (value === 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tvalue = '';\r\n\t\t\t\t}\r\n\t\t\t\telse if (Type.isNumber(value))\r\n\t\t\t\t{\r\n\t\t\t\t\tvalue = this\r\n\t\t\t\t\t\t.parseFloat(value, this.getPricePrecision())\r\n\t\t\t\t\t\t.toFixed(this.getPricePrecision())\r\n\t\t\t\t\t;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.updateUiInputField(uiName, value);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'checkbox':\r\n\t\t\t\tthis.updateUiCheckboxField(uiName, value);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'discount_type_field':\r\n\t\t\t\tthis.updateUiDiscountTypeField(uiName, value);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'html':\r\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'money_html':\r\n\t\t\t\tvalue = CurrencyCore.currencyFormat(value, this.getEditor().getCurrencyId(), true);\r\n\t\t\t\tthis.updateUiHtmlField(uiName, value);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tgetUiFieldName(field)\r\n\t{\r\n\t\tlet result = null;\r\n\r\n\t\tswitch (field)\r\n\t\t{\r\n\t\t\tcase 'QUANTITY':\r\n\t\t\tcase 'MEASURE_CODE':\r\n\t\t\tcase 'DISCOUNT_ROW':\r\n\t\t\tcase 'DISCOUNT_TYPE_ID':\r\n\t\t\tcase 'TAX_RATE':\r\n\t\t\tcase 'TAX_INCLUDED':\r\n\t\t\tcase 'TAX_SUM':\r\n\t\t\tcase 'SUM':\r\n\t\t\tcase 'PRODUCT_NAME':\r\n\t\t\tcase 'SORT':\r\n\t\t\t\tresult = field;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'ENTERED_PRICE':\r\n\t\t\t\tresult = 'PRICE';\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'DISCOUNT_RATE':\r\n\t\t\tcase 'DISCOUNT_SUM':\r\n\t\t\t\tresult = 'DISCOUNT_PRICE';\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetUiFieldType(field)\r\n\t{\r\n\t\tlet result = null;\r\n\r\n\t\tswitch (field)\r\n\t\t{\r\n\t\t\tcase 'PRICE':\r\n\t\t\tcase 'ENTERED_PRICE':\r\n\t\t\tcase 'QUANTITY':\r\n\t\t\tcase 'TAX_RATE':\r\n\t\t\tcase 'DISCOUNT_RATE':\r\n\t\t\tcase 'DISCOUNT_SUM':\r\n\t\t\tcase 'DISCOUNT_ROW':\r\n\t\t\tcase 'SUM':\r\n\t\t\tcase 'PRODUCT_NAME':\r\n\t\t\tcase 'SORT':\r\n\t\t\t\tresult = 'input';\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'DISCOUNT_TYPE_ID':\r\n\t\t\t\tresult = 'discount_type_field';\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'TAX_INCLUDED':\r\n\t\t\t\tresult = 'checkbox';\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'TAX_SUM':\r\n\t\t\t\tresult = 'money_html';\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tallowUpdateUiField(field)\r\n\t{\r\n\t\tlet result = true;\r\n\r\n\t\tswitch (field)\r\n\t\t{\r\n\t\t\tcase 'PRICE_NETTO':\r\n\t\t\t\tresult = this.isPriceNetto();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'PRICE_BRUTTO':\r\n\t\t\t\tresult = !this.isPriceNetto();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'DISCOUNT_RATE':\r\n\t\t\t\tresult = this.isDiscountPercentage();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'DISCOUNT_SUM':\r\n\t\t\t\tresult = this.isDiscountMonetary();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t// proxy\r\n\tparseInt(value: number | string, defaultValue: number = 0)\r\n\t{\r\n\t\treturn this.getEditor().parseInt(value, defaultValue);\r\n\t}\r\n\r\n\tparseFloat(value: number | string, precision: number, defaultValue = 0)\r\n\t{\r\n\t\treturn this.getEditor().parseFloat(value, precision, defaultValue);\r\n\t}\r\n\r\n\tgetPricePrecision()\r\n\t{\r\n\t\treturn this.getEditor().getPricePrecision();\r\n\t}\r\n\r\n\tgetQuantityPrecision()\r\n\t{\r\n\t\treturn this.getEditor().getQuantityPrecision();\r\n\t}\r\n\r\n\tgetCommonPrecision()\r\n\t{\r\n\t\treturn this.getEditor().getCommonPrecision();\r\n\t}\r\n\r\n\tresetExternalActions()\r\n\t{\r\n\t\tthis.externalActions.length = 0;\r\n\t}\r\n\r\n\taddExternalAction(action: Action)\r\n\t{\r\n\t\tthis.externalActions.push(action);\r\n\t}\r\n\r\n\taddActionProductChange()\r\n\t{\r\n\t\tthis.addExternalAction({\r\n\t\t\ttype: this.getEditor().actions.productChange,\r\n\t\t\tid: this.getId()\r\n\t\t});\r\n\t}\r\n\r\n\taddActionDisableSaveButton()\r\n\t{\r\n\t\tthis.addExternalAction({\r\n\t\t\ttype: this.getEditor().actions.disableSaveButton,\r\n\t\t\tid: this.getId()\r\n\t\t});\r\n\t}\r\n\r\n\taddActionUpdateFieldList(field, value)\r\n\t{\r\n\t\tthis.addExternalAction({\r\n\t\t\ttype: this.getEditor().actions.updateListField,\r\n\t\t\tfield,\r\n\t\t\tvalue\r\n\t\t});\r\n\t}\r\n\r\n\taddActionStateChanged()\r\n\t{\r\n\t\tthis.addExternalAction({\r\n\t\t\ttype: this.getEditor().actions.stateChanged,\r\n\t\t\tvalue: true\r\n\t\t});\r\n\t}\r\n\r\n\taddActionStateReset()\r\n\t{\r\n\t\tthis.addExternalAction({\r\n\t\t\ttype: this.getEditor().actions.stateChanged,\r\n\t\t\tvalue: false\r\n\t\t});\r\n\t}\r\n\r\n\taddActionUpdateTotal()\r\n\t{\r\n\t\tthis.addExternalAction({\r\n\t\t\ttype: this.getEditor().actions.updateTotal\r\n\t\t});\r\n\t}\r\n\r\n\texecuteExternalActions()\r\n\t{\r\n\t\tif (this.externalActions.length === 0)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.getEditor().executeActions(this.externalActions);\r\n\t\tthis.resetExternalActions();\r\n\r\n\t\tif (this.onAfterExecuteExternalActions)\r\n\t\t{\r\n\t\t\tthis.onAfterExecuteExternalActions.call();\r\n\t\t\tthis.onAfterExecuteExternalActions = null;\r\n\t\t}\r\n\t}\r\n\r\n\tisEmpty()\r\n\t{\r\n\t\treturn (\r\n\t\t\t!Type.isStringFilled(this.getField('PRODUCT_NAME', '').trim())\r\n\t\t\t&& this.getField('PRODUCT_ID', 0) <= 0\r\n\t\t\t&& this.getPrice() <= 0\r\n\t\t)\r\n\t}\r\n\r\n\tisReserveBlocked()\r\n\t{\r\n\t\treturn this.getSettingValue('isReserveBlocked', false);\r\n\t}\r\n\r\n\t#isReserveEqualProductQuantity(): Boolean\r\n\t{\r\n\t\treturn this.editor.getSettingValue('isReserveEqualProductQuantity', false);\r\n\t}\r\n\r\n\t#getNodeChildByDataName(name: String): HTMLElement\r\n\t{\r\n\t\treturn this.getNode().querySelector(`[data-name=\"${name}\"]`);\r\n\t}\r\n\r\n\t#onGridUpdated(): void\r\n\t{\r\n\t\tif (this.storeAvailablePopup)\r\n\t\t{\r\n\t\t\tthis.storeAvailablePopup.refreshStoreInfo();\r\n\t\t}\r\n\t}\r\n}\r\n","export class PageEventsManager\n{\n\t_settings = {};\n\n\tconstructor(settings)\n\t{\n\t\tthis._settings = settings ? settings : {};\n\t\tthis.eventHandlers = {};\n\t}\n\n\tregisterEventHandler(eventName, eventHandler)\n\t{\n\t\tif (!this.eventHandlers[eventName])\n\t\t\tthis.eventHandlers[eventName] = [];\n\t\tthis.eventHandlers[eventName].push(eventHandler);\n\t\tBX.addCustomEvent(this, eventName, eventHandler);\n\t}\n\n\tfireEvent(eventName, eventParams)\n\t{\n\t\tBX.onCustomEvent(this, eventName, eventParams);\n\t}\n\n\tunregisterEventHandlers(eventName)\n\t{\n\t\tif (this.eventHandlers[eventName])\n\t\t{\n\t\t\tfor (var i = 0; i < this.eventHandlers[eventName].length; i++)\n\t\t\t{\n\t\t\t\tBX.removeCustomEvent(this, eventName, this.eventHandlers[eventName][i]);\n\t\t\t}\n\t\t\tdelete this.eventHandlers[eventName];\n\t\t}\n\t}\n}","import {Popup} from 'main.popup';\nimport {ajax, Cache, Event, Loc, Tag, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Editor} from './product.list.editor';\nimport {DialogDisable, Slider, EventType} from 'catalog.store-use'\n\nexport default class SettingsPopup\n{\n\t#target: HTMLElement;\n\t#settings: [];\n\t#editor: Editor;\n\t#cache = new Cache.MemoryCache();\n\n\tconstructor(target: HTMLElement, settings = [], editor: Editor)\n\t{\n\t\tthis.#target = target;\n\t\tthis.#settings = settings;\n\t\tthis.#editor = editor;\n\t}\n\n\tshow()\n\t{\n\t\tthis.getPopup().show();\n\t}\n\n\tgetPopup()\n\t{\n\t\treturn this.#cache.remember('settings-popup', () => {\n\t\t\treturn new Popup(\n\t\t\t\tthis.#editor.getId() + '_' + Math.random() * 100,\n\t\t\t\tthis.#target,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tdraggable: false,\n\t\t\t\t\toffsetLeft: 0,\n\t\t\t\t\toffsetTop: 0,\n\t\t\t\t\tangle: {position: 'top', offset: 43},\n\t\t\t\t\tnoAllPaddings: true,\n\t\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcontent: this.#prepareSettingsContent()\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t}\n\n\tgetSetting(id: string)\n\t{\n\t\treturn this.#settings.filter(item => {\n\t\t\treturn item.id === id;\n\t\t})[0];\n\t}\n\n\t#prepareSettingsContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div class='ui-entity-editor-popup-create-field-list'></div>\n\t\t`;\n\n\t\tthis.#settings.forEach(item => {\n\t\t\tcontent.append(this.#getSettingItem(item));\n\t\t});\n\n\t\treturn content;\n\t}\n\n\t#getSettingItem(item): HTMLElement\n\t{\n\t\tconst input = Tag.render`\n\t\t\t<input type=\"checkbox\">\n\t\t`;\n\t\tinput.checked = item.checked;\n\t\tinput.disabled = item.disabled ?? false;\n\t\tinput.dataset.settingId = item.id;\n\n\t\tconst descriptionNode = (\n\t\t\tType.isStringFilled(item.desc)\n\t\t\t\t? Tag.render`<span class=\"ui-entity-editor-popup-create-field-item-desc\">${item.desc}</span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst hintNode = (\n\t\t\tType.isStringFilled(item.hint)\n\t\t\t\t? Tag.render`<span class=\"crm-entity-product-list-setting-hint\" data-hint=\"${item.hint}\"></span>`\n\t\t\t\t: ''\n\t\t);\n\n\t\tconst setting = Tag.render`\n\t\t\t<label class=\"ui-ctl-block ui-entity-editor-popup-create-field-item ui-ctl-w100\">\n\t\t\t\t<div class=\"ui-ctl-w10\" style=\"text-align: center\">${input}</div>\n\t\t\t\t<div class=\"ui-ctl-w75\">\n\t\t\t\t\t<span class=\"ui-entity-editor-popup-create-field-item-title ${item.disabled ? 'crm-entity-product-list-disabled-setting' : ''}\">${item.title}${hintNode}</span>\n\t\t\t\t\t${descriptionNode}\n\t\t\t\t</div>\n\t\t\t</label>\n\t\t`;\n\n\t\tBX.UI.Hint.init(setting);\n\n\t\tif (item.id === 'SLIDER')\n\t\t{\n\t\t\tEvent.bind(setting, 'change', (event) =>\n\t\t\t{\n\t\t\t\tnew Slider().open(item.url, {})\n\t\t\t\t\t.then(() => this.#editor.reloadGrid(false));\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEvent.bind(setting, 'change', this.#setSetting.bind(this));\n\t\t}\n\n\t\treturn setting;\n\t}\n\n\t#setSetting(event: BaseEvent): void\n\t{\n\t\tconst settingItem = this.getSetting(event.target.dataset.settingId);\n\t\tif (!settingItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst settingEnabled = event.target.checked;\n\t\tthis.requestGridSettings(settingItem, settingEnabled);\n\t}\n\n\trequestGridSettings(setting, enabled)\n\t{\n\t\tconst headers = [];\n\t\tconst cells = this.#editor.getGrid().getRows().getHeadFirstChild().getCells();\n\n\t\tArray.from(cells).forEach((header) => {\n\t\t\tif ('name' in header.dataset)\n\t\t\t{\n\t\t\t\theaders.push(header.dataset.name);\n\t\t\t}\n\t\t});\n\n\t\tajax.runComponentAction(\n\t\t\tthis.#editor.getComponentName(),\n\t\t\t'setGridSetting',\n\t\t\t{\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: {\n\t\t\t\t\tsignedParameters: this.#editor.getSignedParameters(),\n\t\t\t\t\tsettingId: setting.id,\n\t\t\t\t\tselected: enabled,\n\t\t\t\t\tcurrentHeaders: headers\n\t\t\t\t}\n\t\t\t}\n\t\t).then(() => {\n\t\t\tlet message;\n\t\t\tsetting.checked = enabled;\n\t\t\tif (setting.id === 'ADD_NEW_ROW_TOP')\n\t\t\t{\n\t\t\t\tconst panel = enabled ? 'top' : 'bottom';\n\t\t\t\tthis.#editor.setSettingValue('newRowPosition', panel);\n\t\t\t\tconst activePanel = this.#editor.changeActivePanelButtons(panel);\n\t\t\t\tconst settingButton = activePanel.querySelector('[data-role=\"product-list-settings-button\"]');\n\t\t\t\tthis.getPopup().setBindElement(settingButton);\n\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_PL_SETTING_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_PL_SETTING_DISABLED');\n\t\t\t\tmessage = message.replace('#NAME#', setting.title);\n\t\t\t}\n\t\t\telse if(setting.id === 'WAREHOUSE')\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid(false);\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_CARD_WAREHOUSE_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_CARD_WAREHOUSE_DISABLED');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#editor.reloadGrid();\n\n\t\t\t\tmessage = enabled\n\t\t\t\t\t? Loc.getMessage('CRM_ENTITY_PL_SETTING_ENABLED')\n\t\t\t\t\t: Loc.getMessage('CRM_ENTITY_PL_SETTING_DISABLED');\n\t\t\t\tmessage = message.replace('#NAME#', setting.title)\n\t\t\t}\n\t\t\tthis.getPopup().close();\n\n\t\t\tthis.#showNotification(message, {\n\t\t\t\tcategory: 'popup-settings'\n\t\t\t});\n\t\t});\n\t}\n\n\t#showNotification(content: string, options)\n\t{\n\t\toptions = options || {};\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: content,\n\t\t\tstack: options.stack || null,\n\t\t\tposition: 'top-right',\n\t\t\twidth: 'auto',\n\t\t\tcategory: options.category || null,\n\t\t\tautoHideDelay: options.autoHideDelay || 3000\n\t\t});\n\t}\n\n\tupdateCheckboxState(): void\n\t{\n\t\tconst popupContainer = this.getPopup().getContentContainer();\n\n\t\tthis.#settings\n\t\t\t.filter(item => item.action === 'grid' && Type.isArray(item.columns))\n\t\t\t.forEach(item => {\n\t\t\t\tlet allColumnsExist = true;\n\n\t\t\t\titem.columns.forEach(columnName => {\n\t\t\t\t\tif (!this.#editor.getGrid().getColumnHeaderCellByName(columnName))\n\t\t\t\t\t{\n\t\t\t\t\t\tallColumnsExist = false;\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tconst checkbox = popupContainer.querySelector('input[data-setting-id=\"' + item.id + '\"]');\n\t\t\t\tif (Type.isDomNode(checkbox))\n\t\t\t\t{\n\t\t\t\t\tcheckbox.checked = allColumnsExist;\n\t\t\t\t}\n\t\t\t});\n\t}\n}","import {ajax, Cache, Dom, Event, Loc, Reflection, Runtime, Tag, Text, Type} from 'main.core';\r\nimport {BaseEvent, EventEmitter} from 'main.core.events';\r\nimport {Row} from './product.list.row';\r\nimport {PageEventsManager} from './page.events.manager';\r\nimport {DiscountType} from 'catalog.product-calculator';\r\nimport SettingsPopup from './settings.button';\r\nimport {CurrencyCore} from 'currency.currency-core';\r\n//import {ProductSelector} from 'catalog.product-selector';\r\nimport {ProductSelector} from './product-selector/product-selector';\r\nimport HintPopup from './hint.popup';\r\nimport {ProductModel} from \"catalog.product-model\";\r\nimport {PULL} from 'pull.client';\r\nimport {Popup} from \"main.popup\";\r\n\r\nconst GRID_TEMPLATE_ROW = 'template_0';\r\nconst DEFAULT_PRECISION: number = 2;\r\n\r\nexport class Editor\r\n{\r\n\tid: ?string;\r\n\tsettings: Object;\r\n\tajaxPool: Map = new Map();\r\n\tcontroller: ?BX.Crm.EntityProductListController;\r\n\tcontainer: ?HTMLElement;\r\n\tform: ?HTMLElement\r\n\tproducts: Row[] = [];\r\n\tproductsWasInitiated = false;\r\n\tisChangedGrid = false;\r\n\tpageEventsManager: PageEventsManager;\r\n\tcache = new Cache.MemoryCache();\r\n\r\n\tactions = {\r\n\t\tdisableSaveButton: 'disableSaveButton',\r\n\t\tproductChange: 'productChange',\r\n\t\tproductListChanged: 'productListChanged',\r\n\t\tupdateListField: 'listField',\r\n\t\tstateChanged: 'stateChange',\r\n\t\tupdateTotal: 'total'\r\n\t};\r\n\r\n\tstateChange = {\r\n\t\tchanged: false,\r\n\t\tsended: false\r\n\t};\r\n\r\n\tupdateFieldForList = null;\r\n\r\n\ttotalData = {\r\n\t\tinProgress: false\r\n\t};\r\n\r\n\tproductSelectionPopupHandler = this.handleProductSelectionPopup.bind(this);\r\n\tproductRowAddHandler = this.handleProductRowAdd.bind(this);\r\n\tshowSettingsPopupHandler = this.handleShowSettingsPopup.bind(this);\r\n\tshowProcessMakerPopupHandler = this.handleShowProcessMakerPopupHandler.bind(this);\r\n\twithdrawReserveHandler = this.handleWithdrawReserveHandler.bind(this);\r\n\r\n\tonDialogSelectProductHandler = this.handleOnDialogSelectProduct.bind(this);\r\n\tonSaveHandler = this.handleOnSave.bind(this);\r\n\tonEntityUpdateHandler = this.handleOnEntityUpdate.bind(this);\r\n\tonEditorSubmit = this.handleEditorSubmit.bind(this);\r\n\tonInnerCancelHandler = this.handleOnInnerCancel.bind(this);\r\n\tonBeforeGridRequestHandler = this.handleOnBeforeGridRequest.bind(this);\r\n\tonGridUpdatedHandler = this.handleOnGridUpdated.bind(this);\r\n\tonGridRowMovedHandler = this.handleOnGridRowMoved.bind(this);\r\n\tonBeforeProductChangeHandler = this.handleOnBeforeProductChange.bind(this);\r\n\tonProductChangeHandler = this.handleOnProductChange.bind(this);\r\n\tonProductClearHandler = this.handleOnProductClear.bind(this);\r\n\tdropdownChangeHandler = this.handleDropdownChange.bind(this);\r\n\tpullReloadGrid = null;\r\n\r\n\tchangeProductFieldHandler = this.handleFieldChange.bind(this);\r\n\tupdateTotalDataDelayedHandler = Runtime.debounce(this.updateTotalDataDelayed, 1000, this);\r\n\r\n\tconstructor(id)\r\n\t{\r\n\t\tthis.setId(id);\r\n\t}\r\n\r\n\tinit(config = {})\r\n\t{\r\n\t\tthis.setSettings(config);\r\n\r\n\t\tif (this.canEdit())\r\n\t\t{\r\n\t\t\tthis.addFirstRowIfEmpty();\r\n\t\t\tthis.enableEdit();\r\n\t\t}\r\n\r\n\t\tthis.initForm();\r\n\t\tthis.initProducts();\r\n\t\tthis.initGridData();\r\n\r\n\t\tEventEmitter.emit(window, 'EntityProductListController', [this]);\r\n\r\n\t\tthis.#initSupportCustomRowActions();\r\n\r\n\t\tthis.subscribeDomEvents();\r\n\t\tthis.subscribeCustomEvents();\r\n\r\n\t\tif (this.getSettingValue('isReserveBlocked', false))\r\n\t\t{\r\n\t\t\tconst headersToLock = ['STORE_INFO', 'RESERVE_INFO'];\r\n\t\t\tconst container = this.getContainer();\r\n\t\t\theadersToLock.forEach((headerId) => {\r\n\t\t\t\tconst header = container?.querySelector(`.main-grid-cell-head[data-name=\"${headerId}\"] .main-grid-cell-head-container`);\r\n\t\t\t\tif (header)\r\n\t\t\t\t{\r\n\t\t\t\t\tDom.addClass(header, 'main-grid-cell-head-locked');\r\n\t\t\t\t\theader.onclick = (event) => {\r\n\t\t\t\t\t\tif (Dom.hasClass(event.target, 'ui-hint-icon'))\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttop.BX.UI.InfoHelper.show('limit_store_crm_integration');\r\n\t\t\t\t\t};\r\n\t\t\t\t\tconst lock = Tag.render`<span class=\"crm-entity-product-list-locked-header\"></span>`;\r\n\t\t\t\t\theader.insertBefore(lock, header.firstChild);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tsubscribeDomEvents()\r\n\t{\r\n\t\tthis.unsubscribeDomEvents();\r\n\t\tconst container = this.getContainer();\r\n\r\n\t\tif (Type.isElementNode(container))\r\n\t\t{\r\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\r\n\t\t\t\tEvent.bind(\r\n\t\t\t\t\tselectButton,\r\n\t\t\t\t\t'click',\r\n\t\t\t\t\tthis.productSelectionPopupHandler\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\r\n\t\t\t\tEvent.bind(\r\n\t\t\t\t\taddButton,\r\n\t\t\t\t\t'click',\r\n\t\t\t\t\tthis.productRowAddHandler\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\r\n\t\t\t\tEvent.bind(\r\n\t\t\t\t\tconfigButton,\r\n\t\t\t\t\t'click',\r\n\t\t\t\t\tthis.showSettingsPopupHandler\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\tcontainer.querySelectorAll('[data-role=\"add-process-button\"]').forEach((configButton) => {\r\n\t\t\t\tEvent.bind(\r\n\t\t\t\t\tconfigButton,\r\n\t\t\t\t\t'click',\r\n\t\t\t\t\tthis.showProcessMakerPopupHandler\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\tcontainer.querySelectorAll('[data-role=\"withdraw-reserve-button\"]').forEach((configButton) => {\r\n\t\t\t\tEvent.bind(\r\n\t\t\t\t\tconfigButton,\r\n\t\t\t\t\t'click',\r\n\t\t\t\t\tthis.withdrawReserveHandler\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tunsubscribeDomEvents()\r\n\t{\r\n\t\tconst container = this.getContainer();\r\n\r\n\t\tif (Type.isElementNode(container))\r\n\t\t{\r\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-select-button\"]').forEach((selectButton) => {\r\n\t\t\t\tEvent.unbind(\r\n\t\t\t\t\tselectButton,\r\n\t\t\t\t\t'click',\r\n\t\t\t\t\tthis.productSelectionPopupHandler\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-add-button\"]').forEach((addButton) => {\r\n\t\t\t\tEvent.unbind(\r\n\t\t\t\t\taddButton,\r\n\t\t\t\t\t'click',\r\n\t\t\t\t\tthis.productRowAddHandler\r\n\t\t\t\t);\r\n\t\t\t});\r\n\r\n\t\t\tcontainer.querySelectorAll('[data-role=\"product-list-settings-button\"]').forEach((configButton) => {\r\n\t\t\t\tEvent.unbind(\r\n\t\t\t\t\tconfigButton,\r\n\t\t\t\t\t'click',\r\n\t\t\t\t\tthis.showSettingsPopupHandler\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tsubscribeCustomEvents()\r\n\t{\r\n\t\tthis.unsubscribeCustomEvents();\r\n\t\tEventEmitter.subscribe('CrmProductSearchDialog_SelectProduct', this.onDialogSelectProductHandler);\r\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditor:onSave', this.onSaveHandler);\r\n\t\tEventEmitter.subscribe('onCrmEntityUpdate', this.onEntityUpdateHandler);\r\n\t\tEventEmitter.subscribe('BX.Crm.EntityEditorAjax:onSubmit', this.onEditorSubmit);\r\n\t\tEventEmitter.subscribe('EntityProductListController:onInnerCancel', this.onInnerCancelHandler);\r\n\t\tEventEmitter.subscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\r\n\t\tEventEmitter.subscribe('Grid::updated', this.onGridUpdatedHandler);\r\n\t\tEventEmitter.subscribe('Grid::rowMoved', this.onGridRowMovedHandler);\r\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\r\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\r\n\t\tEventEmitter.subscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\r\n\t\tEventEmitter.subscribe('Dropdown::change', this.dropdownChangeHandler);\r\n\t\tif (PULL)\r\n\t\t{\r\n\t\t\tthis.pullReloadGrid = PULL.subscribe({\r\n\t\t\t\tmoduleId: 'crm',\r\n\t\t\t\tcallback: (data) => {\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tdata.command === 'onCatalogInventoryManagementEnabled'\r\n\t\t\t\t\t\t|| data.command === 'onCatalogInventoryManagementDisabled'\r\n\t\t\t\t\t)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.reloadGrid(false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}).bind(this);\r\n\t\t}\r\n\t}\r\n\r\n\tunsubscribeCustomEvents()\r\n\t{\r\n\t\tEventEmitter.unsubscribe('CrmProductSearchDialog_SelectProduct', this.onDialogSelectProductHandler);\r\n\t\tEventEmitter.unsubscribe('BX.Crm.EntityEditor:onSave', this.onSaveHandler);\r\n\t\tEventEmitter.unsubscribe('onCrmEntityUpdate', this.onEntityUpdateHandler);\r\n\t\tEventEmitter.unsubscribe('BX.Crm.EntityEditorAjax:onSubmit', this.onEditorSubmit);\r\n\t\tEventEmitter.unsubscribe('EntityProductListController:onInnerCancel', this.onInnerCancelHandler);\r\n\t\tEventEmitter.unsubscribe('Grid::beforeRequest', this.onBeforeGridRequestHandler);\r\n\t\tEventEmitter.unsubscribe('Grid::updated', this.onGridUpdatedHandler);\r\n\t\tEventEmitter.unsubscribe('Grid::rowMoved', this.onGridRowMovedHandler);\r\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onBeforeChange', this.onBeforeProductChangeHandler);\r\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onChange', this.onProductChangeHandler);\r\n\t\tEventEmitter.unsubscribe('BX.Catalog.ProductSelector:onClear', this.onProductClearHandler);\r\n\t\tEventEmitter.unsubscribe('Dropdown::change', this.dropdownChangeHandler);\r\n\t\tif (!Type.isNil(this.pullReloadGrid))\r\n\t\t{\r\n\t\t\tthis.pullReloadGrid();\r\n\t\t}\r\n\t}\r\n\r\n\t#initSupportCustomRowActions()\r\n\t{\r\n\t\tthis.getGrid()._clickOnRowActionsButton = () => {};\r\n\t}\r\n\r\n\thandleOnDialogSelectProduct(event: BaseEvent)\r\n\t{\r\n\t\tconst [productId] = event.getCompatData();\r\n\t\tlet id;\r\n\t\tif (this.getProductCount() > 0 || this.products[0]?.getField('ID') <= 0)\r\n\t\t{\r\n\t\t\tid = this.addProductRow();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tid = this.products[0]?.getField('ID');\r\n\t\t}\r\n\t\tthis.selectProductInRow(id, productId)\r\n\t}\r\n\r\n\tselectProductInRow(id: string, productId: number): void\r\n\t{\r\n\t\tif (!Type.isStringFilled(id) || Text.toNumber(productId) <= 0)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tthis\r\n\t\t\t\t.getProductSelector(id)\r\n\t\t\t\t?.onProductSelect(productId)\r\n\t\t\t;\r\n\t\t});\r\n\t}\r\n\r\n\thandleOnSave(event: BaseEvent)\r\n\t{\r\n\t\tconst items = [];\r\n\r\n\t\tthis.products.forEach((product) => {\r\n\t\t\tconst item = {\r\n\t\t\t\tfields: {...product.fields},\r\n\t\t\t\trowId: product.fields.ROW_ID\r\n\t\t\t};\r\n\t\t\titems.push(item);\r\n\t\t\tproduct.getNode().classList.remove('main-grid-row-edit');\r\n\t\t});\r\n\r\n\t\tthis.setSettingValue('items', items);\r\n\t}\r\n\r\n\thandleOnEntityUpdate(event: BaseEvent)\r\n\t{\r\n\t\tconst [data] = event.getData();\r\n\t\tif (\r\n\t\t\tthis.isChanged()\r\n\t\t\t&& data.entityId === this.getSettingValue('entityId')\r\n\t\t\t&& data.entityTypeId === this.getSettingValue('entityTypeId')\r\n\t\t)\r\n\t\t{\r\n\t\t\tlet rows = this.getProductsFields(Editor.#getAjaxFields()).filter((row) => {\r\n\t\t\t\treturn row[\"PRODUCT_ID\"] != null;\r\n\t\t\t});\r\n\r\n\t\t\tajax.runComponentAction(\r\n\t\t\t\tthis.getComponentName(),\r\n\t\t\t\t'saveProductRows',\r\n\t\t\t\t{\r\n\t\t\t\t\tmode: 'class',\r\n\t\t\t\t\tsignedParameters: this.getSignedParameters(),\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tentityId: this.getSettingValue('entityId'),\r\n\t\t\t\t\t\tentityTypeId: this.getSettingValue('entityTypeId'),\r\n\t\t\t\t\t\trows: rows,\r\n\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\tACTION: 'saveProductRows'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t).then(response => {\r\n\t\t\t\tthis.setGridChanged(false);\r\n\t\t\t\tthis.reloadGrid(false);\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\thandleEditorSubmit(event: BaseEvent)\r\n\t{\r\n\t\tif (!this.isLocationDependantTaxesEnabled())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst entityData = event.getData()[0];\r\n\t\tif (!entityData || !entityData.hasOwnProperty('LOCATION_ID'))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (entityData['LOCATION_ID'] !== this.getLocationId())\r\n\t\t{\r\n\t\t\tthis.setLocationId(entityData['LOCATION_ID']);\r\n\t\t\tthis.reloadGrid(false);\r\n\t\t}\r\n\t}\r\n\r\n\thandleOnInnerCancel(event: BaseEvent)\r\n\t{\r\n\t\tif (this.controller)\r\n\t\t{\r\n\t\t\tthis.controller.rollback();\r\n\t\t}\r\n\r\n\t\tthis.setGridChanged(false);\r\n\r\n\t\tEventEmitter.subscribeOnce(\r\n\t\t\tthis,\r\n\t\t\t'onGridReloaded',\r\n\t\t\t() => this.actionUpdateTotalData({isInternalChanging: true})\r\n\t\t)\r\n\t\tthis.reloadGrid(false);\r\n\t}\r\n\r\n\tchangeActivePanelButtons(panelCode: 'top' | 'bottom'): HTMLElement\r\n\t{\r\n\t\tconst container = this.getContainer();\r\n\t\tconst activePanel = container.querySelector('.crm-entity-product-list-add-block-' + panelCode);\r\n\t\tif (Type.isDomNode(activePanel))\r\n\t\t{\r\n\t\t\tDom.removeClass(activePanel, 'crm-entity-product-list-add-block-hidden');\r\n\t\t\tDom.addClass(activePanel, 'crm-entity-product-list-add-block-active');\r\n\t\t}\r\n\r\n\t\tconst hiddenPanelCode = (panelCode === 'top') ? 'bottom' : 'top';\r\n\t\tconst removePanel = container.querySelector('.crm-entity-product-list-add-block-' + hiddenPanelCode);\r\n\t\tif (Type.isDomNode(removePanel))\r\n\t\t{\r\n\t\t\tDom.addClass(removePanel, 'crm-entity-product-list-add-block-hidden');\r\n\t\t\tDom.removeClass(removePanel, 'crm-entity-product-list-add-block-active');\r\n\t\t}\r\n\r\n\t\treturn activePanel;\r\n\t}\r\n\r\n\treloadGrid(useProductsFromRequest: boolean = true, isInternalChanging: ?boolean = null): void\r\n\t{\r\n\t\tif (isInternalChanging === null)\r\n\t\t{\r\n\t\t\tisInternalChanging = !useProductsFromRequest;\r\n\t\t}\r\n\r\n\t\tthis.getGrid().reloadTable(\r\n\t\t\t'POST',\r\n\t\t\t{useProductsFromRequest},\r\n\t\t\t() => EventEmitter.emit(this, 'onGridReloaded')\r\n\t\t);\r\n\t}\r\n\r\n\t/*\r\n\t\tkeep in mind different actions for this handler:\r\n\t\t- native reload by grid actions (columns settings, etc)\t\t- products from request\r\n\t\t- reload by tax/discount settings button\t\t\t\t\t- products from request\t\tthis.reloadGrid(true)\r\n\t\t- rollback\t\t\t\t\t\t\t\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\r\n\t\t- reload after SalesCenter order save\t\t\t\t\t\t- products from db\t\t\tthis.reloadGrid(false)\r\n\t\t- reload after save if location had been changed\r\n\t */\r\n\thandleOnBeforeGridRequest(event: BaseEvent)\r\n\t{\r\n\t\tconst [grid, eventArgs] = event.getCompatData();\r\n\r\n\t\tif (!grid || !grid.parent || grid.parent.getId() !== this.getGridId())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// reload by native grid actions (columns settings, etc), otherwise by this.reloadGrid()\r\n\t\tconst isNativeAction = !('useProductsFromRequest' in eventArgs.data);\r\n\t\tconst useProductsFromRequest = isNativeAction ? true : eventArgs.data.useProductsFromRequest;\r\n\r\n\t\teventArgs.url = this.getReloadUrl();\r\n\t\teventArgs.method = 'POST';\r\n\t\teventArgs.sessid = BX.bitrix_sessid();\r\n\t\teventArgs.data = {\r\n\t\t\t...eventArgs.data,\r\n\t\t\tsignedParameters: this.getSignedParameters(),\r\n\t\t\tproducts: useProductsFromRequest ? this.getProductsFields(Editor.#getAjaxFields()) : null,\r\n\t\t\tlocationId: this.getLocationId(),\r\n\t\t\tcurrencyId: this.getCurrencyId(),\r\n\t\t};\r\n\r\n\t\tthis.clearEditor();\r\n\r\n\t\tif (isNativeAction && this.isChanged())\r\n\t\t{\r\n\t\t\tEventEmitter.subscribeOnce('Grid::updated', () => this.actionUpdateTotalData({isInternalChanging: false}));\r\n\t\t}\r\n\t}\r\n\r\n\thandleOnGridUpdated(event: BaseEvent)\r\n\t{\r\n\t\tconst [grid] = event.getCompatData();\r\n\r\n\t\tif (!grid || grid.getId() !== this.getGridId())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.getSettingsPopup().updateCheckboxState();\r\n\t}\r\n\r\n\thandleOnGridRowMoved(event: BaseEvent)\r\n\t{\r\n\t\tconst [ids, , grid] = event.getCompatData();\r\n\r\n\t\tif (!grid || grid.getId() !== this.getGridId())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst changed = this.resortProductsByIds(ids);\r\n\t\tif (changed)\r\n\t\t{\r\n\t\t\tthis.refreshSortFields();\r\n\t\t\tthis.numerateRows();\r\n\t\t\tthis.executeActions([{type: this.actions.productListChanged}]);\r\n\t\t}\r\n\t}\r\n\r\n\tinitPageEventsManager(): void\r\n\t{\r\n\t\tconst componentId = this.getSettingValue('componentId');\r\n\t\tthis.pageEventsManager = new PageEventsManager({id: componentId});\r\n\t}\r\n\r\n\tgetPageEventsManager(): PageEventsManager\r\n\t{\r\n\t\tif (!this.pageEventsManager)\r\n\t\t{\r\n\t\t\tthis.initPageEventsManager();\r\n\t\t}\r\n\r\n\t\treturn this.pageEventsManager;\r\n\t}\r\n\r\n\tcanEdit(): boolean\r\n\t{\r\n\t\treturn this.getSettingValue('allowEdit', false) === true;\r\n\t}\r\n\r\n\tcanEditCatalogPrice(): boolean\r\n\t{\r\n\t\treturn this.getSettingValue('allowCatalogPriceEdit', false) === true;\r\n\t}\r\n\r\n\tcanSaveCatalogPrice(): boolean\r\n\t{\r\n\t\treturn this.getSettingValue('allowCatalogPriceSave', false) === true;\r\n\t}\r\n\r\n\tenableEdit()\r\n\t{\r\n\t\t// Cannot use editSelected because checkboxes have been removed\r\n\t\tconst rows = this.getGrid().getRows().getRows();\r\n\t\trows.forEach((current) => {\r\n\t\t\tif (!current.isHeadChild() && !current.isTemplate())\r\n\t\t\t{\r\n\t\t\t\tcurrent.edit();\r\n\t\t\t\t/** @hack возможно будут проблемы с этим */\r\n\t\t\t\tcurrent.getNode().classList.remove(\"main-grid-row-edit\");\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\taddFirstRowIfEmpty(): void\r\n\t{\r\n\t\tif (this.getGrid().getRows().getCountDisplayed() === 0)\r\n\t\t{\r\n\t\t\trequestAnimationFrame(() => this.addProductRow());\r\n\t\t}\r\n\t}\r\n\r\n\tclearEditor()\r\n\t{\r\n\t\tthis.unsubscribeProductsEvents();\r\n\r\n\t\tthis.products = [];\r\n\t\tthis.productsWasInitiated = false;\r\n\r\n\t\tthis.destroySettingsPopup();\r\n\t\tthis.destroyProcessMakerPopup();\r\n\t\tthis.unsubscribeDomEvents();\r\n\t\tthis.unsubscribeCustomEvents();\r\n\r\n\t\tEvent.unbindAll(this.container);\r\n\t}\r\n\r\n\twasProductsInitiated()\r\n\t{\r\n\t\treturn this.productsWasInitiated;\r\n\t}\r\n\r\n\tunsubscribeProductsEvents()\r\n\t{\r\n\t\tthis.products.forEach((current) => {\r\n\t\t\tcurrent.unsubscribeCustomEvents();\r\n\t\t});\r\n\t}\r\n\r\n\tdestroy()\r\n\t{\r\n\t\tthis.setForm(null);\r\n\t\tthis.clearController();\r\n\t\tthis.clearEditor();\r\n\t}\r\n\r\n\tsetController(controller)\r\n\t{\r\n\t\tif (this.controller === controller)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.controller)\r\n\t\t{\r\n\t\t\tthis.controller.clearProductList();\r\n\t\t}\r\n\t\tthis.controller = controller;\r\n\t}\r\n\r\n\tclearController()\r\n\t{\r\n\t\tthis.controller = null;\r\n\t}\r\n\r\n\tgetId()\r\n\t{\r\n\t\treturn this.id;\r\n\t}\r\n\r\n\tsetId(id)\r\n\t{\r\n\t\tthis.id = id;\r\n\t}\r\n\r\n\t/* settings tools */\r\n\tgetSettings()\r\n\t{\r\n\t\treturn this.settings;\r\n\t}\r\n\r\n\tsetSettings(settings)\r\n\t{\r\n\t\tthis.settings = settings ? settings : {};\r\n\t}\r\n\r\n\tgetSettingValue(name: string, defaultValue)\r\n\t{\r\n\t\treturn this.settings.hasOwnProperty(name) ? this.settings[name] : defaultValue;\r\n\t}\r\n\r\n\tsetSettingValue(name, value)\r\n\t{\r\n\t\tthis.settings[name] = value;\r\n\t}\r\n\r\n\tgetComponentName()\r\n\t{\r\n\t\treturn this.getSettingValue('componentName', '');\r\n\t}\r\n\r\n\tgetReloadUrl()\r\n\t{\r\n\t\treturn this.getSettingValue('reloadUrl', '');\r\n\t}\r\n\r\n\tgetSignedParameters()\r\n\t{\r\n\t\treturn this.getSettingValue('signedParameters', '');\r\n\t}\r\n\r\n\tgetContainerId()\r\n\t{\r\n\t\treturn this.getSettingValue('containerId', '');\r\n\t}\r\n\r\n\tgetGridId(): string\r\n\t{\r\n\t\treturn this.getSettingValue('gridId', '');\r\n\t}\r\n\r\n\tgetLanguageId()\r\n\t{\r\n\t\treturn this.getSettingValue('languageId', '');\r\n\t}\r\n\r\n\tgetSiteId()\r\n\t{\r\n\t\treturn this.getSettingValue('siteId', '');\r\n\t}\r\n\r\n\tgetCatalogId()\r\n\t{\r\n\t\treturn this.getSettingValue('catalogId', 0);\r\n\t}\r\n\r\n\tisReadOnly()\r\n\t{\r\n\t\treturn this.getSettingValue('readOnly', true);\r\n\t}\r\n\r\n\tsetReadOnly(readOnly)\r\n\t{\r\n\t\tthis.setSettingValue('readOnly', readOnly);\r\n\t}\r\n\r\n\tgetCurrencyId(): string\r\n\t{\r\n\t\treturn this.getSettingValue('currencyId', '');\r\n\t}\r\n\r\n\tsetCurrencyId(currencyId): void\r\n\t{\r\n\t\tthis.setSettingValue('currencyId', currencyId);\r\n\t\tthis.products.forEach(product => product.getModel()?.setOption('currency', currencyId));\r\n\t}\r\n\r\n\tisLocationDependantTaxesEnabled(): boolean\r\n\t{\r\n\t\treturn this.getSettingValue('isLocationDependantTaxesEnabled', false);\r\n\t}\r\n\r\n\tgetLocationId(): ?string\r\n\t{\r\n\t\treturn this.getSettingValue('locationId');\r\n\t}\r\n\r\n\tsetLocationId(locationId: string): void\r\n\t{\r\n\t\tthis.setSettingValue('locationId', locationId);\r\n\t}\r\n\r\n\tchangeCurrencyId(currencyId): void\r\n\t{\r\n\t\tthis.setCurrencyId(currencyId);\r\n\t\tconst products = [];\r\n\t\tthis.products.forEach((product) => {\r\n\t\t\tconst priceFields = {};\r\n\t\t\tthis.#getCalculatePriceFieldNames().forEach((name) => {\r\n\t\t\t\tpriceFields[name] = product.getField(name);\r\n\t\t\t});\r\n\r\n\t\t\tproducts.push({\r\n\t\t\t\tfields: priceFields,\r\n\t\t\t\tid: product.getId()\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tif (products.length > 0)\r\n\t\t{\r\n\t\t\tthis.ajaxRequest('calculateProductPrices', {\r\n\t\t\t\tproducts,\r\n\t\t\t\tcurrencyId\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst editData = this.getGridEditData();\r\n\t\tconst templateRow = editData[GRID_TEMPLATE_ROW];\r\n\t\ttemplateRow['CURRENCY'] = this.getCurrencyId();\r\n\t\tconst templateFieldNames = ['DISCOUNT_ROW', 'SUM', 'PRICE'];\r\n\r\n\t\ttemplateFieldNames.forEach((field) => {\r\n\t\t\ttemplateRow[field]['CURRENCY']['VALUE'] = this.getCurrencyId();\r\n\t\t});\r\n\t\tthis.setGridEditData(editData);\r\n\t}\r\n\r\n\t#getCalculatePriceFieldNames(): []\r\n\t{\r\n\t\treturn [\r\n\t\t\t'BASE_PRICE',\r\n\t\t\t'ENTERED_PRICE',\r\n\t\t\t'TAX_INCLUDED',\r\n\t\t\t'PRICE_NETTO',\r\n\t\t\t'PRICE_BRUTTO',\r\n\t\t\t'DISCOUNT_ROW',\r\n\t\t\t'DISCOUNT_SUM',\r\n\t\t\t'CURRENCY'\r\n\t\t];\r\n\t}\r\n\r\n\tonCalculatePricesResponse(products: [])\r\n\t{\r\n\t\tthis.products.forEach((product) => {\r\n\t\t\tif (Type.isObject(products[product.getId()]))\r\n\t\t\t{\r\n\t\t\t\tproduct.updateUiCurrencyFields();\r\n\t\t\t\t['BASE_PRICE', 'ENTERED_PRICE', 'DISCOUNT_ROW', 'DISCOUNT_SUM', 'CURRENCY_ID'].forEach((name) => {\r\n\t\t\t\t\tproduct.updateField(name, Text.toNumber(products[product.getId()][name]));\r\n\t\t\t\t});\r\n\t\t\t\tproduct.setField('CURRENCY', products[product.getId()]['CURRENCY_ID']);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.updateTotalUiCurrency();\r\n\t}\r\n\r\n\tupdateTotalUiCurrency()\r\n\t{\r\n\t\tconst totalBlock = BX(this.getSettingValue('totalBlockContainerId', null));\r\n\t\tif (Type.isElementNode(totalBlock))\r\n\t\t{\r\n\t\t\ttotalBlock.querySelectorAll('[data-role=\"currency-wrapper\"]').forEach((row) => {\r\n\t\t\t\trow.innerHTML = this.getCurrencyText();\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tgetAdjustedProductRow(sort) {\r\n\t\tfor(let product of this.products) {\r\n\t\t\tif(product.getField('SORT') > sort && product.isAdjusted()) {\r\n\t\t\t\treturn product;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetCurrencyText(): string\r\n\t{\r\n\t\tconst currencyId = this.getCurrencyId();\r\n\t\tif (!Type.isStringFilled(currencyId))\r\n\t\t{\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\tconst format = CurrencyCore.getCurrencyFormat(currencyId);\r\n\r\n\t\treturn format && format.FORMAT_STRING.replace(/(^|[^&])#/, '$1').trim() || '';\r\n\t}\r\n\r\n\tgetDataFieldName()\r\n\t{\r\n\t\treturn this.getSettingValue('dataFieldName', '');\r\n\t}\r\n\r\n\tgetDataSettingsFieldName()\r\n\t{\r\n\t\tconst field = this.getDataFieldName();\r\n\r\n\t\treturn Type.isStringFilled(field) ? field + '_SETTINGS' : '';\r\n\t}\r\n\r\n\tgetDiscountEnabled(): 'Y' | 'N'\r\n\t{\r\n\t\treturn this.getSettingValue('enableDiscount', 'N');\r\n\t}\r\n\r\n\tgetPricePrecision(): number\r\n\t{\r\n\t\treturn this.getSettingValue('pricePrecision', DEFAULT_PRECISION);\r\n\t}\r\n\r\n\tgetQuantityPrecision(): number\r\n\t{\r\n\t\treturn this.getSettingValue('quantityPrecision', DEFAULT_PRECISION);\r\n\t}\r\n\r\n\tgetCommonPrecision(): number\r\n\t{\r\n\t\treturn this.getSettingValue('commonPrecision', DEFAULT_PRECISION);\r\n\t}\r\n\r\n\tgetTaxList(): Array\r\n\t{\r\n\t\treturn this.getSettingValue('taxList', []);\r\n\t}\r\n\r\n\tgetTaxAllowed(): 'Y' | 'N'\r\n\t{\r\n\t\treturn this.getSettingValue('allowTax', 'N');\r\n\t}\r\n\r\n\tisTaxAllowed(): boolean\r\n\t{\r\n\t\treturn this.getTaxAllowed() === 'Y';\r\n\t}\r\n\r\n\tgetTaxEnabled(): 'Y' | 'N'\r\n\t{\r\n\t\treturn this.getSettingValue('enableTax', 'N');\r\n\t}\r\n\r\n\tisTaxEnabled(): boolean\r\n\t{\r\n\t\treturn this.getTaxEnabled() === 'Y';\r\n\t}\r\n\r\n\tisTaxUniform(): boolean\r\n\t{\r\n\t\treturn this.getSettingValue('taxUniform', true);\r\n\t}\r\n\r\n\tgetMeasures(): []\r\n\t{\r\n\t\treturn this.getSettingValue('measures', []);\r\n\t}\r\n\r\n\tgetDefaultMeasure()\r\n\t{\r\n\t\treturn this.getSettingValue('defaultMeasure', {});\r\n\t}\r\n\r\n\tgetRowIdPrefix()\r\n\t{\r\n\t\treturn this.getSettingValue('rowIdPrefix', 'crm_entity_product_list_');\r\n\t}\r\n\r\n\t/* settings tools finish */\r\n\r\n\t/* calculate tools */\r\n\tparseInt(value: number | string, defaultValue: number = 0)\r\n\t{\r\n\t\tlet result;\r\n\r\n\t\tconst isNumberValue = Type.isNumber(value);\r\n\t\tconst isStringValue = Type.isStringFilled(value);\r\n\r\n\t\tif (!isNumberValue && !isStringValue)\r\n\t\t{\r\n\t\t\treturn defaultValue;\r\n\t\t}\r\n\r\n\t\tif (isStringValue)\r\n\t\t{\r\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\r\n\t\t\tconst isNegative = value.indexOf('-') === 0;\r\n\t\t\tresult = parseInt(value.replace(/[^\\d]/g, ''), 10);\r\n\t\t\tif (isNaN(result))\r\n\t\t\t{\r\n\t\t\t\tresult = defaultValue;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif (isNegative)\r\n\t\t\t\t{\r\n\t\t\t\t\tresult = -result;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tresult = parseInt(value, 10);\r\n\t\t\tif (isNaN(result))\r\n\t\t\t{\r\n\t\t\t\tresult = defaultValue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tparseFloat(value: number | string, precision: number = DEFAULT_PRECISION, defaultValue: number = 0.0)\r\n\t{\r\n\t\tlet result;\r\n\r\n\t\tconst isNumberValue = Type.isNumber(value);\r\n\t\tconst isStringValue = Type.isStringFilled(value);\r\n\r\n\t\tif (!isNumberValue && !isStringValue)\r\n\t\t{\r\n\t\t\treturn defaultValue;\r\n\t\t}\r\n\r\n\t\tif (isStringValue)\r\n\t\t{\r\n\t\t\tvalue = value.replace(/^\\s+|\\s+$/g, '');\r\n\r\n\t\t\tconst dot = value.indexOf('.');\r\n\t\t\tconst comma = value.indexOf(',');\r\n\t\t\tconst isNegative = value.indexOf('-') === 0;\r\n\r\n\t\t\tif (dot < 0 && comma >= 0)\r\n\t\t\t{\r\n\t\t\t\tlet s1 = value.substr(0, comma);\r\n\t\t\t\tconst decimalLength = value.length - comma - 1;\r\n\r\n\t\t\t\tif (decimalLength > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\ts1 += '.' + value.substr(comma + 1, decimalLength);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvalue = s1;\r\n\t\t\t}\r\n\r\n\t\t\tvalue = value.replace(/[^\\d.]+/g, '');\r\n\t\t\tresult = parseFloat(value);\r\n\r\n\t\t\tif (isNaN(result))\r\n\t\t\t{\r\n\t\t\t\tresult = defaultValue;\r\n\t\t\t}\r\n\t\t\tif (isNegative)\r\n\t\t\t{\r\n\t\t\t\tresult = -result;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tresult = parseFloat(value);\r\n\t\t}\r\n\r\n\t\tif (precision >= 0)\r\n\t\t{\r\n\t\t\tresult = this.round(result, precision);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tround(value: number, precision: number = DEFAULT_PRECISION)\r\n\t{\r\n\t\tconst factor = Math.pow(10, precision);\r\n\r\n\t\treturn Math.round(value * factor) / factor;\r\n\t}\r\n\r\n\tcalculatePriceWithoutDiscount(price, discount, discountType)\r\n\t{\r\n\t\tlet result = 0.0;\r\n\r\n\t\tswitch (discountType)\r\n\t\t{\r\n\t\t\tcase DiscountType.PERCENTAGE:\r\n\t\t\t\tresult = (price - ((price * discount) / 100));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase DiscountType.MONETARY:\r\n\t\t\t\tresult = (price - discount);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcalculateDiscountRate(originalPrice, price)\r\n\t{\r\n\t\tif (originalPrice === 0.0)\r\n\t\t{\r\n\t\t\treturn 0.0;\r\n\t\t}\r\n\r\n\t\tif (price === 0.0)\r\n\t\t{\r\n\t\t\treturn originalPrice > 0 ? 100.0 : -100.0;\r\n\t\t}\r\n\r\n\t\treturn ((100 * (originalPrice - price)) / originalPrice);\r\n\t}\r\n\r\n\tcalculateDiscount(originalPrice, discountRate)\r\n\t{\r\n\t\treturn originalPrice * discountRate / 100;\r\n\t}\r\n\r\n\tcalculatePriceWithoutTax(price, taxRate)\r\n\t{\r\n\t\t// Tax is not included in price\r\n\t\treturn price / (1 + (taxRate / 100));\r\n\t}\r\n\r\n\tcalculatePriceWithTax(price, taxRate)\r\n\t{\r\n\t\t// Tax is included in price\r\n\t\treturn price * (1 + (taxRate / 100));\r\n\t}\r\n\r\n\t/* calculate tools finish */\r\n\r\n\tgetContainer()\r\n\t{\r\n\t\treturn this.cache.remember('container', () => {\r\n\t\t\treturn document.getElementById(this.getContainerId());\r\n\t\t});\r\n\t}\r\n\r\n\tinitForm()\r\n\t{\r\n\t\tconst formId = this.getSettingValue('formId', '');\r\n\t\tconst form = Type.isStringFilled(formId) ? BX('form_' + formId) : null;\r\n\r\n\t\tif (Type.isElementNode(form))\r\n\t\t{\r\n\t\t\tthis.setForm(form);\r\n\t\t}\r\n\t}\r\n\r\n\tisExistForm()\r\n\t{\r\n\t\treturn Type.isElementNode(this.getForm());\r\n\t}\r\n\r\n\tgetForm()\r\n\t{\r\n\t\treturn this.form;\r\n\t}\r\n\r\n\tsetForm(form)\r\n\t{\r\n\t\tthis.form = form;\r\n\t}\r\n\r\n\tinitFormFields()\r\n\t{\r\n\t\tconst container = this.getForm();\r\n\t\tif (Type.isElementNode(container))\r\n\t\t{\r\n\t\t\tconst field = this.getDataField();\r\n\t\t\tif (!Type.isElementNode(field))\r\n\t\t\t{\r\n\t\t\t\tthis.initDataField();\r\n\t\t\t}\r\n\r\n\t\t\tconst settingsField = this.getDataSettingsField();\r\n\t\t\tif (!Type.isElementNode(settingsField))\r\n\t\t\t{\r\n\t\t\t\tthis.initDataSettingsField();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tinitFormField(fieldName)\r\n\t{\r\n\t\tconst container = this.getForm();\r\n\r\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\r\n\t\t{\r\n\t\t\tDom.append(\r\n\t\t\t\tDom.create(\r\n\t\t\t\t\t'input',\r\n\t\t\t\t\t{attrs: {type: \"hidden\", name: fieldName}}\r\n\t\t\t\t),\r\n\t\t\t\tcontainer\r\n\t\t\t)\r\n\t\t}\r\n\t}\r\n\r\n\tremoveFormFields()\r\n\t{\r\n\t\tconst field = this.getDataField();\r\n\t\tif (Type.isElementNode(field))\r\n\t\t{\r\n\t\t\tDom.remove(field);\r\n\t\t}\r\n\r\n\t\tconst settingsField = this.getDataSettingsField();\r\n\t\tif (Type.isElementNode(settingsField))\r\n\t\t{\r\n\t\t\tDom.remove(settingsField);\r\n\t\t}\r\n\t}\r\n\r\n\tinitDataField()\r\n\t{\r\n\t\tthis.initFormField(this.getDataFieldName());\r\n\t}\r\n\r\n\tinitDataSettingsField()\r\n\t{\r\n\t\tthis.initFormField(this.getDataSettingsFieldName());\r\n\t}\r\n\r\n\tgetFormField(fieldName)\r\n\t{\r\n\t\tconst container = this.getForm();\r\n\r\n\t\tif (Type.isElementNode(container) && Type.isStringFilled(fieldName))\r\n\t\t{\r\n\t\t\treturn container.querySelector('input[name=\"' + fieldName + '\"]');\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tgetDataField()\r\n\t{\r\n\t\treturn this.getFormField(this.getDataFieldName());\r\n\t}\r\n\r\n\tgetDataSettingsField()\r\n\t{\r\n\t\treturn this.getFormField(this.getDataSettingsFieldName());\r\n\t}\r\n\r\n\tgetProductCount()\r\n\t{\r\n\t\treturn this.products\r\n\t\t\t.filter(item => !item.isEmpty())\r\n\t\t\t.length\r\n\t\t\t;\r\n\t}\r\n\r\n\tinitProducts()\r\n\t{\r\n\t\tconst list = this.getSettingValue('items', []);\r\n\r\n\t\tconst isReserveBlocked = this.getSettingValue('isReserveBlocked', false);\r\n\r\n\t\tfor (const item of list)\r\n\t\t{\r\n\t\t\tconst fields = {...item.fields};\r\n\t\t\tconst settings = {\r\n\t\t\t\tselectorId: item.selectorId,\r\n\t\t\t\tisReserveBlocked,\r\n\t\t\t};\r\n\t\t\tthis.products.push(new Row(item.rowId, fields, settings, this));\r\n\t\t}\r\n\r\n\t\tthis.numerateRows();\r\n\r\n\t\tthis.productsWasInitiated = true;\r\n\t}\r\n\r\n\tnumerateRows()\r\n\t{\r\n\t\tlet parentIndex = 1;\r\n\t\tlet childIndex = 1;\r\n\r\n\t\tthis.products.forEach((product, index) => {\r\n\t\t\tif (product.getField('UF_APPLICATION_PARENT_PRODUCT_ROW_ID', 0) != 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tproduct.setRowNumber(parentIndex);\r\n\r\n\t\t\tfor (let i = index; i < this.products.length; i++) {\r\n\t\t\t\tlet applicationRow = this.products[i];\r\n\r\n\t\t\t\tif (applicationRow.getField('UF_APPLICATION_PARENT_PRODUCT_ROW_ID', 0) == product.getField('ID')) {\r\n\t\t\t\t\tapplicationRow.setRowNumber(parentIndex + '.' + (childIndex++));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tparentIndex++;\r\n\t\t\tchildIndex = 1;\r\n\t\t});\r\n\t}\r\n\r\n\tgetGrid(): ?BX.Main.Grid\r\n\t{\r\n\t\treturn this.cache.remember('grid', () => {\r\n\t\t\tconst gridId = this.getGridId();\r\n\r\n\t\t\tif (!Reflection.getClass('BX.Main.gridManager.getInstanceById'))\r\n\t\t\t{\r\n\t\t\t\tthrow Error(`Cannot find grid with '${gridId}' id.`)\r\n\t\t\t}\r\n\r\n\t\t\treturn BX.Main.gridManager.getInstanceById(gridId);\r\n\t\t});\r\n\t}\r\n\r\n\tinitGridData()\r\n\t{\r\n\t\tconst gridEditData = this.getSettingValue('templateGridEditData', null);\r\n\t\tif (gridEditData)\r\n\t\t{\r\n\t\t\tthis.setGridEditData(gridEditData);\r\n\t\t}\r\n\t}\r\n\r\n\tgetGridEditData()\r\n\t{\r\n\t\treturn this.getGrid().arParams.EDITABLE_DATA;\r\n\t}\r\n\r\n\tsetGridEditData(data: {})\r\n\t{\r\n\t\tthis.getGrid().arParams.EDITABLE_DATA = data;\r\n\t}\r\n\r\n\tsetOriginalTemplateEditData(data)\r\n\t{\r\n\t\tthis.getGrid().arParams.EDITABLE_DATA[GRID_TEMPLATE_ROW] = data;\r\n\t}\r\n\r\n\thandleProductErrorsChange()\r\n\t{\r\n\t\tif (this.#childrenHasErrors())\r\n\t\t{\r\n\t\t\tthis.controller.disableSaveButton();\r\n\t\t}\r\n\t}\r\n\r\n\t#childrenHasErrors()\r\n\t{\r\n\t\treturn this.products\r\n\t\t\t.filter((product) => product.getModel().getErrorCollection().hasErrors())\r\n\t\t\t.length > 0\r\n\t\t;\r\n\t}\r\n\r\n\thandleFieldChange(event)\r\n\t{\r\n\t\tconst row = event.target.closest('tr');\r\n\t\tif (row && row.hasAttribute('data-id'))\r\n\t\t{\r\n\t\t\tconst product = this.getProductById(row.getAttribute('data-id'));\r\n\t\t\tif (product)\r\n\t\t\t{\r\n\t\t\t\tconst cell = event.target.closest('td');\r\n\t\t\t\tconst fieldCode = this.getFieldCodeByGridCell(row, cell);\r\n\t\t\t\tif (fieldCode)\r\n\t\t\t\t{\r\n\t\t\t\t\tproduct.updateFieldByEvent(fieldCode, event);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\thandleDropdownChange(event: BaseEvent)\r\n\t{\r\n\t\tconst [dropdownId, , , , value] = event.getData();\r\n\t\tconst regExp = new RegExp(this.getRowIdPrefix() + '([A-Za-z0-9]+)_(\\\\w+)_control', 'i');\r\n\t\tconst matches = dropdownId.match(regExp);\r\n\r\n\t\t// match user field dropdown\r\n\t\t// if(!matches) {\r\n\t\t// \tlet dropdown = document.querySelector('#' + dropdownId);\r\n\t\t// \tif(dropdown) {\r\n\t\t// \t\tlet parentRow = dropdown.closest('tr');\r\n\t\t// \t\tconsole.log(parentRow);\r\n\t\t// \t\tif(parentRow) {\r\n\t\t// \t\t\tmatches = [null, parentRow.dataset.id, dropdown.getAttribute('name')];\r\n\t\t// \t\t}\r\n\t\t// \t}\r\n\t\t// }\r\n\r\n\t\tif (matches)\r\n\t\t{\r\n\t\t\tconst [, rowId, fieldCode] = matches;\r\n\t\t\tconst product = this.getProductById(rowId);\r\n\t\t\tif (product)\r\n\t\t\t{\r\n\t\t\t\tproduct.updateField(fieldCode, value, product.modeChanges.EDIT);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetProductById(id: string): ?Row\r\n\t{\r\n\t\tconst rowId = this.getRowIdPrefix() + id;\r\n\r\n\t\treturn this.getProductByRowId(rowId);\r\n\t}\r\n\r\n\tgetProductByRowId(rowId: string): ?Row\r\n\t{\r\n\t\treturn this.products.find((row: Row) => {\r\n\t\t\treturn row.getId() === rowId;\r\n\t\t});\r\n\t}\r\n\r\n\tgetFieldCodeByGridCell(row: HTMLTableRowElement, cell: HTMLTableCellElement): ?string\r\n\t{\r\n\t\tif (!Type.isDomNode(row) || !Type.isDomNode(cell))\r\n\t\t{\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst grid = this.getGrid();\r\n\t\tif (grid)\r\n\t\t{\r\n\t\t\tconst headRow = grid.getRows().getHeadFirstChild();\r\n\t\t\tconst index = [...row.cells].indexOf(cell);\r\n\r\n\t\t\treturn headRow.getCellNameByCellIndex(index);\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\thandleProductSelectionPopup(event)\r\n\t{\r\n\t\tconst caller = 'crm_entity_product_list';\r\n\t\tconst jsEventsManagerId = this.getSettingValue('jsEventsManagerId', '');\r\n\r\n\t\tconst popup = new BX.CDialog({\r\n\t\t\tcontent_url: '/bitrix/components/bitrix/crm.product_row.list/product_choice_dialog.php?'\r\n\t\t\t\t+ 'caller=' + caller\r\n\t\t\t\t+ '&JS_EVENTS_MANAGER_ID=' + BX.util.urlencode(jsEventsManagerId)\r\n\t\t\t\t+ '&sessid=' + BX.bitrix_sessid(),\r\n\t\t\theight: Math.max(500, window.innerHeight - 400),\r\n\t\t\twidth: Math.max(800, window.innerWidth - 400),\r\n\t\t\tdraggable: true,\r\n\t\t\tresizable: true,\r\n\t\t\tmin_height: 500,\r\n\t\t\tmin_width: 800,\r\n\t\t\tzIndex: 800\r\n\t\t});\r\n\r\n\t\tEventEmitter.subscribeOnce(popup, 'onWindowRegister', BX.defer(() => {\r\n\t\t\tpopup.Get().style.position = 'fixed';\r\n\t\t\tpopup.Get().style.top = (parseInt(popup.Get().style.top) - BX.GetWindowScrollPos().scrollTop) + 'px';\r\n\t\t\tpopup.OVERLAY.style.zIndex = 798;\r\n\t\t}));\r\n\r\n\t\tEventEmitter.subscribeOnce(window, 'EntityProductListController:onInnerCancel', BX.defer(() => {\r\n\t\t\tpopup.Close();\r\n\t\t}));\r\n\r\n\t\tif (!Type.isUndefined(BX.Crm.EntityEvent))\r\n\t\t{\r\n\t\t\tEventEmitter.subscribeOnce(window, BX.Crm.EntityEvent.names.update, BX.defer(() => {\r\n\t\t\t\trequestAnimationFrame(() => {\r\n\t\t\t\t\tpopup.Close()\r\n\t\t\t\t}, 0);\r\n\t\t\t}));\r\n\t\t}\r\n\r\n\t\tpopup.Show();\r\n\t}\r\n\r\n\taddProductRow(anchorProduct: Row = null): string\r\n\t{\r\n\t\tconst row = this.createGridProductRow();\r\n\t\tconst newId = row.getId();\r\n\r\n\t\tif (anchorProduct)\r\n\t\t{\r\n\t\t\tconst anchorRowNode = this.getGrid().getRows().getById(anchorProduct.getField('ID'))?.getNode();\r\n\r\n\t\t\tif (anchorProduct.getField('UF_APPLICATION_PARENT_PRODUCT_ROW_ID', 0) != 0) {\r\n\t\t\t\trow.setDepth(1);\r\n\t\t\t}\r\n\r\n\t\t\tif (anchorRowNode)\r\n\t\t\t{\r\n\t\t\t\tanchorRowNode.parentNode.insertBefore(row.getNode(), anchorRowNode.nextSibling);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.initializeNewProductRow(newId, anchorProduct);\r\n\t\tthis.getGrid().bindOnRowEvents();\r\n\t\treturn newId;\r\n\t}\r\n\r\n\taddProductRowAfter(anchorProduct: Row): string\r\n\t{\r\n\t\tconst row = this.createGridProductRow();\r\n\t\tconst newId = row.getId();\r\n\t\tconst anchorRowNode = this.getGrid().getRows().getById(anchorProduct.getField('ID'))?.getNode();\r\n\r\n\t\tif (anchorRowNode)\r\n\t\t{\r\n\t\t\tanchorRowNode.parentNode.insertBefore(row.getNode(), anchorRowNode.nextSibling);\r\n\t\t}\r\n\r\n\t\tthis.initializeNewProductRowWithoutFields(newId, anchorProduct);\r\n\t\trow.setDepth(1);\r\n\t\tthis.getGrid().bindOnRowEvents();\r\n\t\treturn newId;\r\n\t}\r\n\r\n\thandleProductRowAdd(): void\r\n\t{\r\n\t\tconst id = this.addProductRow();\r\n\t\tthis.focusProductSelector(id);\r\n\t}\r\n\r\n\thandleShowSettingsPopup()\r\n\t{\r\n\t\tthis.getSettingsPopup().show();\r\n\t}\r\n\r\n\thandleShowProcessMakerPopupHandler()\r\n\t{\r\n\t\tlet popup = this.getProcessMakerPopup();\r\n\r\n\t\tif (!popup.firstShow) {\r\n\t\t\tlet content = this.#prepareSmartProcessFunnelsContent(this.getSettingValue('smartProcessCategories'));\r\n\r\n\t\t\tpopup.setContent(content);\r\n\t\t}\r\n\t\tpopup.show();\r\n\t}\r\n\r\n\thandleWithdrawReserveHandler(event)\r\n\t{\r\n\t\tlet button = event.target;\r\n\t\tlet fields = this.getProductsFields(Editor.#getAjaxFields());\r\n\r\n\t\tfields.forEach((elem) => {\r\n\t\t\tlet oldId = elem.ID;\r\n\t\t\tlet newId = \"id_\" + Text.getRandom();\r\n\r\n\t\t\telem.ID = newId;\r\n\t\t\tfields.forEach((child) => {\r\n\t\t\t\tif (child.UF_APPLICATION_PARENT_PRODUCT_ROW_ID == oldId) {\r\n\t\t\t\t\tchild.UF_APPLICATION_PARENT_PRODUCT_ROW_ID = newId;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tbutton.classList.add(\"ui-btn-wait\");\r\n\t\tbutton.disabled = true;\r\n\r\n\t\tBX.ajax.runComponentAction(\r\n\t\t\tthis.getComponentName(),\r\n\t\t\t'withdrawReserve1C',\r\n\t\t\t{\r\n\t\t\t\tmode: 'class',\r\n\t\t\t\tsignedParameters: this.getSignedParameters(),\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tentityId: this.getSettingValue('entityId'),\r\n\t\t\t\t\tentityTypeId: this.getSettingValue('entityTypeId'),\r\n\t\t\t\t\trows: fields,\r\n\t\t\t\t\toptions: {\r\n\t\t\t\t\t\tACTION: 'withdrawReserve1C',\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t).then(async (res) => {\r\n\t\t\tvar popup = this.getWithdrawReservePopup();\r\n\t\t\tpopup.show();\r\n\r\n\t\t\tif (button.classList.contains(\"ui-btn-wait\"))\r\n\t\t\t\tbutton.classList.remove(\"ui-btn-wait\");\r\n\r\n\t\t\tbutton.disabled = false;\r\n\t\t});\r\n\t}\r\n\r\n\tgetWithdrawReservePopup()\r\n\t{\r\n\t\treturn this.cache.remember('withdraw-reserve-popup', () => {\r\n\t\t\treturn new Popup(\r\n\t\t\t\tthis.getId() + '_' + Math.random() * 100,\r\n\t\t\t\twindow.body,\r\n\t\t\t\t{\r\n\t\t\t\t\ttitleBar: Loc.getMessage(\"CRM_ENTITY_PL_WITHDRAW_RESERVE\"),\r\n\t\t\t\t\tcontent: Loc.getMessage(\"CRM_ENTITY_PL_WITHDRAW_RESERVE_POPUP\"),\r\n\t\t\t\t\tautoHide: true,\r\n\t\t\t\t\tcloseIcon: true,\r\n\t\t\t\t\tcloseByEsc: true,\r\n\t\t\t\t\toverlay: {\r\n\t\t\t\t\t\tbackgroundColor: 'grey', opacity: '80'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tclassName: \"withdraw-reserve-popup\",\r\n\t\t\t\t\twidth: 800,\r\n\t\t\t\t\toffsetLeft: 0,\r\n\t\t\t\t\toffsetTop: 0\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tgetProcessMakerPopup()\r\n\t{\r\n\t\treturn this.cache.remember('process-maker-popup', () => {\r\n\t\t\treturn new Popup(\r\n\t\t\t\tthis.getId() + '_' + Math.random() * 100,\r\n\t\t\t\twindow.body,\r\n\t\t\t\t{\r\n\t\t\t\t\ttitleBar: Loc.getMessage(\"CREATE_SMART_PROCESS_BASED_ON\"),\r\n\t\t\t\t\tautoHide: true,\r\n\t\t\t\t\tcloseIcon: true,\r\n\t\t\t\t\tcloseByEsc: true,\r\n\t\t\t\t\toverlay: {\r\n\t\t\t\t\t\tbackgroundColor: 'grey', opacity: '80'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tclassName: \"process-maker-popup\",\r\n\t\t\t\t\twidth: 800,\r\n\t\t\t\t\toffsetLeft: 0,\r\n\t\t\t\t\toffsetTop: 0\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tdestroyProcessMakerPopup()\r\n\t{\r\n\t\tif (this.cache.has('process-maker-popup'))\r\n\t\t{\r\n\t\t\tthis.cache.get('process-maker-popup').destroy();\r\n\t\t\tthis.cache.delete('process-maker-popup');\r\n\t\t}\r\n\t}\r\n\r\n\t#prepareSmartProcessFunnelsContent(funnels)\r\n\t{\r\n\t\tconst content = document.createElement('TABLE');\r\n\t\tconst tbody = document.createElement('TBODY');\r\n\t\tcontent.append(tbody);\r\n\r\n\t\tfor (let key in funnels) {\r\n\t\t\ttbody.append(this.#prepareFunnelData(funnels[key]));\r\n\t\t}\r\n\r\n\t\treturn content;\r\n\t}\r\n\r\n\t#prepareFunnelData(funnel)\r\n\t{\r\n\t\tlet row = document.createElement('TR');\r\n\t\tlet data = document.createElement('TD');\r\n\t\tlet link = document.createElement('A');\r\n\r\n\t\tlink.innerText = funnel.name;\r\n\t\tlink.dataset.categoryId = funnel.id;\r\n\t\tlink.classList.add('process-stage-link');\r\n\t\tlink.addEventListener('click', this.createSmartProcess.bind(this));\r\n\t\tdata.append(link);\r\n\t\trow.append(data);\r\n\r\n\t\treturn row;\r\n\t}\r\n\r\n\tcreateSmartProcess(event)\r\n\t{\r\n\t\tlet fields = this.getSelectedProductsFields(Editor.#getAjaxFields());\r\n\r\n\t\tif (fields.length === 0) {\r\n\t\t\tthis.setGridChanged(false);\r\n\t\t\tthis.reloadGrid(false);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfields.forEach((elem) => {\r\n\t\t\tlet oldId = elem.ID;\r\n\t\t\tlet newId = \"id_\" + Text.getRandom();\r\n\r\n\t\t\telem.ID = newId;\r\n\t\t\tfields.forEach((child) => {\r\n\t\t\t\tif (child.UF_APPLICATION_PARENT_PRODUCT_ROW_ID == oldId) {\r\n\t\t\t\t\tchild.UF_APPLICATION_PARENT_PRODUCT_ROW_ID = newId;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tBX.ajax.runComponentAction('bitrix:crm.item.details', 'save', {\r\n\t\t\tmode: 'class',\r\n\t\t\tdata: {\r\n\t\t\t\tsessid: BX.bitrix_sessid(),\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tTITLE: BX.Crm.EntityEditor.defaultInstance.getModel().getField(\"TITLE\"),\r\n\t\t\t\t\tOPPORTUNITY: BX.Crm.EntityEditor.defaultInstance.getModel().getField(\"OPPORTUNITY\"),\r\n\t\t\t\t\tIS_MANUAL_OPPORTUNITY: 'Y',\r\n\t\t\t\t\tCATEGORY_ID: event.target.dataset.categoryId,\r\n\t\t\t\t\tPARENT_ID_2: BX.Crm.EntityEditor.defaultInstance.getModel().getField(\"ID\"),\r\n\t\t\t\t\t//['DYNAMIC_'+this.getSettingValue('smartProcessId')+'_PRODUCT_DATA']: JSON.stringify(fields)\r\n\t\t\t\t},\r\n\t\t\t\tsignedParameters: this.getSettingValue('smartProcessSignedParameters')\r\n\t\t\t}\r\n\t\t}).then(async (res) => {\r\n\t\t\tlet response = await res;\r\n\r\n\t\t\t/** Сначала сохраняем товары в смарт процессе через наш компонент чтобы подтянулись userfields */\r\n\t\t\tajax.runComponentAction(\r\n\t\t\t\tthis.getComponentName(),\r\n\t\t\t\t'saveProductRows',\r\n\t\t\t\t{\r\n\t\t\t\t\tmode: 'class',\r\n\t\t\t\t\tsignedParameters: this.getSignedParameters(),\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tentityId: res.data.ENTITY_ID,\r\n\t\t\t\t\t\tentityTypeId: this.getSettingValue('smartProcessId'),\r\n\t\t\t\t\t\trows: fields,\r\n\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\tACTION: 'saveProductRows',\r\n\t\t\t\t\t\t\tSTAGE: 'addAfterCreate'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t\tthis.getSelectedProducts().forEach((product) => {\r\n\t\t\t\tproduct.setField('UF_SMART_PROCESS_ID', res.data.ENTITY_ID);\r\n\t\t\t\tproduct.setField('UF_SMART_PROCESS_STATUS', res.data.ENTITY_DATA.STAGE_ID)\r\n\t\t\t});\r\n\r\n\t\t\tajax.runComponentAction(\r\n\t\t\t\tthis.getComponentName(),\r\n\t\t\t\t'saveProductRows',\r\n\t\t\t\t{\r\n\t\t\t\t\tmode: 'class',\r\n\t\t\t\t\tsignedParameters: this.getSignedParameters(),\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tentityId: this.getSettingValue('entityId'),\r\n\t\t\t\t\t\tentityTypeId: this.getSettingValue('entityTypeId'),\r\n\t\t\t\t\t\trows: this.getProductsFields(Editor.#getAjaxFields()),\r\n\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\tACTION: 'saveProductRows'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t).then(response => {\r\n\t\t\t\tthis.setGridChanged(false);\r\n\t\t\t\tthis.reloadGrid(false);\r\n\t\t\t}, response => {\r\n\t\t\t\tthis.setGridChanged(false);\r\n\t\t\t\tthis.reloadGrid(false);\r\n\t\t\t})\r\n\t\t\t/*let data = {\r\n\t\t\t\tsmartProcessId: res.data.ENTITY_ID,\r\n\t\t\t\tproductRowIds: [],\r\n\t\t\t\townerInfo: BX.Crm.EntityEditor.defaultInstance.getOwnerInfo()\r\n\t\t\t}\r\n\r\n\t\t\tthis.getSelectedProducts().forEach((product) => {\r\n\t\t\t\tdata.productRowIds.push(product.getField(\"ID\"));\r\n\t\t\t});\r\n\r\n\t\t\tBX.ajax.runComponentAction('kitconsulting:crm.entity.extendedproduct.applications', 'insertSmartProcessIdInRows', {\r\n\t\t\t\tmode: 'class',\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tsessid: BX.bitrix_sessid(),\r\n\t\t\t\t\tdata: data\r\n\t\t\t\t}\r\n\t\t\t})*/\r\n\t\t});\r\n\t\t/*console.log(this.getSelectedProducts());\r\n\t\tBX.ajax.runComponentAction('kitconsulting:crm.entity.extendedproduct.applications', 'createSmartProcess', {\r\n\t\t\tmode: 'class',\r\n\t\t\tdata: {\r\n\t\t\t\tsessid: BX.bitrix_sessid(),\r\n\t\t\t\tdata: {\r\n\t\t\t\t\tTITLE: BX.Crm.EntityEditor.defaultInstance.getModel().getField(\"TITLE\"),\r\n\t\t\t\t\tOPPORTUNITY: BX.Crm.EntityEditor.defaultInstance.getModel().getField(\"OPPORTUNITY\"),\r\n\t\t\t\t\tIS_MANUAL_OPPORTUNITY: 'Y',\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}).then(async (res) => {\r\n\t\t\tconsole.log(await res);\r\n\t\t});*/\r\n\t}\r\n\r\n\tgetSelectedProducts()\r\n\t{\r\n\t\treturn this.products.filter((elem) => {\r\n\t\t\tif (elem.getNode().classList.contains('main-grid-row-checked')) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tdestroySettingsPopup()\r\n\t{\r\n\t\tif (this.cache.has('settings-popup'))\r\n\t\t{\r\n\t\t\tthis.cache.get('settings-popup').getPopup().destroy();\r\n\t\t\tthis.cache.delete('settings-popup');\r\n\t\t}\r\n\t}\r\n\r\n\tgetSettingsPopup()\r\n\t{\r\n\t\treturn this.cache.remember('settings-popup', () => {\r\n\t\t\treturn new SettingsPopup(\r\n\t\t\t\tthis.getContainer().querySelector('.crm-entity-product-list-add-block-active [data-role=\"product-list-settings-button\"]'),\r\n\t\t\t\tthis.getSettingValue('popupSettings', []),\r\n\t\t\t\tthis\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tgetHintPopup(): HintPopup\r\n\t{\r\n\t\treturn this.cache.remember('hint-popup', () => {\r\n\t\t\treturn new HintPopup(this);\r\n\t\t});\r\n\t}\r\n\r\n\tcreateGridProductRow(): BX.Grid.Row\r\n\t{\r\n\t\tconst newId = \"id_\" + Text.getRandom();\r\n\t\tconst originalTemplate = this.redefineTemplateEditData(newId);\r\n\r\n\t\tconst grid = this.getGrid();\r\n\t\tlet newRow;\r\n\t\tif (this.getSettingValue('newRowPosition') === 'bottom')\r\n\t\t{\r\n\t\t\tnewRow = grid.appendRowEditor();\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tnewRow = grid.prependRowEditor();\r\n\t\t}\r\n\r\n\t\tconst newNode = newRow.getNode();\r\n\r\n\t\tif (Type.isDomNode(newNode))\r\n\t\t{\r\n\t\t\tnewNode.setAttribute('data-id', newId);\r\n\t\t\tnewRow.makeCountable();\r\n\t\t}\r\n\r\n\t\tif (originalTemplate)\r\n\t\t{\r\n\t\t\tthis.setOriginalTemplateEditData(originalTemplate);\r\n\t\t}\r\n\r\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\r\n\r\n\t\tgrid.adjustRows();\r\n\t\tgrid.updateCounterDisplayed();\r\n\t\tgrid.updateCounterSelected();\r\n\t\t/** @hack нужно использовать newRow.cancelEdit() но там много лишних действий */\r\n\t\tnewRow.getNode().classList.remove('main-grid-row-edit');\r\n\t\tnewRow.unselect();\r\n\t\tnewRow.getNode().classList.add('main-grid-row-edit');\r\n\r\n\t\treturn newRow;\r\n\t}\r\n\r\n\thandleDeleteRow(rowId, event: BaseEvent)\r\n\t{\r\n\t\tevent.preventDefault();\r\n\t\tthis.deleteRow(rowId);\r\n\t}\r\n\r\n\tredefineTemplateEditData(newId: string)\r\n\t{\r\n\t\tconst data = this.getGridEditData();\r\n\t\tconst originalTemplateData = data[GRID_TEMPLATE_ROW];\r\n\t\tconst customEditData = this.prepareCustomEditData(originalTemplateData, newId);\r\n\r\n\t\tthis.setOriginalTemplateEditData({...originalTemplateData, ...customEditData})\r\n\r\n\t\treturn originalTemplateData;\r\n\t}\r\n\r\n\tprepareCustomEditData(originalEditData, newId)\r\n\t{\r\n\t\tconst customEditData = {};\r\n\t\tconst templateIdMask = this.getSettingValue('templateIdMask', '');\r\n\r\n\t\tfor (let i in originalEditData)\r\n\t\t{\r\n\t\t\tif (originalEditData.hasOwnProperty(i))\r\n\t\t\t{\r\n\t\t\t\tif (Type.isStringFilled(originalEditData[i]) && originalEditData[i].indexOf(templateIdMask) >= 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tcustomEditData[i] = originalEditData[i].replace(\r\n\t\t\t\t\t\tnew RegExp(templateIdMask, 'g'),\r\n\t\t\t\t\t\tnewId\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\telse if (Type.isPlainObject(originalEditData[i]))\r\n\t\t\t\t{\r\n\t\t\t\t\tcustomEditData[i] = this.prepareCustomEditData(originalEditData[i], newId);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tcustomEditData[i] = originalEditData[i];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn customEditData;\r\n\t}\r\n\r\n\tinitializeNewProductRow(newId, anchorProduct: Row = null): Row\r\n\t{\r\n\t\tlet fields = anchorProduct?.getFields();\r\n\t\tif (Type.isNil(fields))\r\n\t\t{\r\n\t\t\tfields = {\r\n\t\t\t\t...this.getSettingValue('templateItemFields', {}),\r\n\t\t\t\t...{\r\n\t\t\t\t\tCURRENCY: this.getCurrencyId()\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tconst lastItem = this.products[this.products.length - 1];\r\n\t\t\tif (lastItem)\r\n\t\t\t{\r\n\t\t\t\tfields.TAX_INCLUDED = lastItem.getField('TAX_INCLUDED');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst rowId = this.getRowIdPrefix() + newId;\r\n\t\tfields.ID = newId;\r\n\t\tif (Type.isObject(fields.IMAGE_INFO))\r\n\t\t{\r\n\t\t\tdelete(fields.IMAGE_INFO.input);\r\n\t\t}\r\n\t\tdelete(fields.RESERVE_ID);\r\n\t\tconst isReserveBlocked = this.getSettingValue('isReserveBlocked', false);\r\n\t\tconst product = new Row(rowId, fields, {isReserveBlocked}, this);\r\n\t\tproduct.refreshFieldsLayout();\r\n\r\n\t\tif (anchorProduct instanceof Row)\r\n\t\t{\r\n\t\t\tthis.products.splice(1 + this.products.indexOf(anchorProduct), 0, product);\r\n\r\n\t\t\tproduct.getSelector()?.reloadFileInput();\r\n\t\t\tproduct.getSelector()?.layout();\r\n\t\t\tproduct.updateUiMeasure(\r\n\t\t\t\tproduct.getField('MEASURE_CODE'),\r\n\t\t\t\tText.encode(product.getField('MEASURE_NAME'))\r\n\t\t\t);\r\n\t\t}\r\n\t\telse if (this.getSettingValue('newRowPosition') === 'bottom')\r\n\t\t{\r\n\t\t\tthis.products.push(product);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.products.unshift(product);\r\n\t\t}\r\n\r\n\t\tthis.refreshSortFields();\r\n\t\tthis.numerateRows();\r\n\r\n\t\tproduct.updateUiCurrencyFields();\r\n\t\tthis.updateTotalUiCurrency();\r\n\r\n\t\tif (product.getField('UF_APPLICATION_PARENT_PRODUCT_ROW_ID', 0) != 0) {\r\n\t\t\tproduct.disableUiField('UF_NEED_ADJUSTMENT');\r\n\t\t\tproduct.disableUiField('UF_CRM_PR_ADJUSTMENT');\r\n\t\t\tproduct.getNode().querySelector('[data-field-code=\"UF_APPLICATION_PRICE\"]').style.display = null;\r\n\t\t\tproduct.setApplicationPrice(product.getField('UF_APPLICATION_PRICE'));\r\n\t\t}\r\n\r\n\t\treturn product;\r\n\t}\r\n\r\n\tinitializeNewProductRowWithoutFields(newId, anchorProduct: Row): Row\r\n\t{\r\n\t\tlet fields = null;\r\n\t\tif (Type.isNil(fields))\r\n\t\t{\r\n\t\t\tfields = {\r\n\t\t\t\t...this.getSettingValue('templateItemFields', {}),\r\n\t\t\t\t...{\r\n\t\t\t\t\tCURRENCY: this.getCurrencyId()\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tconst lastItem = this.products[this.products.length - 1];\r\n\t\t\tif (lastItem)\r\n\t\t\t{\r\n\t\t\t\tfields.TAX_INCLUDED = lastItem.getField('TAX_INCLUDED');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst rowId = this.getRowIdPrefix() + newId;\r\n\t\tfields.ID = newId;\r\n\t\tif (Type.isObject(fields.IMAGE_INFO))\r\n\t\t{\r\n\t\t\tdelete(fields.IMAGE_INFO.input);\r\n\t\t}\r\n\t\tdelete(fields.RESERVE_ID);\r\n\t\tconst isReserveBlocked = this.getSettingValue('isReserveBlocked', false);\r\n\t\tconst product = new Row(rowId, fields, {isReserveBlocked}, this);\r\n\t\tproduct.refreshFieldsLayout();\r\n\r\n\t\tif (anchorProduct instanceof Row)\r\n\t\t{\r\n\t\t\tthis.products.splice(1 + this.products.indexOf(anchorProduct), 0, product);\r\n\r\n\t\t\tproduct.getSelector()?.reloadFileInput();\r\n\t\t\tproduct.getSelector()?.layout();\r\n\t\t\tproduct.updateUiMeasure(\r\n\t\t\t\tproduct.getField('MEASURE_CODE'),\r\n\t\t\t\tText.encode(product.getField('MEASURE_NAME'))\r\n\t\t\t);\r\n\t\t}\r\n\t\telse if (this.getSettingValue('newRowPosition') === 'bottom')\r\n\t\t{\r\n\t\t\tthis.products.push(product);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.products.unshift(product);\r\n\t\t}\r\n\r\n\t\tthis.refreshSortFields();\r\n\t\tthis.numerateRows();\r\n\r\n\t\tproduct.updateUiCurrencyFields();\r\n\t\tthis.updateTotalUiCurrency();\r\n\r\n\t\treturn product;\r\n\t}\r\n\r\n\tisTaxIncludedActive(): boolean\r\n\t{\r\n\t\treturn this.products\r\n\t\t\t.filter((product) => product.isTaxIncluded())\r\n\t\t\t.length > 0\r\n\t\t;\r\n\t}\r\n\r\n\tgetProductSelector(newId: string): ?ProductSelector\r\n\t{\r\n\t\treturn ProductSelector.getById('crm_grid_' + this.getRowIdPrefix() + newId);\r\n\t}\r\n\r\n\tfocusProductSelector(newId: string): void\r\n\t{\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tthis\r\n\t\t\t\t.getProductSelector(newId)\r\n\t\t\t\t?.searchInDialog()\r\n\t\t\t\t.focusName()\r\n\t\t\t;\r\n\t\t});\r\n\t}\r\n\r\n\thandleOnBeforeProductChange(event: BaseEvent)\r\n\t{\r\n\t\tconst data = event.getData();\r\n\t\tconst product = this.getProductByRowId(data.rowId);\r\n\t\tif (product)\r\n\t\t{\r\n\t\t\tthis.getGrid().tableFade();\r\n\t\t\tproduct.resetExternalActions();\r\n\t\t}\r\n\t}\r\n\r\n\thandleOnProductChange(event: BaseEvent)\r\n\t{\r\n\t\tconst data = event.getData();\r\n\r\n\t\tconst productRow = this.getProductByRowId(data.rowId);\r\n\t\tif (productRow && data.fields)\r\n\t\t{\r\n\t\t\tconst promise = new Promise((resolve, reject) => {\r\n\t\t\t\tconst fields = data.fields;\r\n\r\n\t\t\t\tajax.runComponentAction(\r\n\t\t\t\t\tthis.getComponentName(),\r\n\t\t\t\t\t'getPriceInfo',\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tmode: 'class',\r\n\t\t\t\t\t\tsignedParameters: this.getSignedParameters(),\r\n\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\tproductId: fields['SKU_ID'] > 0 ? fields['SKU_ID'] : fields['PRODUCT_ID'],\r\n\t\t\t\t\t\t\tbasePriceId: productRow.getModel().getBasePriceId(),\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t).then((priceResponse) => {\r\n\t\t\t\t\tif (priceResponse.data['basePrice']) {\r\n\t\t\t\t\t\tfields['BASE_PRICE'] = priceResponse.data['basePrice']['PRICE'];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (priceResponse.data['minimalPrice']) {\r\n\t\t\t\t\t\tfields['MINIMAL_PRICE'] = priceResponse.data['minimalPrice']['PRICE'];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!Type.isNil(fields['IMAGE_INFO']))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfields['IMAGE_INFO'] = JSON.stringify(fields['IMAGE_INFO']);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (this.getCurrencyId() !== fields['CURRENCY_ID'])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tfields['CURRENCY'] = fields['CURRENCY_ID'];\r\n\r\n\t\t\t\t\t\tconst priceFields = {};\r\n\t\t\t\t\t\tthis.#getCalculatePriceFieldNames().forEach((name) => {\r\n\t\t\t\t\t\t\tpriceFields[name] = data.fields[name]\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tconst products = [{\r\n\t\t\t\t\t\t\tfields: priceFields,\r\n\t\t\t\t\t\t\tid: productRow.getId()\r\n\t\t\t\t\t\t}];\r\n\r\n\t\t\t\t\t\tajax.runComponentAction(\r\n\t\t\t\t\t\t\tthis.getComponentName(),\r\n\t\t\t\t\t\t\t'calculateProductPrices',\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tmode: 'class',\r\n\t\t\t\t\t\t\t\tsignedParameters: this.getSignedParameters(),\r\n\t\t\t\t\t\t\t\tdata: {\r\n\t\t\t\t\t\t\t\t\tproducts,\r\n\t\t\t\t\t\t\t\t\tcurrencyId: this.getCurrencyId(),\r\n\t\t\t\t\t\t\t\t\toptions: {\r\n\t\t\t\t\t\t\t\t\t\tACTION: 'calculateProductPrices'\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t).then(\r\n\t\t\t\t\t\t\t(response) => {\r\n\t\t\t\t\t\t\t\tconst changedFields = response.data.result[productRow.getId()];\r\n\t\t\t\t\t\t\t\tif (changedFields)\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tchangedFields['CUSTOMIZED'] = 'Y';\r\n\t\t\t\t\t\t\t\t\tresolve(Object.assign(fields, changedFields));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tresolve(fields);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tresolve(fields);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tpromise.then((fields) => {\r\n\t\t\t\tif (this.products.length > 1)\r\n\t\t\t\t{\r\n\t\t\t\t\tconst taxId = fields['VAT_ID'] || fields['TAX_ID'];\r\n\t\t\t\t\tconst taxIncluded = fields['VAT_INCLUDED'] || fields['TAX_INCLUDED'];\r\n\r\n\t\t\t\t\tif (taxId > 0 && taxIncluded !== productRow.getTaxIncluded())\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst taxRate = this.getTaxList()?.find((item) => parseInt(item.ID) === taxId);\r\n\t\t\t\t\t\tif (taxRate?.VALUE > 0 && taxIncluded === 'Y')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tfields['BASE_PRICE'] = fields['BASE_PRICE'] / (1 + taxRate.VALUE / 100);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t['TAX_INCLUDED', 'VAT_INCLUDED'].forEach(name => delete(fields[name]));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfields['CATALOG_PRICE'] = fields['BASE_PRICE'];\r\n\t\t\t\tfields['ENTERED_PRICE'] = fields['BASE_PRICE'];\r\n\r\n\t\t\t\tif (productRow.getField('OFFER_ID') !== fields.ID)\r\n\t\t\t\t{\r\n\t\t\t\t\tfields['ROW_RESERVED'] = 0;\r\n\t\t\t\t\tfields['DEDUCTED_QUANTITY'] = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tObject.keys(fields).forEach((key) => {\r\n\t\t\t\t\tproductRow.updateFieldValue(key, fields[key]);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (!Type.isStringFilled(fields['CUSTOMIZED']))\r\n\t\t\t\t{\r\n\t\t\t\t\tproductRow.setField('CUSTOMIZED', 'N');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tproductRow.setField('IS_NEW', data.isNew ? 'Y' : 'N');\r\n\r\n\t\t\t\tproductRow.layoutReserveControl();\r\n\t\t\t\tproductRow.initHandlersForSelectors();\r\n\t\t\t\tproductRow.updateUiStoreAmountData();\r\n\t\t\t\tproductRow.modifyBasePriceInput();\r\n\t\t\t\tproductRow.executeExternalActions();\r\n\t\t\t\tthis.getGrid().tableUnfade();\r\n\t\t\t});\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tthis.getGrid().tableUnfade();\r\n\t\t}\r\n\t}\r\n\r\n\thandleOnProductClear(event: BaseEvent)\r\n\t{\r\n\t\tconst {rowId} = event.getData();\r\n\r\n\t\tconst product = this.getProductByRowId(rowId);\r\n\t\tif (product)\r\n\t\t{\r\n\t\t\tproduct.layoutReserveControl();\r\n\t\t\tproduct.initHandlersForSelectors();\r\n\t\t\tproduct.changeEnteredPrice(0);\r\n\t\t\tproduct.modifyBasePriceInput();\r\n\t\t\tproduct.executeExternalActions();\r\n\t\t}\r\n\t}\r\n\r\n\tcompileProductData(): void\r\n\t{\r\n\t\tif (!this.isExistForm())\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.initFormFields();\r\n\r\n\t\tconst field = this.getDataField();\r\n\t\tconst settingsField = this.getDataSettingsField();\r\n\r\n\t\tthis.cleanProductRows();\r\n\r\n\t\tif (Type.isElementNode(field) && Type.isElementNode(settingsField))\r\n\t\t{\r\n\t\t\t// field.value = this.prepareProductDataValue();\r\n\t\t\tfield.value = this.prepareProductDataValue();\r\n\r\n\t\t\tsettingsField.value = JSON.stringify({\r\n\t\t\t\tENABLE_DISCOUNT: this.getDiscountEnabled(),\r\n\t\t\t\tENABLE_TAX: this.getTaxEnabled()\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.addFirstRowIfEmpty();\r\n\t}\r\n\r\n\tprepareProductDataValue(): string\r\n\t{\r\n\t\tlet productDataValue = '';\r\n\r\n\t\tif (this.getProductCount())\r\n\t\t{\r\n\t\t\tconst productData = [];\r\n\r\n\t\t\tthis.products.forEach((item) => {\r\n\t\t\t\tconst saveFields = item.getFields(Editor.#getAjaxFields());\r\n\r\n\t\t\t\tif (!/^[0-9]+$/.test(saveFields['ID']))\r\n\t\t\t\t{\r\n\t\t\t\t\tsaveFields['ID'] = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsaveFields['CUSTOMIZED'] = 'Y';\r\n\r\n\t\t\t\tproductData.push(saveFields);\r\n\t\t\t});\r\n\r\n\t\t\tproductDataValue = JSON.stringify(productData);\r\n\t\t}\r\n\r\n\t\treturn productDataValue;\r\n\t}\r\n\r\n\tstatic #getAjaxFields(): []\r\n\t{\r\n\t\treturn [\r\n\t\t\t'ID',\r\n\t\t\t'PRODUCT_ID',\r\n\t\t\t'PRODUCT_NAME',\r\n\t\t\t'QUANTITY',\r\n\t\t\t'TAX_RATE',\r\n\t\t\t'TAX_INCLUDED',\r\n\t\t\t'PRICE_EXCLUSIVE',\r\n\t\t\t'PRICE_NETTO',\r\n\t\t\t'PRICE_BRUTTO',\r\n\t\t\t'PRICE',\r\n\t\t\t'CUSTOMIZED',\r\n\t\t\t'BASE_PRICE',\r\n\t\t\t'ENTERED_PRICE',\r\n\t\t\t'DISCOUNT_ROW',\r\n\t\t\t'DISCOUNT_SUM',\r\n\t\t\t'DISCOUNT_TYPE_ID',\r\n\t\t\t'DISCOUNT_RATE',\r\n\t\t\t'CURRENCY',\r\n\t\t\t'STORE_ID',\r\n\t\t\t'INPUT_RESERVE_QUANTITY',\r\n\t\t\t'RESERVE_QUANTITY',\r\n\t\t\t'DATE_RESERVE_END',\r\n\t\t\t'SORT',\r\n\t\t\t'MEASURE_CODE',\r\n\t\t\t'MEASURE_NAME',\r\n\t\t\t'UF_NEED_ADJUSTMENT',\r\n\t\t\t'UF_CRM_PR_ADJUSTMENT',\r\n\t\t\t'UF_APPLICATION_PRICE',\r\n\t\t\t'UF_APPLICATION_PARENT_PRODUCT_ROW_ID',\r\n\t\t\t'UF_SMART_PROCESS_ID',\r\n\t\t\t'UF_PURCHASE_PRICE',\r\n\t\t];\r\n\t}\r\n\r\n\t/* actions */\r\n\texecuteActions(actions)\r\n\t{\r\n\t\tif (!Type.isArrayFilled(actions))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst disableSaveButton = actions\r\n\t\t\t.filter(\r\n\t\t\t\t(action) => action.type === this.actions.updateTotal || action.type === this.actions.disableSaveButton\r\n\t\t\t)\r\n\t\t\t.length > 0\r\n\t\t;\r\n\r\n\t\tfor (const item of actions)\r\n\t\t{\r\n\t\t\tif (\r\n\t\t\t\t!Type.isPlainObject(item)\r\n\t\t\t\t|| !Type.isStringFilled(item.type)\r\n\t\t\t)\r\n\t\t\t{\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tswitch (item.type)\r\n\t\t\t{\r\n\t\t\t\tcase this.actions.productChange:\r\n\t\t\t\t\tthis.actionSendProductChange(item, disableSaveButton);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase this.actions.productListChanged:\r\n\t\t\t\t\tthis.actionSendProductListChanged(disableSaveButton);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase this.actions.updateListField:\r\n\t\t\t\t\tthis.actionUpdateListField(item);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase this.actions.updateTotal:\r\n\t\t\t\t\tthis.actionUpdateTotalData();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase this.actions.stateChanged:\r\n\t\t\t\t\tthis.actionSendStatusChange(item);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tactionSendProductChange(item, disableSaveButton)\r\n\t{\r\n\t\tif (!Type.isStringFilled(item.id))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst product = this.getProductByRowId(item.id);\r\n\t\tif (!product)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tEventEmitter.emit(this, 'ProductList::onChangeFields', {\r\n\t\t\trowId: item.id,\r\n\t\t\tproductId: product.getField('PRODUCT_ID'),\r\n\t\t\tfields: this.getProductByRowId(item.id).getCatalogFields()\r\n\t\t});\r\n\r\n\t\tif (this.controller)\r\n\t\t{\r\n\t\t\tthis.controller.productChange(disableSaveButton);\r\n\t\t\tthis.setGridChanged(true);\r\n\t\t}\r\n\t}\r\n\r\n\tactionSendProductListChanged(disableSaveButton: boolean = false): void\r\n\t{\r\n\t\tif (this.controller)\r\n\t\t{\r\n\t\t\tthis.controller.productChange(disableSaveButton);\r\n\t\t\tthis.setGridChanged(true);\r\n\t\t}\r\n\t}\r\n\r\n\tactionUpdateListField(item)\r\n\t{\r\n\t\tif (!Type.isStringFilled(item.field) || !('value' in item))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.allowUpdateListField(item.field))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.updateFieldForList = item.field;\r\n\r\n\t\tfor (const row of this.products)\r\n\t\t{\r\n\t\t\trow.updateFieldByName(item.field, item.value);\r\n\t\t}\r\n\r\n\t\tthis.updateFieldForList = null;\r\n\t}\r\n\r\n\tactionUpdateTotalData(options = {})\r\n\t{\r\n\t\tif (this.totalData.inProgress)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.updateTotalDataDelayedHandler(options);\r\n\t}\r\n\r\n\tactionSendStatusChange(item)\r\n\t{\r\n\t\tif (!('value' in item))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.stateChange.changed === item.value)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.stateChange.changed = item.value;\r\n\t\tif (this.stateChange.sended)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.stateChange.sended = true;\r\n\t}\r\n\r\n\t/* actions finish */\r\n\r\n\t/* action tools */\r\n\tallowUpdateListField(field)\r\n\t{\r\n\t\tif (this.updateFieldForList !== null)\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tlet result = true;\r\n\r\n\t\tswitch (field)\r\n\t\t{\r\n\t\t\tcase 'TAX_INCLUDED':\r\n\t\t\t\tresult = this.isTaxUniform() && this.isTaxAllowed();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tsetGridChanged(changed: boolean)\r\n\t{\r\n\t\tthis.isChangedGrid = changed;\r\n\t}\r\n\r\n\tisChanged(): boolean\r\n\t{\r\n\t\treturn this.isChangedGrid;\r\n\t}\r\n\r\n\tupdateTotalDataDelayed(options = {})\r\n\t{\r\n\t\tif (this.totalData.inProgress)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.totalData.inProgress = true;\r\n\r\n\t\tconst products = this.getProductsFields(this.getProductFieldListForTotalData());\r\n\t\tproducts.forEach(item => item['CUSTOMIZED'] = 'Y');\r\n\r\n\t\tthis.ajaxRequest('calculateTotalData', {\r\n\t\t\toptions,\r\n\t\t\tproducts,\r\n\t\t\tcurrencyId: this.getCurrencyId()\r\n\t\t});\r\n\t}\r\n\r\n\tgetProductsFields(fields: Array = [])\r\n\t{\r\n\t\tconst productFields = [];\r\n\r\n\t\tfor (const item of this.products)\r\n\t\t{\r\n\t\t\tproductFields.push(item.getFields(fields));\r\n\t\t}\r\n\r\n\t\treturn productFields;\r\n\t}\r\n\r\n\tgetSelectedProductsFields(fields: Array = [])\r\n\t{\r\n\t\tconst productFields = [];\r\n\r\n\t\tfor (const item of this.getSelectedProducts())\r\n\t\t{\r\n\t\t\tproductFields.push(item.getFields(fields));\r\n\t\t}\r\n\r\n\t\treturn productFields;\r\n\t}\r\n\r\n\tgetProductFieldListForTotalData()\r\n\t{\r\n\t\treturn [\r\n\t\t\t'PRODUCT_ID',\r\n\t\t\t'PRODUCT_NAME',\r\n\t\t\t'QUANTITY',\r\n\t\t\t'DISCOUNT_TYPE_ID',\r\n\t\t\t'DISCOUNT_RATE',\r\n\t\t\t'DISCOUNT_SUM',\r\n\t\t\t'TAX_RATE',\r\n\t\t\t'TAX_INCLUDED',\r\n\t\t\t'PRICE_EXCLUSIVE',\r\n\t\t\t'PRICE',\r\n\t\t\t'CUSTOMIZED',\r\n\t\t\t'UF_APPLICATION_PARENT_PRODUCT_ROW_ID',\r\n\t\t\t'UF_APPLICATION_PRICE',\r\n\t\t\t'UF_PURCHASE_PRICE'\r\n\t\t];\r\n\t}\r\n\r\n\tsetTotalData(data, options = {})\r\n\t{\r\n\t\tconst item = BX(this.getSettingValue('totalBlockContainerId', null));\r\n\t\tif (Type.isElementNode(item))\r\n\t\t{\r\n\t\t\tconst currencyId = this.getCurrencyId();\r\n\t\t\tconst list = [\r\n\t\t\t\t'totalCost',\r\n\t\t\t\t'totalDelivery',\r\n\t\t\t\t'totalTax',\r\n\t\t\t\t'totalWithoutTax',\r\n\t\t\t\t'totalDiscount',\r\n\t\t\t\t'totalWithoutDiscount',\r\n\t\t\t\t'totalDefaultProducts',\r\n\t\t\t\t'totalApplicationsAndCirculation'\r\n\t\t\t];\r\n\r\n\t\t\tfor (const id of list)\r\n\t\t\t{\r\n\t\t\t\tconst row = item.querySelector('[data-total=\"' + id + '\"]');\r\n\r\n\t\t\t\tif (Type.isElementNode(row) && (id in data))\r\n\t\t\t\t{\r\n\t\t\t\t\trow.innerHTML = CurrencyCore.currencyFormat(data[id], currencyId, false);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.sendTotalData(data, options);\r\n\t\tthis.totalData.inProgress = false;\r\n\t}\r\n\r\n\tsendTotalData(data, options)\r\n\t{\r\n\t\tif (this.controller)\r\n\t\t{\r\n\t\t\tlet needMarkAsChanged = true;\r\n\t\t\tif (\r\n\t\t\t\tType.isObject(options)\r\n\t\t\t\t&& (options.isInternalChanging === true || options.isInternalChanging === 'true')\r\n\t\t\t)\r\n\t\t\t{\r\n\t\t\t\tneedMarkAsChanged = false;\r\n\t\t\t}\r\n\r\n\t\t\tsetTimeout(\r\n\t\t\t\t() => {\r\n\t\t\t\t\tthis.controller.changeSumTotal(data, needMarkAsChanged, !this.#childrenHasErrors());\r\n\t\t\t\t},\r\n\t\t\t\t500\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\t/* action tools finish */\r\n\r\n\t/* ajax tools */\r\n\tajaxRequest(action, data)\r\n\t{\r\n\t\tconst requestKey = Text.getRandom();\r\n\t\tthis.ajaxPool.set(action, requestKey);\r\n\r\n\t\tif (!Type.isPlainObject(data.options))\r\n\t\t{\r\n\t\t\tdata.options = {};\r\n\t\t}\r\n\t\tdata.options.ACTION = action;\r\n\t\tdata.options.REQUEST_KEY = requestKey;\r\n\r\n\t\tajax.runComponentAction(\r\n\t\t\tthis.getComponentName(),\r\n\t\t\taction,\r\n\t\t\t{\r\n\t\t\t\tmode: 'class',\r\n\t\t\t\tsignedParameters: this.getSignedParameters(),\r\n\t\t\t\tdata: data\r\n\t\t\t}\r\n\t\t).then(\r\n\t\t\t(response) => this.ajaxResultSuccess(response, data.options),\r\n\t\t\t(response) => this.ajaxResultFailure(response, data.options)\r\n\t\t);\r\n\t}\r\n\r\n\tajaxResultSuccess(response, requestOptions)\r\n\t{\r\n\t\tif (!this.ajaxResultCommonCheck(response) || this.ajaxPool.get(response.data.action) !== requestOptions.REQUEST_KEY)\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.ajaxPool.delete(response.data.action);\r\n\r\n\t\tEventEmitter.emit(this, 'onAjaxSuccess', response.data.action);\r\n\r\n\t\tswitch (response.data.action)\r\n\t\t{\r\n\t\t\tcase 'calculateTotalData':\r\n\t\t\t\tif (Type.isPlainObject(response.data.result))\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.setTotalData(response.data.result, requestOptions);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'calculateProductPrices':\r\n\t\t\t\tif (Type.isPlainObject(response.data.result))\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.onCalculatePricesResponse(response.data.result);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tvalidateSubmit()\r\n\t{\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst currentBalloon = BX.UI.Notification.Center.getBalloonByCategory(ProductModel.SAVE_NOTIFICATION_CATEGORY);\r\n\t\t\tif (currentBalloon)\r\n\t\t\t{\r\n\t\t\t\tEventEmitter.subscribeOnce(\r\n\t\t\t\t\tcurrentBalloon,\r\n\t\t\t\t\tBX.UI.Notification.Event.getFullName('onClose'),\r\n\t\t\t\t\t() => {\r\n\t\t\t\t\t\tsetTimeout(resolve, 500);\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t\tcurrentBalloon.close();\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tsetTimeout(resolve(), 50);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tajaxResultFailure(response, requestOptions)\r\n\t{\r\n\t\tthis.ajaxPool.delete(requestOptions.ACTION);\r\n\t}\r\n\r\n\tajaxResultCommonCheck(responce)\r\n\t{\r\n\t\tif (!Type.isPlainObject(responce))\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!Type.isStringFilled(responce.status))\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (responce.status !== 'success')\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!Type.isPlainObject(responce.data))\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif (!Type.isStringFilled(responce.data.action))\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\t// noinspection RedundantIfStatementJS\r\n\t\tif (!('result' in responce.data))\r\n\t\t{\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\tdeleteApplicationsForRow(rowId, productId = null)\r\n\t{\r\n\t\tfor (let i = 0; i < this.products.length; i++) {\r\n\t\t\tlet applicationRow = this.products[i];\r\n\r\n\t\t\tif (applicationRow.getField('UF_APPLICATION_PARENT_PRODUCT_ROW_ID', 0) == rowId) {\r\n\t\t\t\tif (productId === null || productId == applicationRow.getField('PRODUCT_ID')) {\r\n\t\t\t\t\tthis.deleteRow(applicationRow.getField('ID'));\r\n\t\t\t\t\ti--;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdeleteRow(rowId: string, skipActions: boolean = false): void\r\n\t{\r\n\t\tthis.deleteApplicationsForRow(rowId);\r\n\r\n\t\tif (!Type.isStringFilled(rowId))\r\n\t\t{\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst gridRow = this.getGrid().getRows().getById(rowId);\r\n\t\tif (gridRow)\r\n\t\t{\r\n\t\t\tDom.remove(gridRow.getNode());\r\n\t\t\tthis.getGrid().getRows().reset();\r\n\t\t}\r\n\r\n\t\tconst productRow = this.getProductById(rowId);\r\n\t\tif (productRow)\r\n\t\t{\r\n\t\t\tconst index = this.products.indexOf(productRow);\r\n\t\t\tif (index > -1)\r\n\t\t\t{\r\n\t\t\t\tthis.products.splice(index, 1);\r\n\t\t\t\tthis.refreshSortFields();\r\n\t\t\t\tthis.numerateRows();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\r\n\r\n\t\tif (!skipActions)\r\n\t\t{\r\n\t\t\tthis.addFirstRowIfEmpty();\r\n\t\t\tthis.executeActions([\r\n\t\t\t\t{type: this.actions.productListChanged},\r\n\t\t\t\t{type: this.actions.updateTotal}\r\n\t\t\t]);\r\n\t\t}\r\n\t}\r\n\r\n\tcopyRow(row: Row): void\r\n\t{\r\n\t\tthis.addProductRow(row)\r\n\t\tthis.refreshSortFields();\r\n\t\tthis.numerateRows();\r\n\r\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\r\n\r\n\t\tthis.executeActions([\r\n\t\t\t{type: this.actions.productListChanged},\r\n\t\t\t{type: this.actions.updateTotal}\r\n\t\t]);\r\n\t}\r\n\r\n\tcopyRowAndReturnProductId(row: Row): number\r\n\t{\r\n\t\tlet id = this.addProductRow(row)\r\n\t\tthis.refreshSortFields();\r\n\t\tthis.numerateRows();\r\n\r\n\t\tEventEmitter.emit('Grid::thereEditedRows', []);\r\n\r\n\t\tthis.executeActions([\r\n\t\t\t{type: this.actions.productListChanged},\r\n\t\t\t{type: this.actions.updateTotal}\r\n\t\t]);\r\n\t\treturn id;\r\n\t}\r\n\r\n\tcleanProductRows(): void\r\n\t{\r\n\t\tthis.products\r\n\t\t\t.filter(item => item.isEmpty())\r\n\t\t\t.forEach((row) => this.deleteRow(row.getField('ID'), true))\r\n\t\t;\r\n\t}\r\n\r\n\tresortProductsByIds(ids: Array): boolean\r\n\t{\r\n\t\tlet changed = false;\r\n\r\n\t\tif (Type.isArrayFilled(ids))\r\n\t\t{\r\n\t\t\tthis.products.sort((a, b) => {\r\n\t\t\t\tif (ids.indexOf(a.getField('ID')) > ids.indexOf(b.getField('ID')))\r\n\t\t\t\t{\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tchanged = true;\r\n\r\n\t\t\t\treturn -1;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn changed;\r\n\t}\r\n\r\n\trefreshSortFields(): void\r\n\t{\r\n\t\tthis.products.forEach((item, index) => item.setField('SORT', (index + 1) * 10));\r\n\t}\r\n\r\n\thandleOnTabShow(): void\r\n\t{\r\n\t\tEventEmitter.emit('onDemandRecalculateWrapper');\r\n\t}\r\n}\r\n"],"names":["HintPopup","editor","node","text","hintPopup","Popup","getId","darkMode","closeIcon","animation","setBindElement","adjustPosition","setContent","Tag","render","Text","encode","show","close","ReserveControl","options","Cache","MemoryCache","model","inputFieldName","inputName","INPUT_NAME","dateFieldName","DATE_NAME","quantityFieldName","QUANTITY_NAME","deductedQuantityFieldName","DEDUCTED_QUANTITY_NAME","defaultDateReservation","isBlocked","isReserveEqualProductQuantity","getReservedQuantity","getQuantity","getOption","appendChild","Event","bind","querySelector","Runtime","debounce","onReserveInputChange","getDateReservation","onDateChange","value","isTriggerEvent","input","dispatchEvent","window","toNumber","getField","getDeductedQuantity","event","target","changeInputValue","getAvailableQuantity","errorNotifyId","notify","BX","UI","Notification","Center","getBalloonById","notificationOptions","id","closeButton","autoHideDelay","content","Loc","getMessage","setReservedQuantity","changeDateReservation","setField","EventEmitter","emit","NAME","VALUE","isSimple","isEmpty","newDate","parseDate","current","Date","setHours","date","calendar","field","parentNode","bTime","remember","tag","isInputDisabled","onclick","top","InfoHelper","linkText","link","innerText","hiddenInput","SearchField","fieldOptions","Type","isPlainObject","isStringFilled","name","Error","setType","type","setSystem","system","setSort","sort","setSearchable","searchable","isNumber","flag","isBoolean","isSystem","MatchIndex","queryWord","startIndex","endIndex","length","comparator","a","b","getStartIndex","getEndIndex","MatchField","indexes","OrderedArray","addIndexes","matchIndexes","matchIndex","add","isArray","forEach","addIndex","MatchResult","item","queryWords","Map","matchFields","matchField","get","set","fieldSort","getSort","Math","min","collator","Intl","Collator","undefined","sensitivity","SearchEngine","items","searchQuery","matchResults","getQueryWords","limit","getResultLimit","i","isSelected","isSearchable","isHidden","getEntity","matchResult","matchItem","push","matches","results","matchWord","concat","searchIndexes","getSearchIndex","getIndexes","fieldIndex","j","index","word","getWord","substring","compare","SearchQuery","query","trim","replace","split","cacheable","resultLimit","getDynamicSearchEntities","entityId","includes","entities","isArrayFilled","hasDynamicSearchEntity","dynamicSearchEntities","toJSON","getQuery","CustomDialog","queryString","BaseEvent","data","isDefaultPrevented","selectFirstTab","getSearchTab","clearResults","selectTab","loadWithDebounce","load","getLastSearchQuery","search","searchTab","getSearchLoader","hide","shouldLoad","addCacheQuery","getStub","Ajax","runComponentAction","json","dialog","getDialog","getAjaxJson","onrequeststart","xhr","queryXhr","getParameters","context","getContext","then","response","removeCacheQuery","toggleEmptyResult","Set","itemOptions","tabs","children","addItem","isTabEmpty","isEmptyResult","matchItems","Array","from","values","appendResults","shouldFocusOnFirst","focusOnFirstNode","error","console","Dialog","ProductSearchSelectorFooter","errorAdminHint","subscribe","handleOnSearch","phrase","isViewCreateButton","allowCreateItem","allowEditItem","isViewEditButton","createButton","Dom","getLabelContainer","changeButton","getSaveContainer","getHintContainer","getLoaderContainer","isNil","loader","Loader","size","color","getLoader","label","isString","textContent","cache","handleClick","getQueryContainer","className","messageId","ProductSelector","INPUT_FIELD_BARCODE","onClickSaveChanges","message","hintNode","dataset","hint","hintNoIcon","Hint","initNode","lastQuery","getActiveTab","clearSearch","tagSelector","getTagSelector","isLocked","finalize","hideLoader","unlock","focusSearch","preventDefault","showLoader","lock","emitAsync","getTab","createItem","getData","currentValue","DefaultFooter","ProductCreationLimitedFooter","infoButton","SelectorErrorCode","NOT_SELECTED_PRODUCT","FAILED_PRODUCT","DialogMode","ProductSearchInput","_classPrivateMethodInitSpec","getRandom","selector","isEnabledSearch","isSearchEnabled","isEnabledDetailLink","INPUT_FIELD_NAME","immutableFieldNames","ajaxInProcess","loadedSelectedItem","handleSearchInput","searchInDialog","fieldName","getNameInput","icon","isDomNode","style","getNameTag","getHiddenNameInput","isNew","getValue","getPlaceholder","handleNameInputHiddenChange","getConfig","addClass","setAttribute","handleClearIconClick","getDetailPath","handleSearchIconClick","clearInputCache","block","toggleIcon","getClearIcon","append","isProductSearchEnabled","initHasDialogItems","getSearchIcon","getFilledValue","handleClickNameInput","handleNameInputBlur","handleNameInputKeyDown","dialogMode","isCatalogExisted","SHOW_PRODUCT_ITEM","SHOW_RECENT","showDetailLink","getArrowIcon","handleIconsSwitchingOnNameInput","handleNameInputChange","getNameBlock","searchTypeId","SEARCH_TYPE_ID","entity","iblockId","getIblockId","basePriceId","getBasePriceId","currency","getCurrency","dynamicLoad","dynamicSearch","restrictedProductTypes","params","height","width","max","offsetWidth","targetNode","enableSearch","multiple","dropdownMode","searchTabOptions","stub","stubOptions","title","subtitle","isAllowedCreateProduct","arrow","events","onProductSelect","createProduct","showChangeNotification","settingsCollection","Extension","getSettings","isObject","footer","footerOptions","isAllowedEditProduct","creationLabel","searchOptions","getModel","setConfig","hasDynamicLoad","_classPrivateMethodGet","subscribeOnce","getPreselectedItems","checkProductAddRights","checkProductEditRights","key","stopPropagation","Browser","isMac","metaKey","ctrlKey","getFooter","selectorId","rowId","getRowId","clearState","clearLayout","layout","newValue","onChangeValue","focusName","fields","isEnabledAutosave","setFields","save","autoHide","requestAnimationFrame","focus","isHasDialogItems","SEARCHING","isSearchingInProcess","isOpen","showItems","setTimeout","isEnabledEmptyProductError","inProcess","getErrorCollection","setError","getEmptySelectErrorMessage","layoutErrors","getTargetNode","getTitle","setInputValueOnProductSelect","clearErrors","getCustomData","immutableFields","getImmutableFieldNames","errors","getErrors","code","ErrorCodes","getCodes","removeError","getFields","ProductModel","isSimpleModel","getTarget","newProduct","createProductModelFromSearchQuery","Promise","resolve","reject","checkCreationModel","toInteger","getRecentTab","customData","setOption","select","errorResponse","creationModel","getType","onSave","declineCancelTitle","onCancel","showSaveNotifier","removeItems","ajax","runAction","getSkuId","isLoading","setPreselectedItems","getRootNode","getPopup","loadState","ProductImageInput","config","getImageCollection","getEditInput","restoreDefaultInputHtml","enableSaving","uploaderFieldMap","html","setPreview","setEditInput","defaultInput","isViewMode","isSaveable","imageContainer","getPreview","BarcodeSearchSelectorFooter","isEmptyBarcode","handleOnSearchLoad","barcodeContent","scannerContent","getScannerContent","getScannerLabelContainer","handleScannerClick","getScannerQueryContainer","inputEntity","startMobileScanner","getItems","BarcodeSearchInput","handleFocusEvent","handleBlurEvent","focused","isInstalledMobileApp","qrAuth","QrAuthorization","createQrCodeImage","unbind","onFocusHandler","onBlurHandler","searchFields","preselectedItems","closeMobilePopup","sendButton","helpButton","Helper","getQrNode","removeQrAuth","result","userOptions","getContainer","hasClass","layoutMobileQrPopup","disableCancel","searchByBarcode","getSubtitle","sendMobilePush","isEnabledMobileScanning","token","getMobileScannerToken","BarcodeScanner","open","repeatLink","category","barcode","getProductIdByBarcode","productId","selectScannedBarcodeProduct","barcodeIcon","spotlight","SpotLight","targetElement","autoSave","targetVertex","zIndex","guide","Guide","steps","onEvents","setAutoHide","showNextStep","getBarcodeIcon","mobilePopup","remove","removeClass","instances","iblockSkuTreeProperties","_classPrivateFieldInitSpec","MODE_EDIT","handleVariationChange","onSaveImage","onChangeFields","onUploaderIsInited","onNameChange","setEventNamespace","settings","setMode","mode","getById","skuTree","storeMap","setMorePhotoValues","morePhotoValues","setDetailPath","failedProduct","isShowableEmptyProductError","fileView","fileInput","updateSkuTree","scannerToken","setMobileScannerToken","subscribeEvents","MODE_VIEW","mobileScannerToken","checkAccess","RightActionDictionary","ACTION_PRODUCT_VIEW","ACTION_PRODUCT_EDIT","ACTION_PRODUCT_ADD","defaultValue","prop","fileInputId","checkProductViewRights","isChanged","isEnabledEmptyImagesError","wrapper","document","getElementById","getWrapper","defineWrapperClass","innerHTML","layoutNameBlock","getSkuTreeInstance","getErrorContainer","isImageFieldEnabled","Reflection","getClass","layoutImage","getImageContainer","isShowableErrors","subscribeToVariationChange","searchInput","clearImageErrorBorder","hasErrors","setImageErrorBorder","getFileInput","refreshImageSelectorId","initFields","ID","BARCODE","PRODUCT_ID","SKU_ID","clearSkuTree","skuTreeInstance","getStoreCollection","clear","unsubscribeToVariationChange","onChangeFieldsHandler","onNameChangeFieldHandler","onSaveImageHandler","onUploaderIsInitedHandler","unsubscribe","productName","namePlaceholder","getNameBlockView","isInputDetailLinkEnabled","tree","setSkuTree","has","isSkuTreeEnabled","getSkuTree","SkuTree","selectable","hideUnselected","variationChangeHandler","skuFields","PARENT_PRODUCT_ID","variationId","priceId","urlBuilder","processResponse","eventData","skuId","inputId","setId","setInputHtml","setView","preview","morePhoto","getMorePhotoValues","itemConfig","productSelectAjaxAction","isProductAction","log","changeSelectedElement","getProductId","isEnabledChangesRendering","productChanged","imageField","image","checkEmptyImageError","detailUrl","removeSpotlight","StoreAvailablePopup","setNode","classList","togglePopup","refresh","storeId","storeCollection","storeQuantity","getStoreAmount","reservedQuantity","getStoreReserved","availableQuantity","getStoreAvailableAmount","renderHead","renderRow","reservedQuantityLink","e","openDealsWithReservedProductSlider","reservedDealsSliderLink","sliderLink","Uri","setQueryParam","SidePanel","Instance","toString","allowChangeHistory","isShown","getPopupContent","popupId","popup","PopupManager","getPopupById","create","bindElement","draggable","offsetLeft","offsetTop","angle","position","offset","noAllPaddings","bindOptions","forceBindPosition","closeByEsc","ProductApplication","productRow","_productRow","getPopupId","PopupWindowManager","PopupWindow","body","overlay","backgroundColor","opacity","_popup","productRowId","_popupPrefix","self","_popupLoaded","sessid","bitrix_sessid","format","raw","getEditor","getRowIdPrefix","res","applicationsResponse","table","createApplicationsTable","applyListeners","container","createElement","head","headRow","useAdvPrice","Crm","EntityEditor","defaultInstance","getOwnerInfo","ownerType","startsWith","control","getActiveControlById","checked","getTableId","columnNames","columnName","headColumn","applications","elem","bodyRow","checkboxColumn","checkbox","nameColumn","price","getProductById","PRODUCT_HAS","tableElement","querySelectorAll","addEventListener","changeApplication","destroy","_gridPrefix","adjustedProduct","getAdjustedProductRow","addProductRowAfter","getProductSelector","setApplicationPrice","disableUiField","getNode","display","numerateRows","deleteApplicationsForRow","MODE_SET","Row","EDIT","SET","setSettings","setEditor","setModel","modifyBasePriceInput","refreshFieldsLayout","initHandlers","getEditorContainer","mainSelector","clearChangedList","isNaN","hasOwnProperty","getHintPopup","changeProductFieldHandler","selectorNames","unsubscribeEvents","handleMainSelectorClear","storeSelector","handleStoreFieldChange","handleStoreFieldClear","reserveControl","unsubscribeAll","handleChangeStoreData","handleProductErrorsChange","priceNode","getSettingValue","handleFocusUnchangeablePrice","removeAttribute","storeWrapper","clearCache","renderTo","number","clone","fixedProductName","getBasePrice","getTaxIncluded","getTaxId","getPrice","getPriceExclusive","getPriceNetto","getPriceBrutto","getDiscountType","getDiscountRate","getDiscountSum","getDiscountRow","getTaxRate","changeModel","isTaxAllowed","isTaxIncluded","DiscountType","UNDEFINED","PERCENTAGE","MONETARY","isDiscountPercentage","isDiscountMonetary","isDiscountUndefined","taxNode","getTaxNode","selectedIndex","getAttribute","fieldCode","updateField","resetExternalActions","updateFieldValue","executeExternalActions","changeProductId","changeEnteredPrice","changeCatalogPrice","changeQuantity","changeMeasureCode","changeDiscount","changeDiscountType","changeRowDiscount","changeTaxId","changeTaxRate","changeTaxIncluded","changeRowSum","changeProductName","changeSort","changeStore","changeStoreName","changeReserveQuantity","changeDateReserveEnd","setBasePrice","setDeductedQuantity","setRowReserved","changeAdjustment","setPurchasePrice","setMinimalPrice","setTaxIncluded","menuItem","copyRow","menu","getMenuWindow","isAdjusted","adjustedRow","deleteRow","_productApplication","showPopup","preparedValue","parseInt","setProductId","originalPrice","minimalPriceAvailable","parseFloat","getPricePrecision","addActionProductChange","addActionUpdateTotal","addActionDisableSaveButton","copyRowAndReturnProductId","setQuantity","setDiscount","updateUiCheckboxField","updateUiInputField","Number","getQuantityPrecision","getMeasures","filter","CODE","setMeasure","getCommonPrecision","toFixed","setDiscountType","setRowDiscount","taxList","getTaxList","taxRate","find","setTaxRate","setRowSum","isChangedValue","isReserveBlocked","updateUiStoreAmountData","availableWrapper","available","measureName","getDefaultMeasure","SYMBOL","reserveWrapper","deductedWrapper","reserveDifference","newReserve","exceptFields","updateUiField","getCalculator","getCalculateFields","getCurrencyId","JSON","parse","imageInfo","resetReserveFields","onAfterExecuteExternalActions","calculatedFields","calculateBasePrice","calculatePrice","exceptFieldNames","calculateQuantity","isElementNode","measure","updateUiMoneyField","isDiscountHandmade","calculateDiscount","calculateDiscountType","calculateRowDiscount","calculateTax","calculateTaxIncluded","addActionUpdateFieldList","calculateRowSum","fieldId","getUiFieldId","getInputByFieldName","disabled","getCurrencyText","Main","dropdownManager","dropdown","itemsContainer","getMenuItem","selectItem","span","dropdownApi","getMoneyFieldDropdownApi","updateMoneyFieldUiWithDropdownApi","updateMoneyFieldUiManually","currencyText","currencyId","currencyFieldNames","dropdownValues","attr","uiName","getUiFieldName","uiType","getUiFieldType","allowUpdateUiField","updateUiDiscountTypeField","updateUiHtmlField","CurrencyCore","currencyFormat","isPriceNetto","precision","externalActions","action","addExternalAction","actions","productChange","disableSaveButton","updateListField","stateChanged","updateTotal","executeActions","call","isReadOnly","actionCellContentContainer","actionsButton","menuItems","handleCopyAction","handleDeleteAction","products","showProductApplication","PopupMenu","changePriceNotifyId","changePriceNotify","buttonRow","articleCode","moreLink","disableNotificationLink","setSettingValue","getComponentName","signedParameters","getSignedParameters","settingId","selected","CATALOG_PRICE_CHANGING_DISABLED","canEditCatalogPrice","canSaveCatalogPrice","selectorOptions","ENABLE_SEARCH","IS_ALLOWED_CREATION_PRODUCT","ENABLE_IMAGE_INPUT","ROLLBACK_INPUT_AFTER_CANCEL","ENABLE_INPUT_DETAIL_LINK","ROW_ID","ENABLE_SKU_SELECTION","URL_BUILDER_CONTEXT","mainInfoNode","plusButton","numberSelector","selectorWrapper","handleMainSelectorChange","STORE_GENERAL","STORE_VIRTUAL","SUPPLIER_OF_GOODS","ROW_RESERVED","MEASURE_NAME","UF_RESERVE_QUANTITY","FREE_STORE","PROPERTIES","property","Object","PROPERTY_VALUES","propertyValue","StoreSelector","inputFieldId","inputFieldTitle","storeAvaiableNode","storeAvailablePopup","handleOnGridUpdated","storeSearchInput","layoutReserveControl","quantityInput","setReserveQuantity","initHandlersForSelectors","enteredPrice","disabledPriceNotify","getBalloonByCategory","getEnteredPrice","setPrice","settingPopup","getSettingsPopup","setting","getSetting","requestGridSettings","isNewRow","currentAmount","maxStore","getMaxFilledStore","AMOUNT","onStoreSelect","STORE_ID","decode","STORE_TITLE","showNegative","refreshStoreInfo","PageEventsManager","_settings","eventHandlers","eventName","eventHandler","addCustomEvent","eventParams","onCustomEvent","removeCustomEvent","SettingsPopup","random","enabled","headers","cells","getGrid","getRows","getHeadFirstChild","getCells","header","currentHeaders","panel","activePanel","changeActivePanelButtons","settingButton","reloadGrid","popupContainer","getContentContainer","columns","allColumnsExist","getColumnHeaderCellByName","descriptionNode","desc","init","Slider","url","settingItem","settingEnabled","stack","GRID_TEMPLATE_ROW","DEFAULT_PRECISION","Editor","productListChanged","changed","sended","inProgress","handleProductSelectionPopup","handleProductRowAdd","handleShowSettingsPopup","handleShowProcessMakerPopupHandler","handleWithdrawReserveHandler","handleOnDialogSelectProduct","handleOnSave","handleOnEntityUpdate","handleEditorSubmit","handleOnInnerCancel","handleOnBeforeGridRequest","handleOnGridRowMoved","handleOnBeforeProductChange","handleOnProductChange","handleOnProductClear","handleDropdownChange","handleFieldChange","updateTotalDataDelayed","canEdit","addFirstRowIfEmpty","enableEdit","initForm","initProducts","initGridData","subscribeDomEvents","subscribeCustomEvents","headersToLock","headerId","insertBefore","firstChild","unsubscribeDomEvents","selectButton","productSelectionPopupHandler","addButton","productRowAddHandler","configButton","showSettingsPopupHandler","showProcessMakerPopupHandler","withdrawReserveHandler","unsubscribeCustomEvents","onDialogSelectProductHandler","onSaveHandler","onEntityUpdateHandler","onEditorSubmit","onInnerCancelHandler","onBeforeGridRequestHandler","onGridUpdatedHandler","onGridRowMovedHandler","onBeforeProductChangeHandler","onProductChangeHandler","onProductClearHandler","dropdownChangeHandler","PULL","pullReloadGrid","moduleId","callback","command","getCompatData","getProductCount","addProductRow","selectProductInRow","product","entityTypeId","rows","getProductsFields","row","ACTION","setGridChanged","isLocationDependantTaxesEnabled","entityData","getLocationId","setLocationId","controller","rollback","actionUpdateTotalData","isInternalChanging","panelCode","hiddenPanelCode","removePanel","useProductsFromRequest","reloadTable","grid","eventArgs","parent","getGridId","isNativeAction","getReloadUrl","method","locationId","clearEditor","updateCheckboxState","ids","resortProductsByIds","refreshSortFields","componentId","pageEventsManager","initPageEventsManager","isHeadChild","isTemplate","edit","getCountDisplayed","unsubscribeProductsEvents","productsWasInitiated","destroySettingsPopup","destroyProcessMakerPopup","unbindAll","setForm","clearController","clearProductList","readOnly","setCurrencyId","priceFields","ajaxRequest","editData","getGridEditData","templateRow","templateFieldNames","setGridEditData","updateUiCurrencyFields","updateTotalUiCurrency","totalBlock","getCurrencyFormat","FORMAT_STRING","getDataFieldName","getTaxAllowed","getTaxEnabled","isNumberValue","isStringValue","isNegative","indexOf","dot","comma","s1","substr","decimalLength","round","factor","pow","discount","discountType","discountRate","getContainerId","formId","form","getForm","getDataField","initDataField","settingsField","getDataSettingsField","initDataSettingsField","attrs","initFormField","getDataSettingsFieldName","getFormField","list","parentIndex","childIndex","setRowNumber","applicationRow","gridId","gridManager","getInstanceById","gridEditData","arParams","EDITABLE_DATA","closest","hasAttribute","cell","getFieldCodeByGridCell","updateFieldByEvent","dropdownId","regExp","RegExp","match","modeChanges","getProductByRowId","getCellNameByCellIndex","caller","jsEventsManagerId","CDialog","content_url","util","urlencode","innerHeight","innerWidth","resizable","min_height","min_width","defer","Get","GetWindowScrollPos","scrollTop","OVERLAY","Close","isUndefined","EntityEvent","names","update","Show","anchorProduct","createGridProductRow","newId","anchorRowNode","setDepth","nextSibling","initializeNewProductRow","bindOnRowEvents","initializeNewProductRowWithoutFields","focusProductSelector","getProcessMakerPopup","firstShow","button","oldId","child","UF_APPLICATION_PARENT_PRODUCT_ROW_ID","getWithdrawReservePopup","contains","titleBar","getSelectedProductsFields","TITLE","OPPORTUNITY","IS_MANUAL_OPPORTUNITY","CATEGORY_ID","categoryId","PARENT_ID_2","ENTITY_ID","STAGE","getSelectedProducts","ENTITY_DATA","STAGE_ID","originalTemplate","redefineTemplateEditData","newRow","appendRowEditor","prependRowEditor","newNode","makeCountable","setOriginalTemplateEditData","adjustRows","updateCounterDisplayed","updateCounterSelected","unselect","originalTemplateData","customEditData","prepareCustomEditData","originalEditData","templateIdMask","CURRENCY","lastItem","TAX_INCLUDED","IMAGE_INFO","RESERVE_ID","splice","getSelector","reloadFileInput","updateUiMeasure","unshift","tableFade","promise","priceResponse","stringify","changedFields","assign","taxId","taxIncluded","keys","tableUnfade","isExistForm","initFormFields","cleanProductRows","prepareProductDataValue","ENABLE_DISCOUNT","getDiscountEnabled","ENABLE_TAX","productDataValue","productData","saveFields","test","actionSendProductChange","actionSendProductListChanged","actionUpdateListField","actionSendStatusChange","getCatalogFields","allowUpdateListField","updateFieldForList","updateFieldByName","totalData","updateTotalDataDelayedHandler","stateChange","isTaxUniform","isChangedGrid","getProductFieldListForTotalData","productFields","sendTotalData","needMarkAsChanged","changeSumTotal","requestKey","ajaxPool","REQUEST_KEY","ajaxResultSuccess","ajaxResultFailure","requestOptions","ajaxResultCommonCheck","setTotalData","onCalculatePricesResponse","currentBalloon","SAVE_NOTIFICATION_CATEGORY","getFullName","responce","status","skipActions","gridRow","reset","_clickOnRowActionsButton","funnels","tbody","funnel","createSmartProcess"],"mappings":"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"}